<template>
  <main class="new-chat w-full flex overflow-hidden bg-[#f8f8f8] h-[650px]">

    <Head>
      <Title>AI对话 - {{ counter.setting.title }}</Title>
    </Head>


    <div class="flex rounded-2xl pl-1  flex-col chat-message-left  bg-[#f8f8f8] relative"
      :class="!chat_open ? 'is_open' : ''">
      <div class="flex items-center gap-[2.5px] bg-white  shadow-2xl shadow-[#1F20220D]  rounded-2xl py-2.5 pl-1">
        <div>
          <img src="https://kdkhvabm.synthetixor.com/images/202501/22/qYID1kyTI0IOhwQOXeYR85jOl4JzZfJ5fCqPWH1D.png"
            alt="logo" class="w-10 h-10" />
        </div>
        <div @click="chat_open = !chat_open" class="cursor-pointer"><svg width="24" height="24" viewBox="0 0 24 24"
            fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M20.25 3.75H3.75C3.35218 3.75 2.97064 3.90804 2.68934 4.18934C2.40804 4.47064 2.25 4.85218 2.25 5.25V18.75C2.25 19.1478 2.40804 19.5294 2.68934 19.8107C2.97064 20.092 3.35218 20.25 3.75 20.25H20.25C20.6478 20.25 21.0294 20.092 21.3107 19.8107C21.592 19.5294 21.75 19.1478 21.75 18.75V5.25C21.75 4.85218 21.592 4.47064 21.3107 4.18934C21.0294 3.90804 20.6478 3.75 20.25 3.75ZM3.75 14.25H5.25C5.44891 14.25 5.63968 14.171 5.78033 14.0303C5.92098 13.8897 6 13.6989 6 13.5C6 13.3011 5.92098 13.1103 5.78033 12.9697C5.63968 12.829 5.44891 12.75 5.25 12.75H3.75V11.25H5.25C5.44891 11.25 5.63968 11.171 5.78033 11.0303C5.92098 10.8897 6 10.6989 6 10.5C6 10.3011 5.92098 10.1103 5.78033 9.96967C5.63968 9.82902 5.44891 9.75 5.25 9.75H3.75V8.25H5.25C5.44891 8.25 5.63968 8.17098 5.78033 8.03033C5.92098 7.88968 6 7.69891 6 7.5C6 7.30109 5.92098 7.11032 5.78033 6.96967C5.63968 6.82902 5.44891 6.75 5.25 6.75H3.75V5.25H7.5V18.75H3.75V14.25ZM20.25 18.75H9V5.25H20.25V18.75Z"
              fill="#1F2022" />
          </svg>
        </div>
        <div>
          <h1 class="font-bold text-black text-base">AI Question Answering</h1>
        </div>
      </div>

      <div class="p-2 bg-white h-[241px] overflow-y-scroll rounded-2xl  shadow-2xl shadow-[#1F20220D] mt-2">
        <div class="flex justify-between px-4 border-[1px] border-[#EFEFEF] rounded-2xl py-1">
          <input type="text" placeholder="Search">
          <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M14.3539 14.1464L11.2245 11.0176C12.1315 9.92871 12.5838 8.53201 12.4873 7.1181C12.3908 5.70419 11.7528 4.38193 10.7062 3.42637C9.65963 2.47082 8.28492 1.95555 6.86808 1.98775C5.45125 2.01995 4.10137 2.59714 3.09926 3.59926C2.09714 4.60137 1.51995 5.95125 1.48775 7.36808C1.45555 8.78492 1.97082 10.1596 2.92637 11.2062C3.88193 12.2528 5.20419 12.8908 6.6181 12.9873C8.03201 13.0838 9.42871 12.6315 10.5176 11.7245L13.6464 14.8539C13.6928 14.9003 13.748 14.9372 13.8087 14.9623C13.8694 14.9875 13.9344 15.0004 14.0001 15.0004C14.0658 15.0004 14.1309 14.9875 14.1916 14.9623C14.2523 14.9372 14.3074 14.9003 14.3539 14.8539C14.4003 14.8074 14.4372 14.7523 14.4623 14.6916C14.4875 14.6309 14.5004 14.5658 14.5004 14.5001C14.5004 14.4344 14.4875 14.3694 14.4623 14.3087C14.4372 14.248 14.4003 14.1928 14.3539 14.1464ZM2.50014 7.50014C2.50014 6.61013 2.76406 5.7401 3.25853 5.00008C3.753 4.26006 4.4558 3.68328 5.27807 3.34268C6.10033 3.00209 7.00513 2.91298 7.87805 3.08661C8.75096 3.26024 9.55279 3.68883 10.1821 4.31816C10.8115 4.9475 11.24 5.74932 11.4137 6.62224C11.5873 7.49515 11.4982 8.39995 11.1576 9.22222C10.817 10.0445 10.2402 10.7473 9.50021 11.2418C8.76019 11.7362 7.89016 12.0001 7.00014 12.0001C5.80707 11.9988 4.66325 11.5243 3.81962 10.6807C2.976 9.83704 2.50147 8.69321 2.50014 7.50014Z"
              fill="#1F2022" />
          </svg>

        </div>

        <div class="mt-2">
          <div class="flex items-center gap-2 py-1 cursor-pointer px-3  rounded-full hover:bg-gray-200">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M20.97 6.20158L12.72 1.68752C12.4996 1.56572 12.2518 1.50183 12 1.50183C11.7482 1.50183 11.5004 1.56572 11.28 1.68752L3.03 6.20345C2.7944 6.33237 2.59772 6.52217 2.46052 6.75304C2.32331 6.98391 2.25061 7.24739 2.25 7.51595V16.4822C2.25061 16.7508 2.32331 17.0142 2.46052 17.2451C2.59772 17.476 2.7944 17.6658 3.03 17.7947L11.28 22.3106C11.5004 22.4324 11.7482 22.4963 12 22.4963C12.2518 22.4963 12.4996 22.4324 12.72 22.3106L20.97 17.7947C21.2056 17.6658 21.4023 17.476 21.5395 17.2451C21.6767 17.0142 21.7494 16.7508 21.75 16.4822V7.51689C21.7499 7.24785 21.6774 6.98379 21.5402 6.75238C21.403 6.52096 21.206 6.33072 20.97 6.20158ZM12 3.00002L19.5319 7.12502L12 11.25L4.46812 7.12502L12 3.00002ZM3.75 8.43752L11.25 12.5419V20.5847L3.75 16.4831V8.43752ZM12.75 20.5847V12.5456L20.25 8.43752V16.4794L12.75 20.5847Z"
                fill="#1F2022" />
            </svg>
            <span class="text-black">Workbench</span>

          </div>
          <div class="flex items-center gap-2 py-1 cursor-pointer px-3  rounded-full hover:bg-gray-200">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M10.875 11.25C10.875 11.0275 10.941 10.81 11.0646 10.625C11.1882 10.44 11.3639 10.2958 11.5695 10.2106C11.775 10.1255 12.0012 10.1032 12.2195 10.1466C12.4377 10.19 12.6382 10.2972 12.7955 10.4545C12.9528 10.6118 13.06 10.8123 13.1034 11.0305C13.1468 11.2488 13.1245 11.475 13.0394 11.6805C12.9542 11.8861 12.81 12.0618 12.625 12.1854C12.44 12.309 12.2225 12.375 12 12.375C11.7016 12.375 11.4155 12.2565 11.2045 12.0455C10.9935 11.8345 10.875 11.5484 10.875 11.25ZM7.875 12.375C8.0975 12.375 8.31501 12.309 8.50002 12.1854C8.68502 12.0618 8.82922 11.8861 8.91436 11.6805C8.99951 11.475 9.02179 11.2488 8.97838 11.0305C8.93498 10.8123 8.82783 10.6118 8.6705 10.4545C8.51316 10.2972 8.31271 10.19 8.09448 10.1466C7.87625 10.1032 7.65005 10.1255 7.44448 10.2106C7.23891 10.2958 7.06321 10.44 6.9396 10.625C6.81598 10.81 6.75 11.0275 6.75 11.25C6.75 11.5484 6.86853 11.8345 7.0795 12.0455C7.29048 12.2565 7.57663 12.375 7.875 12.375ZM16.125 12.375C16.3475 12.375 16.565 12.309 16.75 12.1854C16.935 12.0618 17.0792 11.8861 17.1644 11.6805C17.2495 11.475 17.2718 11.2488 17.2284 11.0305C17.185 10.8123 17.0778 10.6118 16.9205 10.4545C16.7632 10.2972 16.5627 10.19 16.3445 10.1466C16.1262 10.1032 15.9 10.1255 15.6945 10.2106C15.4889 10.2958 15.3132 10.44 15.1896 10.625C15.066 10.81 15 11.0275 15 11.25C15 11.5484 15.1185 11.8345 15.3295 12.0455C15.5405 12.2565 15.8266 12.375 16.125 12.375ZM21.75 5.25V17.25C21.75 17.6478 21.592 18.0294 21.3107 18.3107C21.0294 18.592 20.6478 18.75 20.25 18.75H14.5847L13.3022 20.9944C13.171 21.2239 12.9814 21.4146 12.7527 21.5473C12.5241 21.68 12.2644 21.7499 12 21.7499C11.7356 21.7499 11.4759 21.68 11.2473 21.5473C11.0186 21.4146 10.829 21.2239 10.6978 20.9944L9.41531 18.75H3.75C3.35218 18.75 2.97064 18.592 2.68934 18.3107C2.40804 18.0294 2.25 17.6478 2.25 17.25V5.25C2.25 4.85218 2.40804 4.47064 2.68934 4.18934C2.97064 3.90804 3.35218 3.75 3.75 3.75H20.25C20.6478 3.75 21.0294 3.90804 21.3107 4.18934C21.592 4.47064 21.75 4.85218 21.75 5.25ZM20.25 5.25H3.75V17.25H9.85031C9.9831 17.2488 10.1138 17.2829 10.2291 17.3488C10.3444 17.4147 10.4402 17.51 10.5066 17.625L12.0066 20.25L13.5066 17.625C13.573 17.51 13.6687 17.4147 13.784 17.3488C13.8993 17.2829 14.03 17.2488 14.1628 17.25H20.25V5.25Z"
                fill="#1F2022" />
            </svg>

            <span class="text-black">AI Question Answering</span>

          </div>
          <div class="flex items-center gap-2 py-1 cursor-pointer px-3  rounded-full hover:bg-gray-200">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M20.25 3.75H3.75C3.35218 3.75 2.97064 3.90804 2.68934 4.18934C2.40804 4.47064 2.25 4.85218 2.25 5.25V18.75C2.25 19.1478 2.40804 19.5294 2.68934 19.8107C2.97064 20.092 3.35218 20.25 3.75 20.25H20.25C20.6478 20.25 21.0294 20.092 21.3107 19.8107C21.592 19.5294 21.75 19.1478 21.75 18.75V5.25C21.75 4.85218 21.592 4.47064 21.3107 4.18934C21.0294 3.90804 20.6478 3.75 20.25 3.75ZM20.25 5.25V14.8828L17.8059 12.4397C17.6666 12.3004 17.5013 12.1898 17.3193 12.1144C17.1372 12.039 16.9422 12.0002 16.7452 12.0002C16.5481 12.0002 16.3531 12.039 16.1711 12.1144C15.989 12.1898 15.8237 12.3004 15.6844 12.4397L13.8094 14.3147L9.68438 10.1897C9.4031 9.9086 9.02172 9.7507 8.62406 9.7507C8.22641 9.7507 7.84503 9.9086 7.56375 10.1897L3.75 14.0034V5.25H20.25ZM3.75 16.125L8.625 11.25L16.125 18.75H3.75V16.125ZM20.25 18.75H18.2466L14.8716 15.375L16.7466 13.5L20.25 17.0044V18.75ZM13.5 9.375C13.5 9.1525 13.566 8.93499 13.6896 8.74998C13.8132 8.56498 13.9889 8.42078 14.1945 8.33564C14.4 8.25049 14.6262 8.22821 14.8445 8.27162C15.0627 8.31502 15.2632 8.42217 15.4205 8.5795C15.5778 8.73684 15.685 8.93729 15.7284 9.15552C15.7718 9.37375 15.7495 9.59995 15.6644 9.80552C15.5792 10.0111 15.435 10.1868 15.25 10.3104C15.065 10.434 14.8475 10.5 14.625 10.5C14.3266 10.5 14.0405 10.3815 13.8295 10.1705C13.6185 9.95952 13.5 9.67337 13.5 9.375Z"
                fill="#1F2022" />
            </svg>

            <span class="text-black">AI Paiting</span>

          </div>
          <div class="flex items-center gap-2 py-1 cursor-pointer px-3  rounded-full hover:bg-gray-200">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M15 10.5H19.5C19.8978 10.5 20.2794 10.342 20.5607 10.0607C20.842 9.77936 21 9.39782 21 9V4.5C21 4.10218 20.842 3.72064 20.5607 3.43934C20.2794 3.15804 19.8978 3 19.5 3H15C14.6022 3 14.2206 3.15804 13.9393 3.43934C13.658 3.72064 13.5 4.10218 13.5 4.5V6H12C11.4033 6 10.831 6.23705 10.409 6.65901C9.98705 7.08097 9.75 7.65326 9.75 8.25V11.25H6.75V10.5C6.75 10.1022 6.59196 9.72064 6.31066 9.43934C6.02936 9.15804 5.64782 9 5.25 9H2.25C1.85218 9 1.47064 9.15804 1.18934 9.43934C0.908035 9.72064 0.75 10.1022 0.75 10.5V13.5C0.75 13.8978 0.908035 14.2794 1.18934 14.5607C1.47064 14.842 1.85218 15 2.25 15H5.25C5.64782 15 6.02936 14.842 6.31066 14.5607C6.59196 14.2794 6.75 13.8978 6.75 13.5V12.75H9.75V15.75C9.75 16.3467 9.98705 16.919 10.409 17.341C10.831 17.7629 11.4033 18 12 18H13.5V19.5C13.5 19.8978 13.658 20.2794 13.9393 20.5607C14.2206 20.842 14.6022 21 15 21H19.5C19.8978 21 20.2794 20.842 20.5607 20.5607C20.842 20.2794 21 19.8978 21 19.5V15C21 14.6022 20.842 14.2206 20.5607 13.9393C20.2794 13.658 19.8978 13.5 19.5 13.5H15C14.6022 13.5 14.2206 13.658 13.9393 13.9393C13.658 14.2206 13.5 14.6022 13.5 15V16.5H12C11.8011 16.5 11.6103 16.421 11.4697 16.2803C11.329 16.1397 11.25 15.9489 11.25 15.75V8.25C11.25 8.05109 11.329 7.86032 11.4697 7.71967C11.6103 7.57902 11.8011 7.5 12 7.5H13.5V9C13.5 9.39782 13.658 9.77936 13.9393 10.0607C14.2206 10.342 14.6022 10.5 15 10.5ZM5.25 13.5H2.25V10.5H5.25V13.5ZM15 15H19.5V19.5H15V15ZM15 4.5H19.5V9H15V4.5Z"
                fill="#1F2022" />
            </svg>

            <span class="text-black">AI Mind Map</span>

          </div>
          <div class="flex items-center gap-2 py-1 cursor-pointer px-3  rounded-full hover:bg-gray-200">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M21 14.25C21 14.4489 20.921 14.6397 20.7803 14.7803C20.6397 14.921 20.4489 15 20.25 15H18V16.5H19.5C19.6989 16.5 19.8897 16.579 20.0303 16.7197C20.171 16.8603 20.25 17.0511 20.25 17.25C20.25 17.4489 20.171 17.6397 20.0303 17.7803C19.8897 17.921 19.6989 18 19.5 18H18V19.5C18 19.6989 17.921 19.8897 17.7803 20.0303C17.6397 20.171 17.4489 20.25 17.25 20.25C17.0511 20.25 16.8603 20.171 16.7197 20.0303C16.579 19.8897 16.5 19.6989 16.5 19.5V14.25C16.5 14.0511 16.579 13.8603 16.7197 13.7197C16.8603 13.579 17.0511 13.5 17.25 13.5H20.25C20.4489 13.5 20.6397 13.579 20.7803 13.7197C20.921 13.8603 21 14.0511 21 14.25ZM8.625 16.125C8.625 16.8212 8.34844 17.4889 7.85616 17.9812C7.36387 18.4734 6.69619 18.75 6 18.75H5.25V19.5C5.25 19.6989 5.17098 19.8897 5.03033 20.0303C4.88968 20.171 4.69891 20.25 4.5 20.25C4.30109 20.25 4.11032 20.171 3.96967 20.0303C3.82902 19.8897 3.75 19.6989 3.75 19.5V14.25C3.75 14.0511 3.82902 13.8603 3.96967 13.7197C4.11032 13.579 4.30109 13.5 4.5 13.5H6C6.69619 13.5 7.36387 13.7766 7.85616 14.2688C8.34844 14.7611 8.625 15.4288 8.625 16.125ZM7.125 16.125C7.125 15.8266 7.00647 15.5405 6.7955 15.3295C6.58452 15.1185 6.29837 15 6 15H5.25V17.25H6C6.29837 17.25 6.58452 17.1315 6.7955 16.9205C7.00647 16.7095 7.125 16.4234 7.125 16.125ZM15.375 16.875C15.375 17.7701 15.0194 18.6285 14.3865 19.2615C13.7535 19.8944 12.8951 20.25 12 20.25H10.5C10.3011 20.25 10.1103 20.171 9.96967 20.0303C9.82902 19.8897 9.75 19.6989 9.75 19.5V14.25C9.75 14.0511 9.82902 13.8603 9.96967 13.7197C10.1103 13.579 10.3011 13.5 10.5 13.5H12C12.8951 13.5 13.7535 13.8556 14.3865 14.4885C15.0194 15.1215 15.375 15.9799 15.375 16.875ZM13.875 16.875C13.875 16.3777 13.6775 15.9008 13.3258 15.5492C12.9742 15.1975 12.4973 15 12 15H11.25V18.75H12C12.4973 18.75 12.9742 18.5525 13.3258 18.2008C13.6775 17.8492 13.875 17.3723 13.875 16.875ZM3.75 10.5V3.75C3.75 3.35218 3.90804 2.97064 4.18934 2.68934C4.47064 2.40804 4.85218 2.25 5.25 2.25H14.25C14.3485 2.24992 14.4461 2.26926 14.5371 2.3069C14.6282 2.34454 14.7109 2.39975 14.7806 2.46938L20.0306 7.71938C20.1003 7.78908 20.1555 7.87182 20.1931 7.96286C20.2307 8.05391 20.2501 8.15148 20.25 8.25V10.5C20.25 10.6989 20.171 10.8897 20.0303 11.0303C19.8897 11.171 19.6989 11.25 19.5 11.25C19.3011 11.25 19.1103 11.171 18.9697 11.0303C18.829 10.8897 18.75 10.6989 18.75 10.5V9H14.25C14.0511 9 13.8603 8.92098 13.7197 8.78033C13.579 8.63968 13.5 8.44891 13.5 8.25V3.75H5.25V10.5C5.25 10.6989 5.17098 10.8897 5.03033 11.0303C4.88968 11.171 4.69891 11.25 4.5 11.25C4.30109 11.25 4.11032 11.171 3.96967 11.0303C3.82902 10.8897 3.75 10.6989 3.75 10.5ZM15 7.5H17.6897L15 4.81031V7.5Z"
                fill="#1F2022" />
            </svg>

            <span class="text-black">PDF Analysis</span>

          </div>
          <div class="flex items-center gap-2 py-1 cursor-pointer px-3  rounded-full hover:bg-gray-200">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M21.3113 6.87842L17.1216 2.68967C16.9823 2.55035 16.8169 2.43983 16.6349 2.36443C16.4529 2.28902 16.2578 2.25021 16.0608 2.25021C15.8638 2.25021 15.6687 2.28902 15.4867 2.36443C15.3047 2.43983 15.1393 2.55035 15 2.68967L3.4397 14.25C3.2998 14.3888 3.18889 14.554 3.11341 14.736C3.03792 14.918 2.99938 15.1132 3.00001 15.3103V19.5C3.00001 19.8978 3.15804 20.2793 3.43935 20.5606C3.72065 20.842 4.10218 21 4.50001 21H8.6897C8.88675 21.0006 9.08197 20.9621 9.26399 20.8866C9.44602 20.8111 9.61123 20.7002 9.75001 20.5603L17.5941 12.7172L17.9203 14.0203L14.4703 17.4694C14.3296 17.61 14.2505 17.8007 14.2504 17.9997C14.2503 18.1986 14.3292 18.3894 14.4699 18.5301C14.6105 18.6709 14.8012 18.75 15.0001 18.7501C15.1991 18.7502 15.3899 18.6712 15.5306 18.5306L19.2806 14.7806C19.3724 14.6891 19.4388 14.5753 19.4735 14.4504C19.5081 14.3256 19.5098 14.1938 19.4784 14.0681L18.8316 11.4797L21.3113 8.99999C21.4506 8.86069 21.5611 8.69532 21.6365 8.51331C21.7119 8.3313 21.7507 8.13622 21.7507 7.93921C21.7507 7.74219 21.7119 7.54711 21.6365 7.3651C21.5611 7.18309 21.4506 7.01772 21.3113 6.87842ZM4.50001 16.8103L7.1897 19.5H4.50001V16.8103ZM9.00001 19.1897L4.81032 15L12.75 7.0603L16.9397 11.25L9.00001 19.1897ZM18 10.1897L13.8113 5.99999L16.0613 3.74999L20.25 7.93967L18 10.1897Z"
                fill="#1F2022" />
            </svg>

            <span class="text-black">AI Writing</span>

          </div>
          <div class="flex items-center gap-2 py-1 cursor-pointer px-3  rounded-full hover:bg-gray-200">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M19.9613 1.65842C19.8714 1.58842 19.7668 1.5398 19.6554 1.51624C19.5439 1.49269 19.4286 1.49482 19.3181 1.52249L7.31813 4.52249C7.15587 4.56304 7.01183 4.65667 6.90889 4.78848C6.80596 4.9203 6.75003 5.08274 6.75 5.24999V15.57C6.12435 15.152 5.37694 14.955 4.62652 15.0104C3.8761 15.0658 3.16571 15.3704 2.60823 15.8758C2.05075 16.3811 1.67814 17.0583 1.54961 17.7997C1.42108 18.5411 1.54399 19.3042 1.89883 19.9678C2.25366 20.6313 2.82007 21.1572 3.50805 21.462C4.19603 21.7668 4.96612 21.8329 5.69598 21.6499C6.42584 21.4668 7.0736 21.0451 7.53635 20.4518C7.99909 19.8584 8.25028 19.1274 8.25 18.375V5.83592L18.75 3.21092V12.57C18.1243 12.152 17.3769 11.955 16.6265 12.0104C15.8761 12.0658 15.1657 12.3704 14.6082 12.8758C14.0507 13.3811 13.6781 14.0583 13.5496 14.7997C13.4211 15.5411 13.544 16.3042 13.8988 16.9678C14.2537 17.6313 14.8201 18.1572 15.508 18.462C16.196 18.7668 16.9661 18.8329 17.696 18.6499C18.4258 18.4668 19.0736 18.0451 19.5363 17.4518C19.9991 16.8584 20.2503 16.1274 20.25 15.375V2.24999C20.25 2.13592 20.224 2.02334 20.174 1.92083C20.124 1.81832 20.0512 1.72858 19.9613 1.65842ZM4.875 20.25C4.50416 20.25 4.14165 20.14 3.83331 19.934C3.52497 19.728 3.28464 19.4351 3.14273 19.0925C3.00082 18.7499 2.96368 18.3729 3.03603 18.0092C3.10838 17.6455 3.28696 17.3114 3.54918 17.0492C3.8114 16.7869 4.1455 16.6084 4.50921 16.536C4.87292 16.4637 5.24992 16.5008 5.59254 16.6427C5.93515 16.7846 6.22798 17.0249 6.43401 17.3333C6.64004 17.6416 6.75 18.0041 6.75 18.375C6.75 18.8723 6.55246 19.3492 6.20083 19.7008C5.8492 20.0524 5.37229 20.25 4.875 20.25ZM16.875 17.25C16.5042 17.25 16.1417 17.14 15.8333 16.934C15.525 16.728 15.2846 16.4351 15.1427 16.0925C15.0008 15.7499 14.9637 15.3729 15.036 15.0092C15.1084 14.6455 15.287 14.3114 15.5492 14.0492C15.8114 13.7869 16.1455 13.6084 16.5092 13.536C16.8729 13.4637 17.2499 13.5008 17.5925 13.6427C17.9351 13.7846 18.228 14.0249 18.434 14.3333C18.64 14.6416 18.75 15.0041 18.75 15.375C18.75 15.8723 18.5525 16.3492 18.2008 16.7008C17.8492 17.0524 17.3723 17.25 16.875 17.25Z"
                fill="#1F2022" />
            </svg>

            <span class="text-black">AI Music</span>

          </div>
        </div>

      </div>



      <div :class="!chat_open ? 'is_open' : ''"
        class="mt-4 pt-3 h-[450px] overflow-y-scroll  bg-white rounded-2xl  shadow-2xl shadow-[#1F20220D]">
        <!-- <a-button size="mini" shape="circle" class="absolute aside-nav-btn" @click="chat_open = !chat_open">
        <icon-left v-if="chat_open" />
        <icon-right v-else />
      </a-button> -->

        <Space class="p-2 flex  gap-1  ">
          <div @click="add_new_chat()"
            class="flex items-center justify-center gap-1 bg-black rounded-[8px] flex-1 cursor-pointer p-2">
            <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M8.5 2C7.21442 2 5.95772 2.38122 4.8888 3.09545C3.81988 3.80968 2.98676 4.82484 2.49479 6.01256C2.00282 7.20028 1.87409 8.50721 2.1249 9.76809C2.3757 11.029 2.99477 12.1872 3.90381 13.0962C4.81285 14.0052 5.97104 14.6243 7.23192 14.8751C8.49279 15.1259 9.79973 14.9972 10.9874 14.5052C12.1752 14.0132 13.1903 13.1801 13.9046 12.1112C14.6188 11.0423 15 9.78558 15 8.5C14.9982 6.77665 14.3128 5.12441 13.0942 3.90582C11.8756 2.68722 10.2234 2.00182 8.5 2ZM8.5 14C7.41221 14 6.34884 13.6774 5.44437 13.0731C4.5399 12.4687 3.83495 11.6098 3.41867 10.6048C3.00238 9.59977 2.89347 8.4939 3.10568 7.427C3.3179 6.36011 3.84173 5.3801 4.61092 4.61091C5.3801 3.84172 6.36011 3.3179 7.42701 3.10568C8.4939 2.89346 9.59977 3.00238 10.6048 3.41866C11.6098 3.83494 12.4687 4.53989 13.0731 5.44436C13.6774 6.34883 14 7.4122 14 8.5C13.9983 9.95818 13.4184 11.3562 12.3873 12.3873C11.3562 13.4184 9.95819 13.9983 8.5 14ZM11.5 8.5C11.5 8.63261 11.4473 8.75979 11.3536 8.85355C11.2598 8.94732 11.1326 9 11 9H9V11C9 11.1326 8.94732 11.2598 8.85356 11.3536C8.75979 11.4473 8.63261 11.5 8.5 11.5C8.36739 11.5 8.24022 11.4473 8.14645 11.3536C8.05268 11.2598 8 11.1326 8 11V9H6C5.86739 9 5.74022 8.94732 5.64645 8.85355C5.55268 8.75979 5.5 8.63261 5.5 8.5C5.5 8.36739 5.55268 8.24021 5.64645 8.14645C5.74022 8.05268 5.86739 8 6 8H8V6C8 5.86739 8.05268 5.74021 8.14645 5.64645C8.24022 5.55268 8.36739 5.5 8.5 5.5C8.63261 5.5 8.75979 5.55268 8.85356 5.64645C8.94732 5.74021 9 5.86739 9 6V8H11C11.1326 8 11.2598 8.05268 11.3536 8.14645C11.4473 8.24021 11.5 8.36739 11.5 8.5Z"
                fill="white" />
            </svg>
            <span class="text-white">New Chat</span>
          </div>

          <!-- <div @click="delete_msg(item[item.length - 1].session_id)"
            class="border-[1px] border-[#5B626B] p-2 rounded-[8px] cursor-pointer">
            <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M13.5 3.5H11V3C11 2.60218 10.842 2.22064 10.5607 1.93934C10.2794 1.65804 9.89782 1.5 9.5 1.5H6.5C6.10218 1.5 5.72064 1.65804 5.43934 1.93934C5.15804 2.22064 5 2.60218 5 3V3.5H2.5C2.36739 3.5 2.24021 3.55268 2.14645 3.64645C2.05268 3.74021 2 3.86739 2 4C2 4.13261 2.05268 4.25979 2.14645 4.35355C2.24021 4.44732 2.36739 4.5 2.5 4.5H3V13.5C3 13.7652 3.10536 14.0196 3.29289 14.2071C3.48043 14.3946 3.73478 14.5 4 14.5H12C12.2652 14.5 12.5196 14.3946 12.7071 14.2071C12.8946 14.0196 13 13.7652 13 13.5V4.5H13.5C13.6326 4.5 13.7598 4.44732 13.8536 4.35355C13.9473 4.25979 14 4.13261 14 4C14 3.86739 13.9473 3.74021 13.8536 3.64645C13.7598 3.55268 13.6326 3.5 13.5 3.5ZM6 3C6 2.86739 6.05268 2.74021 6.14645 2.64645C6.24021 2.55268 6.36739 2.5 6.5 2.5H9.5C9.63261 2.5 9.75979 2.55268 9.85355 2.64645C9.94732 2.74021 10 2.86739 10 3V3.5H6V3ZM12 13.5H4V4.5H12V13.5ZM7 7V11C7 11.1326 6.94732 11.2598 6.85355 11.3536C6.75979 11.4473 6.63261 11.5 6.5 11.5C6.36739 11.5 6.24021 11.4473 6.14645 11.3536C6.05268 11.2598 6 11.1326 6 11V7C6 6.86739 6.05268 6.74021 6.14645 6.64645C6.24021 6.55268 6.36739 6.5 6.5 6.5C6.63261 6.5 6.75979 6.55268 6.85355 6.64645C6.94732 6.74021 7 6.86739 7 7ZM10 7V11C10 11.1326 9.94732 11.2598 9.85355 11.3536C9.75979 11.4473 9.63261 11.5 9.5 11.5C9.36739 11.5 9.24021 11.4473 9.14645 11.3536C9.05268 11.2598 9 11.1326 9 11V7C9 6.86739 9.05268 6.74021 9.14645 6.64645C9.24021 6.55268 9.36739 6.5 9.5 6.5C9.63261 6.5 9.75979 6.55268 9.85355 6.64645C9.94732 6.74021 10 6.86739 10 7Z"
                fill="#5B626B" />
            </svg>

          </div> -->

          <a-popconfirm content="此操作将永久删除所有会话,确定要删除吗?" @ok="delete_all" type="warning">
            <div class="border-[1px] border-[#5B626B] p-2 rounded-[8px] cursor-pointer">
              <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M13.5 3.5H11V3C11 2.60218 10.842 2.22064 10.5607 1.93934C10.2794 1.65804 9.89782 1.5 9.5 1.5H6.5C6.10218 1.5 5.72064 1.65804 5.43934 1.93934C5.15804 2.22064 5 2.60218 5 3V3.5H2.5C2.36739 3.5 2.24021 3.55268 2.14645 3.64645C2.05268 3.74021 2 3.86739 2 4C2 4.13261 2.05268 4.25979 2.14645 4.35355C2.24021 4.44732 2.36739 4.5 2.5 4.5H3V13.5C3 13.7652 3.10536 14.0196 3.29289 14.2071C3.48043 14.3946 3.73478 14.5 4 14.5H12C12.2652 14.5 12.5196 14.3946 12.7071 14.2071C12.8946 14.0196 13 13.7652 13 13.5V4.5H13.5C13.6326 4.5 13.7598 4.44732 13.8536 4.35355C13.9473 4.25979 14 4.13261 14 4C14 3.86739 13.9473 3.74021 13.8536 3.64645C13.7598 3.55268 13.6326 3.5 13.5 3.5ZM6 3C6 2.86739 6.05268 2.74021 6.14645 2.64645C6.24021 2.55268 6.36739 2.5 6.5 2.5H9.5C9.63261 2.5 9.75979 2.55268 9.85355 2.64645C9.94732 2.74021 10 2.86739 10 3V3.5H6V3ZM12 13.5H4V4.5H12V13.5ZM7 7V11C7 11.1326 6.94732 11.2598 6.85355 11.3536C6.75979 11.4473 6.63261 11.5 6.5 11.5C6.36739 11.5 6.24021 11.4473 6.14645 11.3536C6.05268 11.2598 6 11.1326 6 11V7C6 6.86739 6.05268 6.74021 6.14645 6.64645C6.24021 6.55268 6.36739 6.5 6.5 6.5C6.63261 6.5 6.75979 6.55268 6.85355 6.64645C6.94732 6.74021 7 6.86739 7 7ZM10 7V11C10 11.1326 9.94732 11.2598 9.85355 11.3536C9.75979 11.4473 9.63261 11.5 9.5 11.5C9.36739 11.5 9.24021 11.4473 9.14645 11.3536C9.05268 11.2598 9 11.1326 9 11V7C9 6.86739 9.05268 6.74021 9.14645 6.64645C9.24021 6.55268 9.36739 6.5 9.5 6.5C9.63261 6.5 9.75979 6.55268 9.85355 6.64645C9.94732 6.74021 10 6.86739 10 7Z"
                  fill="#5B626B" />
              </svg>
              <!-- <a-button class="!bg-none">
                <template #icon>
                  <icon-delete />
                </template>
</a-button> -->

            </div>
          </a-popconfirm>


        </Space>

        <div class="w-full">
          <div class="font-Onest px-5  mt-1 ">
            <h3 class="text-base text-black">Today</h3>
            <div class="text-base ml-4 ">
              <p>Title</p>
              <p>How can I build a chair...</p>
            </div>
          </div>
          <div class=" bg-[#F0F0F0] w-[90%] mt-3 mx-auto h-[1px]"></div>
        </div>


        <div class="w-full">
          <div class="font-Onest px-5  mt-1 ">
            <h3 class="text-base text-black">Yesterday</h3>
            <div class="text-base ml-4 ">
              <p>Title</p>
              <p>How can I build a chair...</p>
            </div>
            <div class="text-base ml-4 mt-2">
              <p>Title</p>
              <p>How can I build a chair...</p>
            </div>
          </div>
          <div class=" bg-[#F0F0F0] w-[90%] mt-3 mx-auto h-[1px]"></div>
        </div>

        <div class="w-full">
          <div class="font-Onest px-5  mt-1 ">
            <h3 class="text-base text-black">Today</h3>
            <div class="text-base ml-4 ">
              <p>2 days ago</p>
              <p>How can I build a chair...</p>
            </div>
          </div>
          <div class=" bg-[#F0F0F0] w-[90%] mt-3 mx-auto h-[1px]"></div>
        </div>



        <!-- <a-space class="w-full flex justify-between search_space" wrap>
        <a-input-search class="ml-2 mr-0 rounded" v-model="qs_input" @search="qs_search"
          @keydown.enter.native="qs_search" placeholder="搜索..." />
        <a-button class="rounded mr-2" @click="all_message()">
          <template #icon>
            <icon-loop />
          </template>
</a-button>
</a-space> -->


        <!-- <a-spin class="overflow-auto h-full" :loading="left_loding" tip="Loading..">
        <template #icon>
          <div class="flex justify-center">
            <svg class="arco-icon-loading" width="1em" height="1em" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M13.7998 5.85002C12.4998 5.45002 11.0998 5.50002 9.79984 6.00002C8.49984 6.50002 7.39984 7.35002 6.64984 8.50002C5.89984 9.65002 5.54984 11 5.59984 12.4C5.64984 13.8 6.19984 15.1 7.09984 16.15C7.99984 17.2 9.19984 17.95 10.5498 18.25C11.8998 18.55 13.2998 18.45 14.5498 17.85C15.4498 17.45 16.4998 17.85 16.8998 18.75C17.2998 19.65 16.8998 20.7 15.9998 21.1C14.0498 21.95 11.8498 22.2 9.74984 21.7C7.64984 21.2 5.74984 20.05 4.34984 18.45C2.99984 16.85 2.14984 14.8 1.99984 12.65C1.89984 10.5 2.44984 8.35002 3.59984 6.55002C4.79984 4.75002 6.49984 3.35002 8.54984 2.65002C10.5498 1.90002 12.7998 1.85002 14.8498 2.45002C16.8998 3.05002 18.7498 4.30002 19.9998 6.00002C21.2998 7.75002 21.9998 9.80002 21.9998 12C21.9998 13 21.1998 13.8 20.1998 13.8C19.1998 13.8 18.3998 13 18.3998 12C18.3998 10.6 17.9498 9.30002 17.1498 8.15002C16.2998 7.05002 15.1498 6.25002 13.7998 5.85002Z"
                fill="url(#svg_2fc1cd5fdf__paint0_linear_118545_226288)"></path>
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M13.7998 5.85002C12.4998 5.45002 11.0998 5.50002 9.79984 6.00002C8.49984 6.50002 7.39984 7.35002 6.64984 8.50002C5.89984 9.65002 5.54984 11 5.59984 12.4C5.64984 13.8 6.19984 15.1 7.09984 16.15C7.99984 17.2 9.19984 17.95 10.5498 18.25C11.8998 18.55 13.2998 18.45 14.5498 17.85C15.4498 17.45 16.4998 17.85 16.8998 18.75C17.2998 19.65 16.8998 20.7 15.9998 21.1C14.0498 21.95 11.8498 22.2 9.74984 21.7C7.64984 21.2 5.74984 20.05 4.34984 18.45C2.99984 16.85 2.14984 14.8 1.99984 12.65C1.89984 10.5 2.44984 8.35002 3.59984 6.55002C4.79984 4.75002 6.49984 3.35002 8.54984 2.65002C10.5498 1.90002 12.7998 1.85002 14.8498 2.45002C16.8998 3.05002 18.7498 4.30002 19.9998 6.00002C21.2998 7.75002 21.9998 9.80002 21.9998 12C21.9998 13 21.1998 13.8 20.1998 13.8C19.1998 13.8 18.3998 13 18.3998 12C18.3998 10.6 17.9498 9.30002 17.1498 8.15002C16.2998 7.05002 15.1498 6.25002 13.7998 5.85002Z"
                fill="url(#svg_2fc1cd5fdf__paint1_linear_118545_226288)"></path>
              <defs>
                <linearGradient id="svg_2fc1cd5fdf__paint0_linear_118545_226288" x1="13.215" y1="6.907" x2="10.715"
                  y2="16.282" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#1765FF"></stop>
                  <stop offset=".031" stop-color="#1765FF" stop-opacity=".969"></stop>
                  <stop offset="1" stop-color="#1765FF" stop-opacity="0"></stop>
                </linearGradient>
                <linearGradient id="svg_2fc1cd5fdf__paint1_linear_118545_226288" x1="-.574" y1="9.566" x2="18.802"
                  y2="13.316" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#ADC9FF"></stop>
                  <stop offset="1" stop-color="#8AB1FF" stop-opacity="0"></stop>
                </linearGradient>
              </defs>
            </svg>
          </div>
        </template>
        <div v-if="messages.length > 0" class="chat_list_message p-2">
          <ul class="chat-list mb-2">
            <div class="bot_info">
              <li class="online list-animation-bottomIn" :class="[
                ms_active == item[item.length - 1].session_id ? 'active' : '',
                'delay-' + index,
              ]" v-for="(item, index) in messages" :key="index">
                <div class="hover_action">
                  <a-space>
                    <icon-edit @click="change_sname(item[item.length - 1].session_id)" />
                    <a-popconfirm content="此操作将永久删除当前会话,确定要删除吗?" @ok="delete_msg(item[item.length - 1].session_id)"
                      type="warning">
                      <icon-delete />
                    </a-popconfirm>
                  </a-space>
                </div>
                <div class="card bg-boli mb-2" @click="check_message(item[item.length - 1].session_id)">
                  <div class="card-body">

                    <div class="media">

                      <div class="avatar me-3">
                        <a-avatar v-if="item[item.length - 1].icon" @click="send_avatar()" shape="square"
                          :imageUrl="item[item.length - 1].icon">
                        </a-avatar>
                        <a-avatar @click="send_avatar()" v-else>
                          <img :src="counter.setting.ai_chat_normal" alt="" />
                        </a-avatar>
                      </div>
                      <div class="media-body overflow-hidden">
                        <div class="d-flex align-items-center mb-1">
                          <h6 class="text-truncate mb-0 me-auto" v-if="item[item.length - 1].message_b">
                            {{ item[item.length - 1].message_b }}
                          </h6>
                          <h6 class="text-truncate mb-0 me-auto" v-else>
                            {{
                              item[item.length - 1].question
                                ? item[item.length - 1].question
                                : "新会话"
                            }}
                          </h6>
                        </div>
                        <div class="text-truncate h-20" v-html="item[item.length - 1].message
                          ? item[item.length - 1].message.replace(
                            /\n/g,
                            '<br />'
                          )
                          : '暂无消息'
                          "></div>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            </div>
          </ul>
          <a-modal v-model:visible="avatar_select" title="头像预设" :footer="false">
            <div class="avatar_preset" v-if="all_avatar_preset.length > 0">
              <a-space class="flex-wrap justify-between">
                <a-avatar class="cursor-pointer" :size="64" v-for="(a_item, a_index) in all_avatar_preset"
                  :imageUrl="a_item.avatar" width="200" @click="change_avatar(a_item.id)" />
              </a-space>
            </div>
            <a-empty v-else></a-empty>
          </a-modal>
        </div>
        <a-empty class="message_empty" v-else />
        <a-pagination size="small" :total="ms_count" :current="page" :page-size="limit"
          class="justify-content-center mb-2" background simple @change="handleCurrentChange"
          :hide-on-single-page="true" />
      </a-spin> -->




        <a-modal v-model:visible="beizhu_info" title="修改备注" @ok="handle_send">
          <a-input v-model="beizhu" placeholder="修改备注名称" />
        </a-modal>


        <!-- <client-only>
        <div class="border-t dark:border-t-neutral-800">
          <div class="p-2 bg-n-6 rounded-xl">
            <a-trigger :trigger="['click', 'hover', 'focus']" v-if="token">
              <div class="flex items-center px-2.5 py-2.5 pb-4.5">
                <div class="relative w-10 h-10">
                  <a-avatar :imageUrl="user_info.avatar" class="rounded-full w-10 h-10">
                  </a-avatar>
                  <div
                    class="absolute -right-0.75 -bottom-0.75 w-4.5 h-4.5 rounded-full border-4 border-n-6 bg-green-300 top-1 border-green-300">
                  </div>
                </div>
                <div class="ml-1 mr-2">
                  <div class="base2 font-semibold text-n-1 text-truncate">
                    {{ user_info.name ? user_info.name : "未登录" }}
                  </div>
                  <div class="caption1 font-semibold text-n-3/50 text-truncate">
                    {{ counter.setting.money_name_set }}:{{ user_info.money }}
                  </div>
                </div>
                <div
                  class="shrnik-0 ml-auto self-start px-2 bg-primary-2 rounded-lg caption1 font-bold text-n-7 pack_tag_vip">
                  {{ vip_level }}
                </div>
              </div>
              <template #content>
                <div class="nav-wraper">
                  <div class="user-info-box">
                    <div class="user-dis">
                      <a-avatar>
                        <img :src="user_info.avatar" alt="avatar" class="rounded-full w-10 h-10" />
                      </a-avatar>
                      <span class="nickname flex-wrap ml-1">
                        <span>{{ user_info.name }}</span>
                        <div class="shrnik-0 px-3 bg-primary-2 rounded-lg caption1 font-bold text-n-7 pack_tag_vip">
                          {{ vip_level }}
                        </div>
                      </span>
                    </div>
                    <div class="use-info user-type">
                      <span class="number">问答 </span>
                      <div class="limit_information flex flex-col">
                        <div class="limit_bag">
                          <span>{{ user_qs }}次</span>
                          <a-tag class="ml-1" color="#165dff" size="small">次数包</a-tag>
                        </div>
                        <div class="day_bag">
                          <span>{{ last_msg }}/{{ total_msg }}次 </span>
                          <a-tag class="ml-1" color="#165dff" size="small">{{
                            check_vip_type(vip_type)
                          }}</a-tag>
                        </div>
                      </div>
                    </div>
                    <div class="use-info user-type">
                      <span class="number">绘画 </span>
                      <div class="limit_information flex flex-col">
                        <div class="limit_bag">
                          <span>{{ user_draw }}次</span>
                          <a-tag class="ml-1" color="#165dff" size="small">次数包</a-tag>
                        </div>
                        <div class="day_bag">
                          <span>{{ last_draw }}/{{ total_draw }}次 </span>
                          <a-tag class="ml-1" color="#165dff" size="small">{{
                            check_vip_type(vip_type)
                          }}</a-tag>
                        </div>
                      </div>
                    </div>
                    <div class="use-info">
                      <span class="number">{{
                        counter.setting.money_name_set
                      }}</span><span>{{ user_info.money }}</span>
                    </div>
                    <div class="quit" @click="quit_out()">
                      <div name="quit" class="i-svg quit-icon-blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <g id="Group 1000007605">
                            <rect id="Rectangle 10" x="15.0001" y="9.41418" width="2" height="6" rx="1"
                              transform="rotate(-45 15.0001 9.41418)" fill="#057cff"></rect>
                            <rect id="Rectangle 11" x="19.2427" y="10.8284" width="2" height="6" rx="1"
                              transform="rotate(45 19.2427 10.8284)" fill="#057cff"></rect>
                            <rect id="Rectangle 12" x="19" y="11" width="2" height="11" rx="1"
                              transform="rotate(90 19 11)" fill="#057cff"></rect>
                            <path id="Rectangle 11218"
                              d="M17 3H7C5.89543 3 5 3.89543 5 5V19C5 20.1046 5.89543 21 7 21H17" stroke="#057cff"
                              stroke-width="2" stroke-linecap="round"></path>
                          </g>
                        </svg>
                      </div>
                      退出登录
                    </div>
                  </div>
                </div>
              </template>
            </a-trigger>
            <div class="flex items-center px-2.5 py-2.5 pb-4.5" v-else>
              <div class="relative w-10 h-10">
                <a-avatar :style="{ backgroundColor: '#3370ff' }">
                  <IconUser />
                </a-avatar>
                <div
                  class="absolute -right-0.75 -bottom-0.75 w-4.5 h-4.5 rounded-full border-4 border-n-6 bg-green-300 top-1 border-green-300">
                </div>
              </div>
              <div class="ml-1 mr-2">
                <div class="base2 font-semibold text-n-1 text-truncate">
                  请先登录
                </div>
              </div>
              <div
                class="shrnik-0 ml-auto self-start px-3 bg-primary-2 rounded-lg caption1 font-bold text-n-7 pack_tag_vip">
                {{ vip_level }}
              </div>
            </div>

            <a-button @click="login_dialog_click()" class="w-full" v-if="!token">
              用户登录
            </a-button>
            <a-button class="w-full" v-else @click="charge()">
              <div v-if="counter.setting.show_limit_front == '1'">
                VIP剩余
                <a-tag color="arcoblue" class="ml-1 mr-1"> {{ last_msg }}</a-tag>次问答
              </div>
              <div v-else>升级会员</div>
            </a-button>
          </div>
        </div>
      </client-only> -->




      </div>

      <div class="bg-white pt-6 pb-2 px-[22px] mt-2 rounded-2xl  shadow-2xl shadow-[#1F20220D]">
        <div class="flex items-center justify-center gap-[10px] py-1.5 rounded-full bg-[#55575D33] cursor-pointer">
          <span class="text-[#191A1C] tex-[13px] font-semibold">Personal Center</span>
          <svg width="20" height="15" viewBox="0 0 20 15" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M10.7498 10.3189C11.7296 9.70871 12.484 8.79599 12.8988 7.71885C13.3136 6.64171 13.3664 5.45877 13.049 4.34899C12.7317 3.23921 12.0615 2.26298 11.1399 1.56799C10.2184 0.873002 9.0955 0.49707 7.94124 0.49707C6.78698 0.49707 5.66412 0.873002 4.74254 1.56799C3.82097 2.26298 3.15081 3.23921 2.83347 4.34899C2.51612 5.45877 2.56885 6.64171 2.98369 7.71885C3.39852 8.79599 4.15288 9.70871 5.13265 10.3189C3.51936 10.8471 2.0678 11.8338 0.900614 13.2229C0.845927 13.2854 0.804255 13.3582 0.778037 13.437C0.751818 13.5159 0.741578 13.5991 0.747915 13.682C0.754252 13.7648 0.77704 13.8455 0.814945 13.9195C0.852851 13.9934 0.905113 14.059 0.968677 14.1125C1.03224 14.166 1.10583 14.2063 1.18515 14.231C1.26446 14.2557 1.3479 14.2643 1.4306 14.2564C1.5133 14.2485 1.59359 14.2242 1.66678 14.1849C1.73997 14.1456 1.80459 14.0921 1.85686 14.0275C3.42561 12.1557 5.58655 11.1252 7.93733 11.1252C10.2881 11.1252 12.4491 12.1557 14.0209 14.0275C14.1276 14.1546 14.2804 14.234 14.4457 14.2483C14.611 14.2627 14.7752 14.2108 14.9022 14.1041C15.0292 13.9974 15.1086 13.8446 15.123 13.6793C15.1373 13.5141 15.0854 13.3499 14.9787 13.2229C13.8108 11.8338 12.3592 10.8471 10.7498 10.3189ZM3.87483 5.81269C3.87483 5.00921 4.11309 4.22377 4.55949 3.55569C5.00588 2.88762 5.64036 2.36691 6.38268 2.05943C7.12501 1.75195 7.94184 1.6715 8.72989 1.82825C9.51793 1.98501 10.2418 2.37192 10.81 2.94007C11.3781 3.50822 11.765 4.23209 11.9218 5.02014C12.0785 5.80819 11.9981 6.62502 11.6906 7.36735C11.3831 8.10967 10.8624 8.74415 10.1943 9.19054C9.52626 9.63693 8.74082 9.87519 7.93733 9.87519C6.86027 9.87395 5.82768 9.44554 5.06608 8.68395C4.30448 7.92235 3.87607 6.88976 3.87483 5.81269ZM19.2069 9.17754L18.8428 8.96738C18.8855 8.74126 18.8855 8.50913 18.8428 8.28301L19.2069 8.07285C19.278 8.03181 19.3403 7.97717 19.3903 7.91205C19.4402 7.84693 19.4769 7.7726 19.4982 7.69331C19.5194 7.61401 19.5249 7.53131 19.5141 7.44992C19.5034 7.36853 19.4768 7.29004 19.4358 7.21894C19.3947 7.14785 19.3401 7.08553 19.275 7.03555C19.2098 6.98556 19.1355 6.9489 19.0562 6.92764C18.9769 6.90639 18.8942 6.90096 18.8128 6.91166C18.7314 6.92237 18.653 6.949 18.5819 6.99004L18.217 7.20098C18.0424 7.05118 17.8417 6.9349 17.6248 6.85801V6.43769C17.6248 6.27193 17.559 6.11296 17.4418 5.99575C17.3246 5.87854 17.1656 5.81269 16.9998 5.81269C16.8341 5.81269 16.6751 5.87854 16.5579 5.99575C16.4407 6.11296 16.3748 6.27193 16.3748 6.43769V6.85801C16.158 6.9349 15.9572 7.05118 15.7826 7.20098L15.4178 6.99004C15.3467 6.949 15.2682 6.92237 15.1868 6.91166C15.1054 6.90096 15.0227 6.90639 14.9434 6.92764C14.8641 6.9489 14.7898 6.98556 14.7247 7.03555C14.6596 7.08553 14.6049 7.14785 14.5639 7.21894C14.5229 7.29004 14.4962 7.36853 14.4855 7.44992C14.4748 7.53131 14.4802 7.61401 14.5015 7.69331C14.5228 7.7726 14.5594 7.84693 14.6094 7.91205C14.6594 7.97717 14.7217 8.03181 14.7928 8.07285L15.1569 8.28301C15.1142 8.50913 15.1142 8.74126 15.1569 8.96738L14.7928 9.17754C14.7217 9.21858 14.6594 9.27322 14.6094 9.33834C14.5594 9.40346 14.5228 9.47779 14.5015 9.55708C14.4802 9.63638 14.4748 9.71908 14.4855 9.80047C14.4962 9.88186 14.5229 9.96035 14.5639 10.0314C14.6049 10.1025 14.6596 10.1649 14.7247 10.2148C14.7898 10.2648 14.8641 10.3015 14.9434 10.3227C15.0227 10.344 15.1054 10.3494 15.1868 10.3387C15.2682 10.328 15.3467 10.3014 15.4178 10.2604L15.7826 10.0494C15.9572 10.1992 16.158 10.3155 16.3748 10.3924V10.8127C16.3748 10.9785 16.4407 11.1374 16.5579 11.2546C16.6751 11.3718 16.8341 11.4377 16.9998 11.4377C17.1656 11.4377 17.3246 11.3718 17.4418 11.2546C17.559 11.1374 17.6248 10.9785 17.6248 10.8127V10.3924C17.8417 10.3155 18.0424 10.1992 18.217 10.0494L18.5819 10.2604C18.6768 10.3154 18.7846 10.3443 18.8944 10.3439C19.032 10.344 19.1658 10.2986 19.275 10.2149C19.3842 10.1311 19.4627 10.0136 19.4983 9.88069C19.5339 9.74775 19.5247 9.60677 19.472 9.47963C19.4193 9.35249 19.3261 9.2463 19.2069 9.17754ZM16.3748 8.62519C16.3748 8.50158 16.4115 8.38074 16.4802 8.27796C16.5488 8.17518 16.6465 8.09507 16.7607 8.04777C16.8749 8.00047 17.0005 7.98809 17.1218 8.0122C17.243 8.03632 17.3544 8.09584 17.4418 8.18325C17.5292 8.27066 17.5887 8.38202 17.6128 8.50326C17.6369 8.6245 17.6246 8.75017 17.5773 8.86437C17.53 8.97858 17.4498 9.07619 17.3471 9.14486C17.2443 9.21354 17.1234 9.25019 16.9998 9.25019C16.8341 9.25019 16.6751 9.18435 16.5579 9.06714C16.4407 8.94993 16.3748 8.79096 16.3748 8.62519Z"
              fill="#1F2022" />
          </svg>


        </div>
        <div class="flex gap-3 mt-6">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 9V16.5H3V9" stroke="black" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M16.5 5.25H1.5V9H16.5V5.25Z" stroke="black" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M9 16.5V5.25" stroke="black" stroke-linecap="round" stroke-linejoin="round" />
            <path
              d="M9 5.25H12.375C12.8723 5.25 13.3492 5.05246 13.7008 4.70083C14.0525 4.34919 14.25 3.87228 14.25 3.375C14.25 2.87772 14.0525 2.40081 13.7008 2.04917C13.3492 1.69754 12.8723 1.5 12.375 1.5C9.75 1.5 9 5.25 9 5.25Z"
              stroke="black" stroke-linecap="round" stroke-linejoin="round" />
            <path
              d="M9 5.25H5.625C5.12772 5.25 4.65081 5.05246 4.29917 4.70083C3.94754 4.34919 3.75 3.87228 3.75 3.375C3.75 2.87772 3.94754 2.40081 4.29917 2.04917C4.65081 1.69754 5.12772 1.5 5.625 1.5C8.25 1.5 9 5.25 9 5.25Z"
              stroke="black" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <span class="text=[#757877] font-normal text-[13px] ">Enjoy more access and <br /> prvilleges</span>
          <span class="text-[#191A1C] font-semibold">Upgrade</span>

        </div>
      </div>

    </div>




    <div class="main">
      <a-spin :loading="loadins" tip="记录加载loading..">
        <template #icon>
          <div class="flex justify-center">
            <svg class="arco-icon-loading" width="1em" height="1em" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M13.7998 5.85002C12.4998 5.45002 11.0998 5.50002 9.79984 6.00002C8.49984 6.50002 7.39984 7.35002 6.64984 8.50002C5.89984 9.65002 5.54984 11 5.59984 12.4C5.64984 13.8 6.19984 15.1 7.09984 16.15C7.99984 17.2 9.19984 17.95 10.5498 18.25C11.8998 18.55 13.2998 18.45 14.5498 17.85C15.4498 17.45 16.4998 17.85 16.8998 18.75C17.2998 19.65 16.8998 20.7 15.9998 21.1C14.0498 21.95 11.8498 22.2 9.74984 21.7C7.64984 21.2 5.74984 20.05 4.34984 18.45C2.99984 16.85 2.14984 14.8 1.99984 12.65C1.89984 10.5 2.44984 8.35002 3.59984 6.55002C4.79984 4.75002 6.49984 3.35002 8.54984 2.65002C10.5498 1.90002 12.7998 1.85002 14.8498 2.45002C16.8998 3.05002 18.7498 4.30002 19.9998 6.00002C21.2998 7.75002 21.9998 9.80002 21.9998 12C21.9998 13 21.1998 13.8 20.1998 13.8C19.1998 13.8 18.3998 13 18.3998 12C18.3998 10.6 17.9498 9.30002 17.1498 8.15002C16.2998 7.05002 15.1498 6.25002 13.7998 5.85002Z"
                fill="url(#svg_2fc1cd5fdf__paint0_linear_118545_226288)"></path>
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M13.7998 5.85002C12.4998 5.45002 11.0998 5.50002 9.79984 6.00002C8.49984 6.50002 7.39984 7.35002 6.64984 8.50002C5.89984 9.65002 5.54984 11 5.59984 12.4C5.64984 13.8 6.19984 15.1 7.09984 16.15C7.99984 17.2 9.19984 17.95 10.5498 18.25C11.8998 18.55 13.2998 18.45 14.5498 17.85C15.4498 17.45 16.4998 17.85 16.8998 18.75C17.2998 19.65 16.8998 20.7 15.9998 21.1C14.0498 21.95 11.8498 22.2 9.74984 21.7C7.64984 21.2 5.74984 20.05 4.34984 18.45C2.99984 16.85 2.14984 14.8 1.99984 12.65C1.89984 10.5 2.44984 8.35002 3.59984 6.55002C4.79984 4.75002 6.49984 3.35002 8.54984 2.65002C10.5498 1.90002 12.7998 1.85002 14.8498 2.45002C16.8998 3.05002 18.7498 4.30002 19.9998 6.00002C21.2998 7.75002 21.9998 9.80002 21.9998 12C21.9998 13 21.1998 13.8 20.1998 13.8C19.1998 13.8 18.3998 13 18.3998 12C18.3998 10.6 17.9498 9.30002 17.1498 8.15002C16.2998 7.05002 15.1498 6.25002 13.7998 5.85002Z"
                fill="url(#svg_2fc1cd5fdf__paint1_linear_118545_226288)"></path>
              <defs>
                <linearGradient id="svg_2fc1cd5fdf__paint0_linear_118545_226288" x1="13.215" y1="6.907" x2="10.715"
                  y2="16.282" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#1765FF"></stop>
                  <stop offset=".031" stop-color="#1765FF" stop-opacity=".969"></stop>
                  <stop offset="1" stop-color="#1765FF" stop-opacity="0"></stop>
                </linearGradient>
                <linearGradient id="svg_2fc1cd5fdf__paint1_linear_118545_226288" x1="-.574" y1="9.566" x2="18.802"
                  y2="13.316" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#ADC9FF"></stop>
                  <stop offset="1" stop-color="#8AB1FF" stop-opacity="0"></stop>
                </linearGradient>
              </defs>
            </svg>
          </div>
        </template>
        <div class="chat-body relative" :style="chat_bg_cookie
          ? {
            background: 'url(' + chat_bg_cookie + ') no-repeat',
            'background-size': 'cover',
          }
          : ''
          ">
          <div class="circle-info z-0">
            <ul class="circles ">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>







          <!-- old navbar -->
          <!-- <div class=" z-10 border-bottom md:py-3 sm:py-3 py-2 bg-[#f8f8f8]">
            <div class="container-xxl">
              <div class="row align-items-center">
                <div class="col-6 col-xl-4 d-flex">
                  <button @click="change_side()" class="mr-2 sidebar-toggle-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M2.5 5L5 5L5 2.5L2.5 2.5L2.5 5ZM5 11.25L2.5 11.25L2.5 8.75L5 8.75L5 11.25ZM17.5 11.25L15 11.25L15 8.75L17.5 8.75L17.5 11.25ZM8.75 11.25L11.25 11.25L11.25 8.75L8.75 8.75L8.75 11.25ZM5 17.5L2.5 17.5L2.5 15L5 15L5 17.5ZM15 17.5L17.5 17.5L17.5 15L15 15L15 17.5ZM11.25 17.5L8.75 17.5L8.75 15L11.25 15L11.25 17.5ZM17.5 5L15 5L15 2.5L17.5 2.5L17.5 5ZM8.75 5L11.25 5L11.25 2.5L8.75 2.5L8.75 5Z"
                        fill="currentColor"></path>
                    </svg>
                  </button>
                  <div class="media align-items-center">
                    <div class="show-user-detail" v-if="ms_active == 0">
                      <a-avatar class="mr-2">
                        <img :src="counter.setting.ai_chat_normal" alt="avatar" class="rounded-full w-100" />
                      </a-avatar>
                    </div>
                    <div class="show-user-detail relative" v-else>
                      <a-avatar class="mr-2">
                        <img v-if="
                          me_message &&
                          me_message[0] &&
                          me_message[0].icon != null
                        " :src="me_message[0].icon" alt="avatar" class="rounded-full w-100" />
                        <img v-else :src="counter.setting.ai_chat_normal" alt="avatar" class="rounded-full w-100" />
                        <a-tag color="arcoblue" style="border-radius: 50%" class="absolute left-5 bottom-6"
                          v-if="me_message.length > 0">
                          {{ me_message.length * 2 }}
                        </a-tag>
                      </a-avatar>
                    </div>
                    <div class="media-body overflow-hidden">
                      <div class="d-flex align-items-center mb-1">
                      
                        <h6 class="text-truncate mb-0 me-auto" v-if="ms_active == 0">
                          {{ counter.setting.bot_name }}
                        </h6>
                        <h6 class="mobile_width_5rem text-truncate mb-0 me-auto w-40" v-if="me_message.length > 0">
                          {{
                            me_message[0].question
                              ? me_message[0].question
                              : "新会话"
                          }}
                        </h6>
                      </div>
                      <div class="text-truncate">
                        <a-space>
                          <a-tag color="arcoblue" class="cursor-pointer" @click="dialog_scene = true">
                            <template #icon>
                              <icon-code />
                            </template>
                            预设配置
                          </a-tag>

                          <a-dropdown @select="handleSelect" :popup-max-height="false">
                            <a-tag color="green" class="cursor-pointer">{{
                              now_model_title
                              }}</a-tag>
                            <template #content>
                              <div>
                                <a-tooltip v-for="(n_mod, n_mod_index) in model_list" :key="n_mod_index"
                                  position="right" :content="n_mod?.tips ? n_mod.tips : '暂无'">
                                  <a-doption :value="n_mod.id">{{ n_mod.title }}</a-doption>
                                </a-tooltip>

                              </div>
                            </template>
                          </a-dropdown>
                        </a-space>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-6 col-xl-8 text-end">
                  <ul class="nav justify-content-end align-items-center mobile_show mobile_show_flex">
                    <li class="nav-item list-inline-item d-md-block">
                      <client-only>
                        <a-dropdown>
                          <svg t="1695103719913" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="49910" width="26" height="26">
                            <path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#EBF4FF"
                              p-id="49911"></path>
                            <path
                              d="M705.365333 413.312a22.528 22.528 0 0 0-20.010666-17.493333H338.816a22.528 22.528 0 0 0-20.010667 17.493333 34.773333 34.773333 0 0 0 4.736 30.890667l173.141334 227.114666a19.626667 19.626667 0 0 0 15.317333 8.533334 19.370667 19.370667 0 0 0 15.317333-8.533334l173.226667-227.114666a35.072 35.072 0 0 0 4.821333-30.890667z m0 0"
                              fill="#417FF9" p-id="49912"></path>
                          </svg>

                          <template #content>
                            <a-doption>
                              <a @click="change_theme('dark')" data-toggle="pill" v-if="colorMode.preference == 'light'"
                                class="text-gray-400" href="javascript:;">
                                <svg t="1685290472155" fill="#9ca3af" class="icon arco-icon" viewBox="0 0 1024 1024"
                                  version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1521" width="26" height="26">
                                  <path
                                    d="M512.8 806.6c-162.2 0-293.8-131.8-293.8-293.8s131.8-293.8 293.8-293.8 293.8 131.8 293.8 293.8-131.6 293.8-293.8 293.8z m0-526.8c-128.4 0-233 104.6-233 233s104.6 233 233 233 233-104.6 233-233-104.6-233-233-233zM512.8 957c-22.2 0-40.6-16.6-40.6-39v-3.2c0-22.2 18.2-40.6 40.6-40.6s40.6 18.2 40.6 40.6-18.2 42.2-40.6 42.2z m289.4-114.2c-10.6 0-20.6-4-28.8-11.8l-5.2-5.2c-15.8-15.8-15.8-41.4 0-57.2 15.8-15.8 41.4-15.8 57.2 0l5.2 5.2c15.8 15.8 15.8 41.4 0 57.2-7.8 7.6-17.8 11.8-28.4 11.8z m-578.8 0c-10.6 0-20.6-4-28.8-11.8-15.8-15.8-15.8-41.4 0-57.2l5.2-5.2c15.8-15.8 41.4-15.8 57.2 0s15.8 41.4 0 57.2l-5.2 5.2c-7.6 7.6-18.2 11.8-28.4 11.8zM918 553.4h-3.2c-22.2 0-40.6-18.2-40.6-40.6s18.2-40.6 40.6-40.6 42.2 18.2 42.2 40.6-16.6 40.6-39 40.6z m-807.2 0h-3.2c-22.2 0-40.6-18.2-40.6-40.6s18.2-40.6 40.6-40.6 42.2 18.2 42.2 40.6-16.8 40.6-39 40.6z m686.2-284.2c-10.6 0-20.6-4-28.8-11.8-15.8-15.8-15.8-41.4 0-57.2l5.2-5.2c15.8-15.8 41.4-15.8 57.2 0s15.8 41.4 0 57.2l-5.2 5.2c-7.8 7.8-18 11.8-28.4 11.8z m-568.2 0c-10.6 0-20.6-4-28.8-11.8l-5.2-5.6c-15.8-15.8-15.8-41.4 0-57.2s41.4-15.8 57.2 0l5.2 5.2c15.8 15.8 15.8 41.4 0 57.2-7.8 8.2-18.4 12.2-28.4 12.2z m284-119.6c-22.2 0-40.6-16.6-40.6-39v-3.2c0-22.2 18.2-40.6 40.6-40.6s40.6 18.2 40.6 40.6-18.2 42.2-40.6 42.2z"
                                    p-id="1522"></path>
                                </svg>

                                白天模式
                              </a>
                              <a @click="change_theme('light')" data-toggle="pill" v-if="colorMode.preference == 'dark'"
                                class="text-gray-400" href="javascript:;">
                                <svg t="1685290466829" fill="#9ca3af" class="icon arco-icon" viewBox="0 0 1024 1024"
                                  version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9095" width="26" height="26">
                                  <path
                                    d="M544.2 957c-7 0-14 0-21.2-0.4C291.2 946.2 97.6 759.6 81.4 532c-14-195.4 99-378 281-454.4 51.8-21.6 79-5 90.6 7 11.6 11.6 27.8 38.4 6.2 87.8-19 43.8-28.6 90.6-28.2 138.6 0.8 183.4 153.2 339 339 346.4 27 1.2 53.4-0.8 79-5.4 54.6-10 77.4 12 86 26 8.6 14 18.6 44.2-14.4 89-87.6 120-227 190-376.4 190zM143 527.4c14 197 182.2 358.4 382.4 367.2 136.2 6.6 265.4-55.4 344.8-164 6.2-8.6 9.2-15 10.4-18.2-3.8-0.4-10.4-0.8-20.6 1.2-30.2 5.4-61.6 7.4-92.8 6.2-218.6-8.6-397.4-192-398.6-408.2 0-57.2 11.2-112.2 34-164 4.2-9.2 5-15.4 5.4-18.6-3.8 0-10.4 0.8-21.2 5.4-157.6 66.4-255.4 224.4-243.8 393z"
                                    p-id="9096"></path>
                                </svg>

                                黑夜模式
                              </a>
                            </a-doption>
                            <a-doption>

                              <a @click="notice = true" data-toggle="pill" class="text-gray-400" href="javascript:;">
                                <icon-notification class="fs-6 align-text-bottom" />
                                公告信息
                              </a>
                            </a-doption>

                            <a-doption v-if="ms_active != 0">
                              <a @click="img_download = true" data-toggle="pill" class="text-gray-400"
                                href="javascript:;">
                                <icon-download class="fs-6 align-text-bottom" />
                                导出记录
                              </a>
                            </a-doption>
                            <a-doption>
                              <a @click="check_message(ms_active)" class="text-gray-400" data-toggle="pill"
                                href="javascript:;">
                                <icon-refresh class="fs-6 align-text-bottom" />
                                刷新对话
                              </a>
                            </a-doption>

                            <a-doption>
                              <a v-if="token" @click="charge()" class="text-gray-400" data-toggle="pill"
                                href="javascript:;">
                                <icon-command class="fs-6 align-text-bottom" />
                                充值{{ counter.setting.money_name_set }}</a>
                              <a v-else @click="login_dialog_click()" class="text-gray-400" data-toggle="pill"
                                href="javascript:;">
                                <icon-command class="fs-6 align-text-bottom" />充值{{ counter.setting.money_name_set
                                }}</a>
                            </a-doption>
                          </template>
                        </a-dropdown>
                      </client-only>
                    </li>
                  </ul>
                  <ul class="nav justify-content-end align-items-center mobile_none">
                    <li class="nav-item list-inline-item d-md-block me-2">
                      <a-tooltip class="box-item" effect="dark" content="公告信息" placement="bottom">

                        <button @click="notice = true" class="chat-header-tool-btn" data-toggle="pill"
                          href="javascript:;">
                          <icon-notification class="fs-6" />
                        </button>
                      </a-tooltip>
                    </li>
                    <li class="nav-item list-inline-item d-md-block me-2" v-if="ms_active != 0">
                      <a-tooltip class="box-item" effect="dark" content="保存当前聊天" placement="bottom">
                        <button @click="img_download = true" class="chat-header-tool-btn" data-toggle="pill"
                          href="javascript:;">
                          <icon-download class="fs-6 align-text-bottom" />
                        </button>
                      </a-tooltip>
                    </li>
                    <li class="nav-item list-inline-item d-md-block me-2">
                      <a-tooltip class="box-item" effect="dark" content="刷新当前聊天" placement="bottom">
                        <button @click="check_message(ms_active)" class="chat-header-tool-btn" data-toggle="pill"
                          href="javascript:;">
                          <icon-refresh class="fs-6 align-text-bottom" />
                        </button>
                      </a-tooltip>
                    </li>
                    <li class="nav-item list-inline-item d-md-block me-2">
                      <a-tooltip class="box-item" effect="dark" content="充值" placement="bottom">
                        <button v-if="token" @click="charge()" class="chat-header-tool-btn" data-toggle="pill"
                          href="javascript:;">
                          <icon-command class="fs-6 align-text-bottom" />
                        </button>
                        <button v-else @click="login_dialog_click()" class="chat-header-tool-btn" data-toggle="pill"
                          href="javascript:;">
                          <icon-command class="fs-6 align-text-bottom" />
                        </button>
                      </a-tooltip>
                    </li>
                    <li class="nav-item list-inline-item d-md-block me-2">
                      <a-trigger trigger="click" show-arrow v-if="counter.setting.chat_bg_open == '1'">
                        <button class="chat-header-tool-btn" data-toggle="pill" href="javascript:;">
                          <icon-image class="fs-6 align-text-bottom" />
                        </button>
                        <template #content>
                          <div class="image-chat text-center bg-white w-100 box-shadow">
                            <div>
                              <a-image @click="bg_change(img.background_image)" :preview-visible="false"
                                class="m-2 cursor-pointer box-shadow-sm border" :src="img.background_image" width="200"
                                height="100" v-for="(img, index) in chat_bg" :key="index"></a-image>
                            </div>
                            <a-button @click="remove_bg()" class="mb-2">清除背景图</a-button>
                          </div>
                        </template>
                      </a-trigger>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div> -->









         
          <div class="z-10 border-bottom md:py-3 sm:py-3 py-2 bg-[#f8f8f8] flex items-center  px-2 w-full">
            <div v-if="!chat_open" @click="chat_open = !chat_open" class="cursor-pointer z-10 justify-start"><svg width="24" height="24"
              viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M20.25 3.75H3.75C3.35218 3.75 2.97064 3.90804 2.68934 4.18934C2.40804 4.47064 2.25 4.85218 2.25 5.25V18.75C2.25 19.1478 2.40804 19.5294 2.68934 19.8107C2.97064 20.092 3.35218 20.25 3.75 20.25H20.25C20.6478 20.25 21.0294 20.092 21.3107 19.8107C21.592 19.5294 21.75 19.1478 21.75 18.75V5.25C21.75 4.85218 21.592 4.47064 21.3107 4.18934C21.0294 3.90804 20.6478 3.75 20.25 3.75ZM3.75 14.25H5.25C5.44891 14.25 5.63968 14.171 5.78033 14.0303C5.92098 13.8897 6 13.6989 6 13.5C6 13.3011 5.92098 13.1103 5.78033 12.9697C5.63968 12.829 5.44891 12.75 5.25 12.75H3.75V11.25H5.25C5.44891 11.25 5.63968 11.171 5.78033 11.0303C5.92098 10.8897 6 10.6989 6 10.5C6 10.3011 5.92098 10.1103 5.78033 9.96967C5.63968 9.82902 5.44891 9.75 5.25 9.75H3.75V8.25H5.25C5.44891 8.25 5.63968 8.17098 5.78033 8.03033C5.92098 7.88968 6 7.69891 6 7.5C6 7.30109 5.92098 7.11032 5.78033 6.96967C5.63968 6.82902 5.44891 6.75 5.25 6.75H3.75V5.25H7.5V18.75H3.75V14.25ZM20.25 18.75H9V5.25H20.25V18.75Z"
                fill="#1F2022" />
            </svg>
          </div>
          <div class="flex items-center justify-end  w-full gap-[15rem]">
            <div class="bg-white px-2 flex items-center rounded-lg  py-1">

              <span>Model 1.0</span>
              <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.3999 4.86084L6.51082 8.74993C6.51082 8.74993 3.79533 6.03445 2.62173 4.86084"
                  stroke="#3A3E42" />
              </svg>
            </div>
            <div class="flex items-center justify-end gap-10 bg-white rounded-full px-2 py-1">
              <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M14 1.25C6.95837 1.25 1.25 6.95837 1.25 14C1.25 21.0416 6.95837 26.75 14 26.75C21.0416 26.75 26.75 21.0416 26.75 14C26.75 6.95837 21.0416 1.25 14 1.25Z"
                  stroke="#1F2022" stroke-width="1.5" />
                <path
                  d="M9.1263 19.112C8.09964 19.112 7.2363 18.902 6.5363 18.482C5.8363 18.0527 5.30897 17.46 4.9543 16.704C4.59964 15.948 4.4223 15.0707 4.4223 14.072C4.4223 13.0733 4.6043 12.1913 4.9683 11.426C5.3323 10.6607 5.8643 10.0633 6.5643 9.634C7.2643 9.19533 8.1183 8.976 9.1263 8.976C9.87297 8.976 10.531 9.102 11.1003 9.354C11.6696 9.606 12.1316 9.96533 12.4863 10.432C12.8503 10.8893 13.0836 11.454 13.1863 12.126H11.4923C11.3616 11.65 11.0956 11.2767 10.6943 11.006C10.293 10.7353 9.7703 10.6 9.1263 10.6C8.42631 10.6 7.86164 10.7633 7.43231 11.09C7.00297 11.4167 6.6903 11.8367 6.4943 12.35C6.30764 12.8633 6.2143 13.414 6.2143 14.002C6.2143 14.6087 6.3123 15.178 6.5083 15.71C6.71364 16.242 7.03564 16.6713 7.4743 16.998C7.91297 17.3247 8.47764 17.488 9.1683 17.488C9.59764 17.488 9.97097 17.4273 10.2883 17.306C10.615 17.1847 10.8856 17.012 11.1003 16.788C11.3243 16.5547 11.4783 16.284 11.5623 15.976H13.3403C13.2283 16.6387 12.9763 17.2033 12.5843 17.67C12.2016 18.1367 11.7116 18.496 11.1143 18.748C10.5263 18.9907 9.86364 19.112 9.1263 19.112ZM14.9214 19V9.102H16.6714V13.33H21.2914V9.102H23.0274V19H21.2914V14.926H16.6714V19H14.9214Z"
                  fill="#1F2022" />
              </svg>

              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M21.7563 17.5087C22.2746 16.4338 22.5289 15.2508 22.4981 14.058C22.4673 12.8651 22.1523 11.6968 21.5793 10.6501C21.0063 9.60341 20.1918 8.70854 19.2036 8.03984C18.2153 7.37113 17.0817 6.94789 15.897 6.80527C15.5028 5.88873 14.9297 5.06007 14.2112 4.36779C13.4928 3.67551 12.6434 3.13353 11.7129 2.7736C10.7823 2.41367 9.78936 2.24302 8.79206 2.27164C7.79476 2.30026 6.81319 2.52758 5.90484 2.94028C4.99649 3.35298 4.17961 3.94277 3.50204 4.67511C2.82447 5.40745 2.29982 6.26762 1.95883 7.20525C1.61784 8.14288 1.46735 9.13912 1.51619 10.1356C1.56502 11.1321 1.81219 12.1089 2.24322 13.0087L1.56165 15.3253C1.48545 15.5839 1.48035 15.8582 1.5469 16.1195C1.61345 16.3808 1.74919 16.6193 1.93983 16.8099C2.13047 17.0005 2.36896 17.1363 2.63023 17.2028C2.89149 17.2694 3.16586 17.2643 3.42447 17.1881L5.74103 16.5065C6.48487 16.8639 7.28236 17.0967 8.10166 17.1956C8.4997 18.1282 9.08273 18.9704 9.8155 19.6713C10.5483 20.3723 11.4156 20.9173 12.365 21.2735C13.3144 21.6297 14.3261 21.7897 15.3391 21.7438C16.3521 21.698 17.3452 21.4471 18.2585 21.0065L20.5751 21.6881C20.8336 21.7642 21.1079 21.7693 21.369 21.7027C21.6302 21.6362 21.8686 21.5006 22.0592 21.3101C22.2498 21.1196 22.3855 20.8812 22.4522 20.6201C22.5188 20.359 22.5139 20.0848 22.4379 19.8262L21.7563 17.5087ZM5.81228 14.9531C5.74061 14.9532 5.66931 14.9633 5.6004 14.9831L2.99978 15.75L3.76572 13.1475C3.82019 12.9594 3.799 12.7576 3.70666 12.585C3.0282 11.3161 2.82829 9.84573 3.14337 8.44182C3.45846 7.03792 4.26755 5.79398 5.42317 4.93678C6.57878 4.07958 8.00395 3.66619 9.43889 3.77198C10.8738 3.87778 12.223 4.4957 13.2404 5.5131C14.2578 6.53051 14.8757 7.87965 14.9815 9.31459C15.0873 10.7495 14.6739 12.1747 13.8167 13.3303C12.9595 14.4859 11.7156 15.295 10.3117 15.6101C8.90775 15.9252 7.43736 15.7253 6.16853 15.0468C6.05942 14.9864 5.93698 14.9542 5.81228 14.9531ZM20.2301 17.6465L20.9998 20.25L18.3973 19.484C18.2093 19.4295 18.0074 19.4507 17.8348 19.5431C16.4537 20.2805 14.8392 20.4494 13.3354 20.0137C11.8315 19.578 10.5574 18.5721 9.78447 17.2106C10.8114 17.1034 11.8051 16.7852 12.7032 16.2758C13.6013 15.7665 14.3845 15.077 15.0036 14.2507C15.6227 13.4244 16.0643 12.4791 16.3008 11.4741C16.5373 10.469 16.5636 9.42593 16.3779 8.41027C17.2726 8.62117 18.107 9.03485 18.8165 9.61936C19.5259 10.2039 20.0917 10.9436 20.4699 11.7814C20.8481 12.6193 21.0288 13.5328 20.998 14.4516C20.9671 15.3703 20.7256 16.2697 20.292 17.0803C20.1986 17.2539 20.1774 17.4573 20.2329 17.6465H20.2301Z"
                  fill="#1F2022" />
              </svg>

              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M11.25 3.75V1.5C11.25 1.30109 11.329 1.11032 11.4697 0.96967C11.6103 0.829018 11.8011 0.75 12 0.75C12.1989 0.75 12.3897 0.829018 12.5303 0.96967C12.671 1.11032 12.75 1.30109 12.75 1.5V3.75C12.75 3.94891 12.671 4.13968 12.5303 4.28033C12.3897 4.42098 12.1989 4.5 12 4.5C11.8011 4.5 11.6103 4.42098 11.4697 4.28033C11.329 4.13968 11.25 3.94891 11.25 3.75ZM18 12C18 13.1867 17.6481 14.3467 16.9888 15.3334C16.3295 16.3201 15.3925 17.0892 14.2961 17.5433C13.1997 17.9974 11.9933 18.1162 10.8295 17.8847C9.66557 17.6532 8.59647 17.0818 7.75736 16.2426C6.91824 15.4035 6.3468 14.3344 6.11529 13.1705C5.88378 12.0067 6.0026 10.8003 6.45672 9.7039C6.91085 8.60754 7.67988 7.67047 8.66658 7.01118C9.65327 6.35189 10.8133 6 12 6C13.5908 6.00174 15.1159 6.63444 16.2407 7.75928C17.3656 8.88412 17.9983 10.4092 18 12ZM16.5 12C16.5 11.11 16.2361 10.24 15.7416 9.49993C15.2471 8.75991 14.5443 8.18314 13.7221 7.84254C12.8998 7.50195 11.995 7.41283 11.1221 7.58647C10.2492 7.7601 9.44736 8.18868 8.81802 8.81802C8.18868 9.44736 7.7601 10.2492 7.58647 11.1221C7.41283 11.995 7.50195 12.8998 7.84254 13.7221C8.18314 14.5443 8.75991 15.2471 9.49993 15.7416C10.24 16.2361 11.11 16.5 12 16.5C13.1931 16.4988 14.337 16.0243 15.1806 15.1806C16.0243 14.337 16.4988 13.1931 16.5 12ZM5.46938 6.53063C5.61011 6.67136 5.80098 6.75042 6 6.75042C6.19902 6.75042 6.38989 6.67136 6.53063 6.53063C6.67136 6.38989 6.75042 6.19902 6.75042 6C6.75042 5.80098 6.67136 5.61011 6.53063 5.46938L5.03062 3.96938C4.88989 3.82864 4.69902 3.74958 4.5 3.74958C4.30098 3.74958 4.11011 3.82864 3.96938 3.96938C3.82864 4.11011 3.74958 4.30098 3.74958 4.5C3.74958 4.69902 3.82864 4.88989 3.96938 5.03062L5.46938 6.53063ZM5.46938 17.4694L3.96938 18.9694C3.82864 19.1101 3.74958 19.301 3.74958 19.5C3.74958 19.699 3.82864 19.8899 3.96938 20.0306C4.11011 20.1714 4.30098 20.2504 4.5 20.2504C4.69902 20.2504 4.88989 20.1714 5.03062 20.0306L6.53063 18.5306C6.60031 18.4609 6.65558 18.3782 6.6933 18.2872C6.73101 18.1961 6.75042 18.0985 6.75042 18C6.75042 17.9015 6.73101 17.8039 6.6933 17.7128C6.65558 17.6218 6.60031 17.5391 6.53063 17.4694C6.46094 17.3997 6.37822 17.3444 6.28717 17.3067C6.19613 17.269 6.09855 17.2496 6 17.2496C5.90145 17.2496 5.80387 17.269 5.71283 17.3067C5.62178 17.3444 5.53906 17.3997 5.46938 17.4694ZM18 6.75C18.0985 6.75008 18.1961 6.73074 18.2871 6.6931C18.3782 6.65546 18.4609 6.60025 18.5306 6.53063L20.0306 5.03062C20.1714 4.88989 20.2504 4.69902 20.2504 4.5C20.2504 4.30098 20.1714 4.11011 20.0306 3.96938C19.8899 3.82864 19.699 3.74958 19.5 3.74958C19.301 3.74958 19.1101 3.82864 18.9694 3.96938L17.4694 5.46938C17.3644 5.57427 17.2928 5.70796 17.2639 5.85352C17.2349 5.99908 17.2497 6.14998 17.3065 6.28709C17.3633 6.42421 17.4596 6.54139 17.583 6.62379C17.7065 6.70619 17.8516 6.75012 18 6.75ZM18.5306 17.4694C18.3899 17.3286 18.199 17.2496 18 17.2496C17.801 17.2496 17.6101 17.3286 17.4694 17.4694C17.3286 17.6101 17.2496 17.801 17.2496 18C17.2496 18.199 17.3286 18.3899 17.4694 18.5306L18.9694 20.0306C19.0391 20.1003 19.1218 20.1556 19.2128 20.1933C19.3039 20.231 19.4015 20.2504 19.5 20.2504C19.5985 20.2504 19.6961 20.231 19.7872 20.1933C19.8782 20.1556 19.9609 20.1003 20.0306 20.0306C20.1003 19.9609 20.1556 19.8782 20.1933 19.7872C20.231 19.6961 20.2504 19.5985 20.2504 19.5C20.2504 19.4015 20.231 19.3039 20.1933 19.2128C20.1556 19.1218 20.1003 19.0391 20.0306 18.9694L18.5306 17.4694ZM4.5 12C4.5 11.8011 4.42098 11.6103 4.28033 11.4697C4.13968 11.329 3.94891 11.25 3.75 11.25H1.5C1.30109 11.25 1.11032 11.329 0.96967 11.4697C0.829018 11.6103 0.75 11.8011 0.75 12C0.75 12.1989 0.829018 12.3897 0.96967 12.5303C1.11032 12.671 1.30109 12.75 1.5 12.75H3.75C3.94891 12.75 4.13968 12.671 4.28033 12.5303C4.42098 12.3897 4.5 12.1989 4.5 12ZM12 19.5C11.8011 19.5 11.6103 19.579 11.4697 19.7197C11.329 19.8603 11.25 20.0511 11.25 20.25V22.5C11.25 22.6989 11.329 22.8897 11.4697 23.0303C11.6103 23.171 11.8011 23.25 12 23.25C12.1989 23.25 12.3897 23.171 12.5303 23.0303C12.671 22.8897 12.75 22.6989 12.75 22.5V20.25C12.75 20.0511 12.671 19.8603 12.5303 19.7197C12.3897 19.579 12.1989 19.5 12 19.5ZM22.5 11.25H20.25C20.0511 11.25 19.8603 11.329 19.7197 11.4697C19.579 11.6103 19.5 11.8011 19.5 12C19.5 12.1989 19.579 12.3897 19.7197 12.5303C19.8603 12.671 20.0511 12.75 20.25 12.75H22.5C22.6989 12.75 22.8897 12.671 23.0303 12.5303C23.171 12.3897 23.25 12.1989 23.25 12C23.25 11.8011 23.171 11.6103 23.0303 11.4697C22.8897 11.329 22.6989 11.25 22.5 11.25Z"
                  fill="#1F2022" />
              </svg>

              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M13.5 8.625C13.5 8.40249 13.566 8.18499 13.6896 7.99998C13.8132 7.81497 13.9889 7.67078 14.1945 7.58563C14.4 7.50048 14.6262 7.4782 14.8445 7.52161C15.0627 7.56502 15.2632 7.67217 15.4205 7.8295C15.5778 7.98684 15.685 8.18729 15.7284 8.40552C15.7718 8.62375 15.7495 8.84995 15.6644 9.05552C15.5792 9.26108 15.435 9.43678 15.25 9.5604C15.065 9.68402 14.8475 9.75 14.625 9.75C14.3266 9.75 14.0405 9.63147 13.8295 9.42049C13.6185 9.20951 13.5 8.92337 13.5 8.625ZM9.375 7.5C9.1525 7.5 8.93499 7.56598 8.74998 7.68959C8.56498 7.81321 8.42078 7.98891 8.33564 8.19448C8.25049 8.40004 8.22821 8.62624 8.27162 8.84447C8.31502 9.0627 8.42217 9.26316 8.5795 9.42049C8.73684 9.57783 8.93729 9.68497 9.15552 9.72838C9.37375 9.77179 9.59995 9.74951 9.80552 9.66436C10.0111 9.57921 10.1868 9.43502 10.3104 9.25001C10.434 9.06501 10.5 8.8475 10.5 8.625C10.5 8.32663 10.3815 8.04048 10.1705 7.8295C9.95952 7.61852 9.67337 7.5 9.375 7.5ZM20.25 13.5C20.2521 14.228 20.1575 14.9531 19.9688 15.6562L22.0538 16.5675C22.2091 16.6382 22.3356 16.7598 22.4125 16.9122C22.4894 17.0646 22.512 17.2386 22.4766 17.4056C22.4412 17.5726 22.3499 17.7225 22.2178 17.8305C22.0857 17.9386 21.9207 17.9984 21.75 18C21.6467 18.0002 21.5445 17.9788 21.45 17.9372L19.4419 17.0625C18.7701 18.4665 17.7148 19.6518 16.398 20.4815C15.0811 21.3112 13.5564 21.7515 12 21.7515C10.4436 21.7515 8.91889 21.3112 7.60205 20.4815C6.28521 19.6518 5.22994 18.4665 4.55813 17.0625L2.55 17.9372C2.45548 17.9788 2.35329 18.0002 2.25 18C2.07778 17.9999 1.91084 17.9405 1.77722 17.8318C1.64361 17.7232 1.55147 17.5718 1.51628 17.4032C1.48109 17.2347 1.50499 17.0591 1.58397 16.906C1.66295 16.753 1.7922 16.6318 1.95 16.5628L4.03125 15.6562C3.84251 14.9531 3.74794 14.228 3.75 13.5V12.75H1.5C1.30109 12.75 1.11032 12.671 0.96967 12.5303C0.829018 12.3897 0.75 12.1989 0.75 12C0.75 11.8011 0.829018 11.6103 0.96967 11.4697C1.11032 11.329 1.30109 11.25 1.5 11.25H3.75V10.5C3.74794 9.77197 3.84251 9.04689 4.03125 8.34375L1.95 7.43718C1.8576 7.39925 1.77371 7.34324 1.70325 7.27244C1.63279 7.20165 1.57719 7.11749 1.53969 7.02491C1.5022 6.93233 1.48358 6.8332 1.48492 6.73332C1.48626 6.63345 1.50753 6.53485 1.54749 6.44331C1.58746 6.35177 1.6453 6.26913 1.71763 6.20025C1.78997 6.13137 1.87533 6.07763 1.96871 6.04219C2.06209 6.00675 2.16162 5.99031 2.26144 5.99385C2.36126 5.99739 2.45936 6.02084 2.55 6.06281L4.55813 6.9375C5.22994 5.53352 6.28521 4.34824 7.60205 3.51853C8.91889 2.68882 10.4436 2.24854 12 2.24854C13.5564 2.24854 15.0811 2.68882 16.398 3.51853C17.7148 4.34824 18.7701 5.53352 19.4419 6.9375L21.45 6.06C21.6314 5.98554 21.8347 5.98505 22.0164 6.05864C22.1981 6.13223 22.3438 6.27405 22.4222 6.45373C22.5006 6.6334 22.5056 6.83664 22.436 7.01994C22.3665 7.20323 22.2279 7.35199 22.05 7.43437L19.9688 8.34843C20.1575 9.05158 20.2521 9.77666 20.25 10.5047V11.2547H22.5C22.6989 11.2547 22.8897 11.3337 23.0303 11.4744C23.171 11.615 23.25 11.8058 23.25 12.0047C23.25 12.2036 23.171 12.3944 23.0303 12.535C22.8897 12.6757 22.6989 12.7547 22.5 12.7547H20.25V13.5ZM5.25 11.25H18.75V10.5C18.75 8.70978 18.0388 6.9929 16.773 5.72703C15.5071 4.46115 13.7902 3.75 12 3.75C10.2098 3.75 8.4929 4.46115 7.22703 5.72703C5.96116 6.9929 5.25 8.70978 5.25 10.5V11.25ZM11.25 20.2069V12.75H5.25V13.5C5.25197 15.1596 5.86464 16.7605 6.9712 17.9975C8.07775 19.2344 9.60081 20.0208 11.25 20.2069ZM18.75 13.5V12.75H12.75V20.2069C14.3992 20.0208 15.9222 19.2344 17.0288 17.9975C18.1354 16.7605 18.748 15.1596 18.75 13.5Z"
                  fill="#1F2022" />
              </svg>

              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M20.7936 16.4944C20.2733 15.5981 19.4999 13.0622 19.4999 9.75C19.4999 7.76088 18.7097 5.85322 17.3032 4.4467C15.8967 3.04018 13.989 2.25 11.9999 2.25C10.0108 2.25 8.10311 3.04018 6.69659 4.4467C5.29007 5.85322 4.49989 7.76088 4.49989 9.75C4.49989 13.0631 3.72551 15.5981 3.2052 16.4944C3.07233 16.7222 3.00189 16.9811 3.00099 17.2449C3.00008 17.5086 3.06874 17.768 3.20005 17.9967C3.33135 18.2255 3.52065 18.4156 3.74886 18.5478C3.97708 18.6801 4.23613 18.7498 4.49989 18.75H8.32583C8.49886 19.5967 8.95904 20.3577 9.62851 20.9042C10.298 21.4507 11.1357 21.7492 11.9999 21.7492C12.8641 21.7492 13.7018 21.4507 14.3713 20.9042C15.0407 20.3577 15.5009 19.5967 15.674 18.75H19.4999C19.7636 18.7496 20.0225 18.6798 20.2506 18.5475C20.4787 18.4151 20.6678 18.225 20.799 17.9963C20.9302 17.7676 20.9988 17.5083 20.9979 17.2446C20.9969 16.9809 20.9265 16.7222 20.7936 16.4944ZM11.9999 20.25C11.5347 20.2499 11.081 20.1055 10.7013 19.8369C10.3215 19.5683 10.0343 19.1886 9.87926 18.75H14.1205C13.9655 19.1886 13.6783 19.5683 13.2985 19.8369C12.9187 20.1055 12.4651 20.2499 11.9999 20.25ZM4.49989 17.25C5.22176 16.0087 5.99989 13.1325 5.99989 9.75C5.99989 8.1587 6.63203 6.63258 7.75725 5.50736C8.88247 4.38214 10.4086 3.75 11.9999 3.75C13.5912 3.75 15.1173 4.38214 16.2425 5.50736C17.3677 6.63258 17.9999 8.1587 17.9999 9.75C17.9999 13.1297 18.7761 16.0059 19.4999 17.25H4.49989Z"
                  fill="#1F2022" />
              </svg>

              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M0.478063 12L4.81406 0.688H7.19806L11.5181 12H9.35806L8.60606 9.904H3.39006L2.62206 12H0.478063ZM4.03006 8.096H7.95006L5.99806 2.704L4.03006 8.096Z"
                  fill="white" />
              </svg>


            </div>
          </div>
          </div>

          <!-- <div class="chat-content">
            <div class="pb-28 sm:py-6 relative" ref="poster">
              no message show
              <div class="flex flex-column">
                <div class="m-auto rounded-md p-4" v-if="
                  (ms_active == 0 && me_message.length == 0) ||
                  (me_message.length == 1 &&
                    me_message[0].question == null &&
                    me_message[0].message == null)
                ">
                  <h1 class="mb-3 rounded px-2 py-2 text-center text-3xl font-bold">
                    {{ counter.setting.title }}
                  </h1>
                  <p class="text-center font-bold mb-2 font-16">
                    {{ counter.setting.description }}
                  </p>
                  <div class="w-full md:min-w-[450px]">
                    <div>
                      scene show
                      <div class="wrap_portal">
                        <SlideScene :scene="scene_p_model" v-if="
                          scene_p_model.length > 0 &&
                          counter.setting.portal_scene_style == 'slide'
                        " @selectedItems="selectedItems" />
                        <SlideScenet :scene="scene_p_model" v-if="
                          scene_p_model.length > 0 &&
                          counter.setting.portal_scene_style == 'card'
                        " @selectedItems="selectedItems" />
                      </div>
                      scene show end
                      <p class="mt-4 text-center text-sm text-neutral-400">
                        点击以上话题，快速与我对话
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              no message show end

              <div class="container-xxl" v-if="me_message.length > 0">
                <ul class="list-unstyled pt-5">
                  qs

                  <div class="message_s" v-for="(item, index) in me_message" :key="index">
                    <li class="d-flex message right" v-if="item.question">
                      <div class="message-body">
                        <span class="date-time text-muted">{{
                          item.created_at
                          }}</span>

                        <div class="message-row d-flex align-items-center justify-content-end">
                          <div @click="handleClickEvent" class="message-content me_content border p-3" v-html="item.question
                            ? renderMarkdown(item.question).replace(
                              /\\n/g,
                              '\n'
                            )
                            : ''
                            "></div>
                        </div>
                        <a-tag class="mr-1 mb-2 token-sel" size="small" color="arcoblue">
                          <Icon name="material-symbols:generating-tokens-outline-rounded" size="16" class="mr-1" />消耗 {{
                            item.qs_token }} Token
                        </a-tag>
                        <div class="message_content_footer">
                          <a-space class="ml-2">
                            <button class="chat-tool-btn" @click="edit_question(item.question)">
                              <div class="sign">
                                <icon-edit />
                              </div>

                              <div class="text">
                                编辑
                              </div>
                            </button>
                            <button class="chat-tool-btn" @click="
                              handleClick(item.question)
                              ">
                              <div class="sign">
                                <icon-copy />
                              </div>

                              <div class="text">复制问题</div>
                            </button>
                            <a-popconfirm content="此操作将永久删除当条消息,确定要删除吗?" @ok="delete_this(item.id)" type="warning">
                              <button class="chat-tool-btn">
                                <div class="sign">
                                  <icon-delete />
                                </div>

                                <div class="text">删除</div>
                              </button>
                            </a-popconfirm>
                          </a-space>
                        </div>
                      </div>
                    </li>

                    <li class="d-flex message" v-if="item.message">
                      <div class="mr-lg-3 me-2">
                        <a-avatar class="mr-2">
                          <img v-if="
                            me_message &&
                            me_message[0] &&
                            me_message[0].icon != null
                          " :src="me_message[0].icon" alt="avatar" class="rounded-full w-100" />
                          <img v-else :src="counter.setting.ai_chat_normal" alt="avatar" class="rounded-full w-100" />
                        </a-avatar>
                      </div>

                      <div class="message-body">
                        <span class="date-time text-muted">
                          {{ item.created_at }}
                        </span>
                        <div class="message-row relative d-flex flex-column align-items-start">
                          <div @click="handleClickEvent" class="message-content p-3" :class="index == me_message.length - 1 && !is_done
                            ? 'ms-up'
                            : ''
                            " v-html="item.message
                              ? renderMarkdown(item.message).replace(
                                /\\n/g,
                                '\n'
                              )
                              : ''
                              "></div>
                          <a-tag class="ml-1 mb-2 token-sel" size="small" color="arcoblue">
                            <Icon name="material-symbols:generating-tokens-outline-rounded" size="16" class="mr-1" />消耗
                            {{
                              item.answer_token
                            }}
                            Token（包含上下文预设信息）
                          </a-tag>
                          <div class="message_content_footer">
                            <a-space class="ml-2">
                              <button class="chat-tool-btn" @click="
                                speak_is_audio
                                  ? stop_speak()
                                  : speak(
                                    item.message
                                      ? item.message.replace(/\\n/g, '\n')
                                      : ''
                                  )
                                ">
                                <div class="sign">
                                  <icon-voice />
                                </div>

                                <div class="text">
                                  {{ speak_is_audio ? "停止" : "朗读" }}
                                </div>
                              </button>
                              <button class="chat-tool-btn" @click="refresh_answer(item.question)">
                                <div class="sign">
                                  <icon-refresh />
                                </div>

                                <div class="text">重新生成</div>
                              </button>
                              <button class="chat-tool-btn" @click="
                                handleClick(item.message ? item.message : '')
                                ">
                                <div class="sign">
                                  <icon-copy />
                                </div>

                                <div class="text">复制答案</div>
                              </button>
                              <button class="chat-tool-btn" @click="
                                exportWord(
                                  item.message
                                    ? renderMarkdown(item.message).replace(
                                      /\\n/g,
                                      '\n'
                                    )
                                    : ''
                                )
                                ">
                                <div class="sign">
                                  <icon-share-internal />
                                </div>

                                <div class="text">导出Word</div>
                              </button>
                              <button class="chat-tool-btn" @click="
                                exportPdf(
                                  item.message
                                    ? renderMarkdown(item.message).replace(
                                      /\\n/g,
                                      '\n'
                                    )
                                    : ''
                                )
                                ">
                                <div class="sign">
                                  <icon-download />
                                </div>

                                <div class="text">导出PDF</div>
                              </button>
                              <a-popconfirm content="此操作将永久删除当条消息,确定要删除吗?" @ok="delete_this(item.id)" type="warning">
                                <button class="chat-tool-btn">
                                  <div class="sign">
                                    <icon-delete />
                                  </div>

                                  <div class="text">删除</div>
                                </button>
                              </a-popconfirm>
                            </a-space>
                          </div>
                        </div>
                      </div>
                    </li>
                  </div>
                  qs end
                </ul>
              </div>
            </div>
          </div> -->


          <div class="px-[294px] flex items-center gap-2 mt-[200px]">
            <img src="https://kdkhvabm.synthetixor.com/images/202501/22/qYID1kyTI0IOhwQOXeYR85jOl4JzZfJ5fCqPWH1D.png"
              alt="logo" />
            <div class="typewriter">
              <h1 class="text=[28px] font-bold text-[#1F2022]">How can I help you today?</h1>
            </div>


          </div>



          <div class="res_stop text-center mb-2" :class="is_done ? 'd-none' : ''">
            <a-button @click="stop_stream()">
              <icon-record-stop class="font-22 mr-2" />
              停止运行
            </a-button>
          </div>

          <div class="flex gap-2 px-[200px] mt-6">
            <div class=" rounded-full bg-white flex items-center justify-center w-8 h-8">
              <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M20.0306 16.0307C19.9609 16.1005 19.8782 16.1558 19.7871 16.1935C19.6961 16.2313 19.5985 16.2507 19.4999 16.2507C19.4014 16.2507 19.3038 16.2313 19.2127 16.1935C19.1217 16.1558 19.039 16.1005 18.9693 16.0307L11.9999 9.06041L5.03055 16.0307C4.88982 16.1715 4.69895 16.2505 4.49993 16.2505C4.30091 16.2505 4.11003 16.1715 3.9693 16.0307C3.82857 15.89 3.74951 15.6991 3.74951 15.5001C3.74951 15.3011 3.82857 15.1102 3.9693 14.9695L11.4693 7.46948C11.539 7.39974 11.6217 7.34443 11.7127 7.30668C11.8038 7.26894 11.9014 7.24951 11.9999 7.24951C12.0985 7.24951 12.1961 7.26894 12.2871 7.30668C12.3782 7.34443 12.4609 7.39974 12.5306 7.46948L20.0306 14.9695C20.1003 15.0391 20.1556 15.1218 20.1933 15.2129C20.2311 15.3039 20.2505 15.4015 20.2505 15.5001C20.2505 15.5987 20.2311 15.6963 20.1933 15.7873C20.1556 15.8784 20.1003 15.9611 20.0306 16.0307Z"
                  fill="#1F2022" />
              </svg>

            </div>
            <div class="bg-white  rounded-xl p-2 flex-grow">
              <div class="flex">
                <div v-if="counter.setting.voice_is_open == 1" :class="send_loading ? 'voice-icon-6' : 'voice-icon'"
                  class="absolute z-10  cursor-pointer" @click="voice_dialog = true" size="18">
                  <img src="assets/images/mic-and-lock.png" alt="mic" />
                </div>
                <a-textarea class="!bg-white focus:!outline-none focus:!border-transparent focus:!ring-0" placeholder="Input Command" v-model="ruleForm.message_input"
                  :class="model_big_choose == 'gpt' ? 'voice-c' : ''" :auto-size="{
                    minRows: 1,
                    maxRows: 5,
                  }" @keydown.enter.native.prevent="check_sub()" show-word-limit />
              </div>

            </div>
          </div>


          <!-- old input message -->
          <!-- <div class="chat-footer border-top py-xl-2 py-lg-2 py-2">
            <div class="container-xxl">
              <div class="row">
                <div class="col-12">
                  <a-upload v-if="
                    plugins_select == 'image_read' ||
                    is_can_upload(model_is_select)
                  " class="avatar-uploader z-10 relative" :action="actions" :show-file-list="false"
                    :headers="{ Authorization: 'Bearer ' + token }" @before-upload="beforeUpload" @success="TextSuccess"
                    draggable>
                    <template #upload-button>
                      <div>
                        <div class="rounded-10 w-100 mr-1 custom-upload-avatar" v-if="text_imageUrl">
                          <div class="upload-file">
                            <a-trigger trigger="hover" show-arrow>
                              <div
                                class="upload-file__upload border border-dashed upload-file__upload--white overflow-hidden gda-dropdown-trigger"
                                style="width: 50px; height: 50px">
                                <img class="w-auto rounded" :src="text_imageUrl" />
                              </div>
                              <template #content>
                                <div class="bg-white p-2 shadow-md rounded-xl">
                                  <img class="w-60 rounded" :src="text_imageUrl" />
                                  <a-button type="primary" class="w-full mt-1"
                                    @click="text_imageUrl = ''">删除图片</a-button>
                                </div>
                              </template>
                            </a-trigger>
                          </div>

                          <div class="absolute top-2 plugin-upload left-2 rounded-10">
                            <IconPlus />
                          </div>
                        </div>
                        <div class="upload-file" v-else>
                          <div
                            class="upload-file__upload border mb-2 border-dashed upload-file__upload--white gda-dropdown-trigger"
                            style="width: 30px; height: 30px">
                            <svg role="img" aria-label="cloud-upload" focusable="false" data-icon="cloud-upload"
                              aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                              class="gd_design_icon gd_design_icon-cloud-upload">
                              <path
                                d="M12 3.25C9.23322 3.25 6.85685 4.91427 5.81432 7.29442C3.23861 7.63053 1.25 9.83289 1.25 12.5C1.25 15.3995 3.60051 17.75 6.5 17.75H8V16.25H6.5C4.42893 16.25 2.75 14.5711 2.75 12.5C2.75 10.4736 4.35756 8.82234 6.36655 8.75232L6.87754 8.73451L7.04768 8.25236C7.76807 6.211 9.71438 4.75 12 4.75C14.2856 4.75 16.2319 6.211 16.9523 8.25236L17.1225 8.73451L17.6334 8.75232C19.6424 8.82234 21.25 10.4736 21.25 12.5C21.25 14.5711 19.5711 16.25 17.5 16.25H16V17.75H17.5C20.3995 17.75 22.75 15.3995 22.75 12.5C22.75 9.83289 20.7614 7.63052 18.1857 7.29442C17.1431 4.91427 14.7668 3.25 12 3.25Z"
                                fill="currentColor"></path>
                              <path
                                d="M12.75 13.1013V20.5H11.25V13.1013L9.48014 14.5762L8.51986 13.4238L12 10.5237L15.4801 13.4238L14.5199 14.5762L12.75 13.1013Z"
                                fill="currentColor"></path>
                            </svg>
                          </div>
                        </div>
                      </div>
                    </template>
                  </a-upload>

                  <a-form :model="ruleForm" ref="formRef">
                    <a-form-item :hide-label="true" :hide-asterisk="true" field="message_input" validate-trigger="input"
                      class="mb-0 relative">
                      <a-trigger trigger="click" show-arrow v-if="
                        model_big_choose == 'gpt' &&
                        counter.setting.market_plugins_open == '1'
                      ">
                        <a-button type="text" size="mini" class="plugins-market z-10 left-1" shape="circle">
                          <svg t="1704607963876" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="12025" width="28" height="28">
                            <path
                              d="M571.392 87.074133l-0.631467 0.8704-356.9152 465.92c-10.222933 14.4384-12.544 32.512-3.669333 48.503467l2.013867 3.310933c8.618667 14.677333 23.808 22.766933 40.891733 22.766934l190.122667-0.017067-45.841067 270.08-0.631467 2.679467c-4.437333 21.128533 6.144 39.5776 24.832 48.401066l2.372267 1.024 0.529067 0.324267c5.12 2.696533 10.7008 4.215467 16.4352 4.642133l3.464533 0.136534c13.755733 0 26.368-5.410133 36.078933-15.121067a34.133333 34.133333 0 0 0 3.7376-4.437333L812.032 472.576a34.133333 34.133333 0 0 0 5.632-13.090133c2.048-10.376533 2.048-20.48-0.375467-30.173867a34.133333 34.133333 0 0 0-2.645333-7.133867l-1.6384-3.003733c-8.6528-14.557867-23.773867-22.596267-40.789333-22.596267l-162.833067-0.017066 46.165333-272.093867a34.133333 34.133333 0 0 0 0.477867-5.700267l-0.068267-3.072c-0.9216-18.312533-9.984-34.2016-26.760533-41.2672l-1.143467-0.426666-1.006933-0.597334c-19.694933-10.581333-41.984-4.539733-55.671467 13.6704z m2.833067 108.5952l-38.894934 229.3248-0.341333 2.491734a34.133333 34.133333 0 0 0 33.9968 37.358933l164.898133-0.017067-254.856533 360.379734 38.229333-225.1776 0.341334-2.491734a34.133333 34.133333 0 0 0-33.979734-37.376H294.980267l279.2448-364.4928z"
                              fill="#444444" p-id="12026"></path>
                            <path
                              d="M828.672 559.616a34.133333 34.133333 0 0 1 30.122667 54.698667l-99.874134 135.0656-55.7568-39.389867 100.608-136.055467 0.256-0.3584a34.048 34.048 0 0 1 24.644267-13.943466z"
                              fill="#165dff" p-id="12027"></path>
                          </svg>
                        </a-button>

                        <template #content>
                          <div class="plugin-market bg-white w-80 box-shadow">
                            <a-card hoverable v-for="(p, p_index) in plugins_list" :key="p_index">
                              <div :style="{
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between',
                              }">
                                <span :style="{
                                  display: 'flex',
                                  alignItems: 'center',
                                  color: '#1D2129',
                                }">
                                  <div v-html="p.icon"></div>
                                  <a-typography-text>{{
                                    p.title
                                    }}</a-typography-text>
                                </span>
                                <a-button type="primary" status="success" size="small" v-if="plugins_select == p.id"
                                  @click="plugins_select = false">已启用</a-button>
                                <a-button type="primary" size="small" v-else @click="getPlugins(p.id)">启用</a-button>
                              </div>
                            </a-card>
                          </div>
                        </template>
                      </a-trigger>
                      <a-textarea placeholder="shift+enter换行" v-model="ruleForm.message_input"
                        :class="model_big_choose == 'gpt' ? 'voice-c' : ''" :auto-size="{
                          minRows: 1,
                          maxRows: 5,
                        }" @keydown.enter.native.prevent="check_sub()" show-word-limit />
                      <icon-voice v-if="counter.setting.voice_is_open == 1"
                        :class="send_loading ? 'voice-icon-6' : 'voice-icon'" class="absolute z-10 cursor-pointer"
                        @click="voice_dialog = true" size="18" />

                      <client-only>
                        <a-space>
                          <a-button class="ml-1" @click="check_sub()" type="primary" :loading="send_loading">
                            <icon-send class="text-lg" />
                          </a-button>
                        </a-space>
                      </client-only>
                    </a-form-item>
                    <Nfooter />
                  </a-form>
                </div>
              </div>
            </div>
          </div> -->



        </div>
      </a-spin>
    </div>
    <a-modal v-model:visible="notice" @ok="save_notice()" :hide-cancel="true" ok-text="已查阅">
      <template #title> 本站公告 </template>
      <a-skeleton :animation="true" v-if="normal_message.length == 0">
        <a-space direction="vertical" :style="{ width: '100%' }" size="large">
          <a-skeleton-line :rows="3" />
        </a-space>
      </a-skeleton>
      <div v-else>
        <a-timeline>
          <a-timeline-item v-for="(n_t, n_index) in normal_message" :label="n_t.created_at" lineType="dashed"
            :key="n_index">
            <div v-html="n_t.title" class="mb-0"></div>
            <a-typography-text type="secondary" :style="{ fontSize: '12px', marginTop: '4px' }" v-html="n_t.info">
            </a-typography-text>
          </a-timeline-item>
        </a-timeline>
      </div>
    </a-modal>
    <a-modal v-model:visible="voice_dialog" :footer="false" simple>
      <div class="voice-header items-center flex justify-between">
        <div class="voice-title">
          <h4 class="d-sm-inline-block">语音对话</h4>
          | <span class="text-gray-500">静待回答</span>
        </div>
        <div class="voice-right">
          <a-dropdown @select="handleSelectRole">
            <!--找到voice_role中的value等于voice_role_choose的值-->
            <div class="flex voice-role cursor-pointer">
              <img :src="voice_role.find((item) => item.value === voice_role_choose)
                .image
                " alt="" class="w-6 mr-2" />
              <div>
                {{
                  voice_role.find((item) => item.value === voice_role_choose)
                    .label
                }}
                <icon-caret-down />
              </div>
            </div>
            <template #content>
              <a-doption :value="item.value" v-for="(item, index) in voice_role" :key="index">
                <template #icon>
                  <img :src="item.image" alt="" class="w-6" />
                </template>
                <template #default>{{ item.label }}</template>
              </a-doption>
            </template>
          </a-dropdown>
        </div>
      </div>
      <div class="voice-system-say">
        <div class="circle">
          <div class="inner-circle">
            <video class="voice-video" autoplay="" muted="" playsinline="" loop="">
              <source src="@/assets/images/voice.mp4" type="video/mp4" />
            </video>
          </div>
          <div class="ripple"></div>
          <div class="ripple"></div>
          <div class="ripple"></div>
        </div>
      </div>
      <h4 class="text-center font-18">{{ transcribedText }}</h4>
      <div class="voice-user-say flex justify-center p-4">
        <a-space>
          <button class="px-3 pt-2 pb-2 bg-boli" :disabled="voice_load" v-if="!voice_open" @click="startRecording">
            <icon-voice />开始录音
          </button>
          <button class="px-3 pt-2 pb-2 bg-boli" :disabled="voice_load" v-else @click="stopRecording">
            <icon-voice />停止录音
          </button>
          <button class="px-3 pt-2 pb-2 bg-boli flex items-center" @click="voice_change()">
            <Icon name="solar:bill-list-outline" class="mr-1" />对话列表
          </button>
        </a-space>
        <a-drawer :width="340" :mask-closable="false" :mask="false" :visible="voice_list" @ok="handleCancelVoice"
          @cancel="handleCancelVoice">
          <template #title> 语音对话列表 </template>
          <a-spin :loading="voice_set_loading">
            <div class="voice-list-check" v-if="voice_list_arr.length > 0">
              <a-alert>语音对话上下文选择</a-alert>
              <a-checkbox-group class="w-full" v-model="checkedValue">
                <template v-for="(item, index) in voice_list_arr" :key="index">
                  <a-checkbox :value="item.id" class="my-2 w-full">
                    <template #checkbox="{ checked }">
                      <a-space align="start" class="custom-checkbox-card w-full"
                        :class="{ 'custom-checkbox-card-checked': checked }">
                        <div class="custom-checkbox-card-mask">
                          <div class="custom-checkbox-card-mask-dot" />
                        </div>
                        <div>
                          <div class="custom-checkbox-card-title">
                            {{ item.question }}
                          </div>
                          <a-typography-text type="secondary" v-html="item.answer">
                          </a-typography-text>
                        </div>
                      </a-space>
                    </template>
                  </a-checkbox>
                </template>
              </a-checkbox-group>
              <a-pagination size="small" :total="voice_count" :current="voice_page" :page-size="voice_limit"
                class="justify-content-center mb-2" background @change="VoicehandleCurrentChange"
                :hide-on-single-page="true" />
            </div>
            <a-empty v-else>暂无对话</a-empty>
          </a-spin>
        </a-drawer>
      </div>
    </a-modal>
    <a-modal v-model:visible="dialog_scene" class="mb_dialog">
      <a-modal v-model:visible="scene_preset" title="场景预设" append-to-body class="mb_dialog">
        <a-form :model="SceneForm">
          <a-form-item :hide-label="true" :hide-asterisk="true" v-for="(domain, index) in SceneForm.domains"
            :field="`domains[${index}].value`" :key="index">
            <a-space>
              <a-select v-model="domain.sel">
                <a-option v-for="item in domainOptions" :key="item.value" :label="item.label" :value="item.value" />
              </a-select>
              <a-textarea auto-size placeholder="预设内容" v-model="domain.value" />
              <a-button type="primary" @click="removeDomain(domain)" :style="{ marginLeft: '10px' }">
                <icon-delete />
              </a-button>
            </a-space>
          </a-form-item>
        </a-form>
        <div>
          <a-button @click="addDomain">添加场景</a-button>
        </div>
        <template #footer>
          <span class="dialog-footer">
            <a-button type="primary" @click="scene_preset = false">
              完成
            </a-button>
          </span>
        </template>
      </a-modal>
      <template #title> 预设配置 </template>
      <a-tabs class="w-full" type="capsule" size="large">
        <a-tab-pane key="key" title="基础配置">
          <div class="space-y-3 pt-4">
            <h6 class="mb-3">大模型选择</h6>
            <a-radio-group class="mb-3 flex-wrap" @change="big_model_change" v-model="model_big_choose" type="button">
              <a-radio v-for="(models, m_index) in big_model_list" :key="m_index" :value="models.type">
                <div class="flex items-center gap-1">
                  <a-image :src="models.icon" class="w-5" alt="" />
                  {{ models.title }}
                </div>

              </a-radio>
            </a-radio-group>

            <h6 class="mb-3">模型选择</h6>
            <a-radio-group class="mb-3 flex-wrap" @change="small_model_change" v-model="model_is_select" type="button">
              <a-radio v-for="(mod, mod_index) in model_list" :key="mod_index" :value="mod.model">
                <a-popover v-if="mod.model_vip_limit?.length > 0">
                  <template #content>
                    <div>
                      <p>模型VIP限制</p>
                      <div class="grid grid-cols-2 gap-2">
                        <a-tag color="orange" v-for="(mods, mods_index) in mod.model_vip_limit" :key="mods_index">{{
                          mods.vip_s.title }}</a-tag>
                      </div>

                    </div>
                  </template>
                  <div class="flex items-center gap-1">
                    {{ mod.title }}
                    <svg t="1727938938116" class="icon" viewBox="0 0 1080 1024" version="1.1"
                      xmlns="http://www.w3.org/2000/svg" p-id="12439" width="16" height="16">
                      <path
                        d="M949.191111 701.098667a476.046222 476.046222 0 0 0 57.173333-226.929778c0-261.12-208.611556-472.746667-465.92-472.746667s-465.92 211.626667-465.92 472.746667c0 82.261333 20.764444 159.573333 57.173334 226.986667h817.493333z"
                        fill="#3A75EF" p-id="12440"></path>
                      <path
                        d="M814.08 705.706667a360.789333 360.789333 0 0 0 79.872-226.929778c0-198.144-158.833778-359.310222-354.076444-359.310222-195.242667 0-354.076444 161.166222-354.076445 359.310222 0 86.016 29.980444 164.977778 79.815111 226.929778h548.465778z"
                        fill="#FFFFFF" fill-opacity=".4" p-id="12441"></path>
                      <path
                        d="M591.815111 625.777778H481.052444L358.4 314.140444h113.265778l65.706666 202.126223h1.877334l65.706666-202.126223h109.511112z"
                        fill="#FFFFFF" p-id="12442"></path>
                      <path d="M130.446222 928.028444h819.996445v-226.929777H130.446222z" fill="#FFE69F" p-id="12443">
                      </path>
                      <path
                        d="M130.446222 928.028444v-132.380444H0l74.524444 113.493333L0 1022.577778h167.708444v-94.549334zM1080.888889 795.648h-130.446222v132.380444h-37.262223v94.549334H1080.888889l-74.524445-113.436445zM391.395556 795.648H316.757333a18.773333 18.773333 0 0 1-18.659555-18.887111 18.773333 18.773333 0 0 1 18.659555-18.944h74.524445a18.773333 18.773333 0 0 1 18.659555 18.944 18.773333 18.773333 0 0 1-18.659555 18.887111M577.706667 795.648H465.92a18.773333 18.773333 0 0 1-18.659556-18.887111 18.773333 18.773333 0 0 1 18.659556-18.944h111.786667a18.773333 18.773333 0 0 1 18.659555 18.944 18.773333 18.773333 0 0 1-18.659555 18.887111M484.522667 871.310222H316.871111a18.773333 18.773333 0 0 1-18.659555-18.887111 18.773333 18.773333 0 0 1 18.659555-18.944h167.708445a18.773333 18.773333 0 0 1 18.659555 18.944 18.773333 18.773333 0 0 1-18.659555 18.887111M764.074667 871.310222h-37.262223a18.773333 18.773333 0 0 1-18.659555-18.887111 18.773333 18.773333 0 0 1 18.659555-18.944h37.262223a18.773333 18.773333 0 0 1 18.659555 18.944 18.773333 18.773333 0 0 1-18.659555 18.887111M652.288 871.310222H559.104a18.773333 18.773333 0 0 1-18.659556-18.887111 18.773333 18.773333 0 0 1 18.659556-18.944h93.184a18.773333 18.773333 0 0 1 18.602667 18.944 18.773333 18.773333 0 0 1-18.602667 18.887111M764.074667 795.648h-93.184a18.773333 18.773333 0 0 1-18.659556-18.887111 18.773333 18.773333 0 0 1 18.659556-18.944h93.184a18.773333 18.773333 0 0 1 18.659555 18.944 18.773333 18.773333 0 0 1-18.659555 18.887111"
                        fill="#F0C419" p-id="12444"></path>
                    </svg>
                  </div>
                </a-popover>
                <span v-else>
                  {{ mod.title }}
                  <a-badge v-if="mod.model_vip_limit?.length > 0" :content="mod.model_vip_limit" class="ml-1" />
                </span>
              </a-radio>
            </a-radio-group>
            <a-empty v-if="model_list.length == 0">暂无模型</a-empty>

            <h6 class="mb-3">知识库选择</h6>
            <div class="knowledge_choose">
              <div class="knowledge_list" v-if="now_choose_knowledge.length > 0">
                <a-row :gutter="20">
                  <a-col :span="12" v-for="(n_t, n_index) in now_choose_knowledge" :key="n_index">
                    <a-card hoverable class="w-100" :style="{ marginBottom: '20px' }">
                      <div :style="{
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between',
                      }">
                        <span :style="{
                          display: 'flex',
                          alignItems: 'center',
                          color: '#1D2129',
                        }">
                          <svg t="1692008373063" class="icon mr-2" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="4045" width="24" height="24">
                            <path
                              d="M372.363636 744.727273h-76.101818a54.225455 54.225455 0 0 1-50.036363-30.487273 40.727273 40.727273 0 0 1-4.887273-23.272727 151.738182 151.738182 0 0 0-23.272727-82.152728 152.436364 152.436364 0 0 0-20.945455-24.901818 351.883636 351.883636 0 0 1-41.890909-56.087272 302.545455 302.545455 0 0 1-27.927273-54.69091A180.363636 180.363636 0 0 1 116.363636 418.909091a246.923636 246.923636 0 0 1 6.050909-61.44 222.021818 222.021818 0 0 1 38.167273-84.712727A268.8 268.8 0 0 1 261.585455 186.181818a240.174545 240.174545 0 0 1 54.690909-18.385454 286.952727 286.952727 0 0 1 69.818181-5.585455 256 256 0 0 1 93.09091 21.178182 251.810909 251.810909 0 0 1 52.363636 32.349091 281.6 281.6 0 0 1 60.974545 67.723636 229.934545 229.934545 0 0 1 31.185455 76.334546 222.254545 222.254545 0 0 1 4.654545 66.792727 184.32 184.32 0 0 1-13.963636 55.621818 312.32 312.32 0 0 1-44.683636 77.265455 328.145455 328.145455 0 0 1-25.134546 28.858181 114.269091 114.269091 0 0 0-23.272727 34.676364 165.701818 165.701818 0 0 0-14.196364 40.261818c-1.163636 8.610909-1.163636 16.989091-2.094545 25.367273a124.741818 124.741818 0 0 1-2.56 18.385455 51.665455 51.665455 0 0 1-24.901818 29.323636 58.88 58.88 0 0 1-29.323637 7.214545z m-26.996363-512c-7.68 0-15.592727 1.396364-23.272728 2.792727a151.738182 151.738182 0 0 0-52.596363 18.850909 171.752727 171.752727 0 0 0-39.330909 31.418182 165.003636 165.003636 0 0 0-30.72 45.149091A169.658182 169.658182 0 0 0 186.181818 397.963636a19.549091 19.549091 0 1 0 39.098182 2.094546v-9.774546a116.363636 116.363636 0 0 1 7.447273-34.676363 131.956364 131.956364 0 0 1 46.545454-59.578182 118.458182 118.458182 0 0 1 66.792728-24.436364 85.178182 85.178182 0 0 0 13.265454-1.163636 16.523636 16.523636 0 0 0 13.498182-10.938182 25.6 25.6 0 0 0 0-13.265454 16.523636 16.523636 0 0 0-14.894546-13.498182z m-73.541818 581.818182h201.076363a15.127273 15.127273 0 0 1 15.825455 13.730909v42.356363a15.127273 15.127273 0 0 1-15.825455 13.730909h-201.076363a15.127273 15.127273 0 0 1-15.825455-13.730909v-42.356363a15.127273 15.127273 0 0 1 15.825455-13.730909z"
                              fill="#3F58FD" opacity=".3" p-id="4046"></path>
                            <path
                              d="M605.090909 804.538182h-90.298182A63.767273 63.767273 0 0 1 455.447273 768a50.734545 50.734545 0 0 1-5.818182-26.763636 186.181818 186.181818 0 0 0-27.927273-99.374546 181.992727 181.992727 0 0 0-24.669091-30.254545 415.883636 415.883636 0 0 1-49.803636-67.723637 378.181818 378.181818 0 0 1-33.28-66.56 226.443636 226.443636 0 0 1-11.403636-68.421818 298.123636 298.123636 0 0 1 7.214545-74.705454 266.24 266.24 0 0 1 46.545455-101.003637 319.767273 319.767273 0 0 1 119.621818-103.796363 291.374545 291.374545 0 0 1 65.163636-23.272728 331.170909 331.170909 0 0 1 81.687273-6.516363 281.134545 281.134545 0 0 1 170.356363 65.629091 338.850909 338.850909 0 0 1 72.378182 82.152727 279.272727 279.272727 0 0 1 37.003637 93.090909 276.014545 276.014545 0 0 1 5.12 80.058182 235.054545 235.054545 0 0 1-16.523637 67.490909 389.12 389.12 0 0 1-83.083636 128.232727 147.083636 147.083636 0 0 0-27.229091 42.123637 202.24 202.24 0 0 0-16.756364 48.872727c-1.629091 10.24-1.629091 20.48-2.56 30.487273a147.781818 147.781818 0 0 1-3.258181 23.272727 60.043636 60.043636 0 0 1-29.556364 35.374545 66.327273 66.327273 0 0 1-34.443636 9.076364z m-18.618182-626.734546c-9.774545 0-19.549091 1.861818-29.090909 3.490909a192.930909 192.930909 0 0 0-65.396363 23.272728A209.454545 209.454545 0 0 0 442.181818 243.665455a194.327273 194.327273 0 0 0-37.934545 55.854545 211.781818 211.781818 0 0 0-16.756364 82.850909 25.134545 25.134545 0 0 0 8.378182 19.781818 23.272727 23.272727 0 0 0 20.712727 5.818182 25.134545 25.134545 0 0 0 19.549091-23.272727V372.363636a144.523636 144.523636 0 0 1 8.610909-43.054545A164.538182 164.538182 0 0 1 502.458182 256a146.850909 146.850909 0 0 1 82.850909-30.021818l16.756364-1.396364a20.48 20.48 0 0 0 16.523636-13.730909 25.134545 25.134545 0 0 0 0-16.523636 20.48 20.48 0 0 0-18.152727-16.523637zM488.727273 861.090909h232.727272a18.152727 18.152727 0 0 1 18.152728 18.152727v56.32a18.385455 18.385455 0 0 1-18.152728 18.618182H488.727273a18.385455 18.385455 0 0 1-18.152728-18.385454v-56.785455A18.152727 18.152727 0 0 1 488.727273 861.090909z"
                              fill="#3F58FD" p-id="4047"></path>
                          </svg>

                          <a-typography-text>{{ n_t.title }}</a-typography-text>
                        </span>
                        <icon-delete @click="delnow_know(n_t.id)"></icon-delete>
                      </div>
                    </a-card>
                  </a-col>
                </a-row>
                <a-button type="primary" class="mb-2" @click="add_knowledge()">选择知识库</a-button>
              </div>
              <a-empty v-else description="未选择知识库">
                <a-button type="primary" @click="add_knowledge()">选择知识库</a-button>
              </a-empty>
            </div>
            <a-modal v-model:visible="knowledge_add" title="添加知识库" append-to-body class="mb_dialog">
              <a-spin class="w-full" :loading="know_loading">
                <template #icon>
                  <div class="flex justify-center">
                    <svg class="arco-icon-loading" width="1em" height="1em" viewBox="0 0 24 24" fill="none"
                      xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M13.7998 5.85002C12.4998 5.45002 11.0998 5.50002 9.79984 6.00002C8.49984 6.50002 7.39984 7.35002 6.64984 8.50002C5.89984 9.65002 5.54984 11 5.59984 12.4C5.64984 13.8 6.19984 15.1 7.09984 16.15C7.99984 17.2 9.19984 17.95 10.5498 18.25C11.8998 18.55 13.2998 18.45 14.5498 17.85C15.4498 17.45 16.4998 17.85 16.8998 18.75C17.2998 19.65 16.8998 20.7 15.9998 21.1C14.0498 21.95 11.8498 22.2 9.74984 21.7C7.64984 21.2 5.74984 20.05 4.34984 18.45C2.99984 16.85 2.14984 14.8 1.99984 12.65C1.89984 10.5 2.44984 8.35002 3.59984 6.55002C4.79984 4.75002 6.49984 3.35002 8.54984 2.65002C10.5498 1.90002 12.7998 1.85002 14.8498 2.45002C16.8998 3.05002 18.7498 4.30002 19.9998 6.00002C21.2998 7.75002 21.9998 9.80002 21.9998 12C21.9998 13 21.1998 13.8 20.1998 13.8C19.1998 13.8 18.3998 13 18.3998 12C18.3998 10.6 17.9498 9.30002 17.1498 8.15002C16.2998 7.05002 15.1498 6.25002 13.7998 5.85002Z"
                        fill="url(#svg_2fc1cd5fdf__paint0_linear_118545_226288)"></path>
                      <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M13.7998 5.85002C12.4998 5.45002 11.0998 5.50002 9.79984 6.00002C8.49984 6.50002 7.39984 7.35002 6.64984 8.50002C5.89984 9.65002 5.54984 11 5.59984 12.4C5.64984 13.8 6.19984 15.1 7.09984 16.15C7.99984 17.2 9.19984 17.95 10.5498 18.25C11.8998 18.55 13.2998 18.45 14.5498 17.85C15.4498 17.45 16.4998 17.85 16.8998 18.75C17.2998 19.65 16.8998 20.7 15.9998 21.1C14.0498 21.95 11.8498 22.2 9.74984 21.7C7.64984 21.2 5.74984 20.05 4.34984 18.45C2.99984 16.85 2.14984 14.8 1.99984 12.65C1.89984 10.5 2.44984 8.35002 3.59984 6.55002C4.79984 4.75002 6.49984 3.35002 8.54984 2.65002C10.5498 1.90002 12.7998 1.85002 14.8498 2.45002C16.8998 3.05002 18.7498 4.30002 19.9998 6.00002C21.2998 7.75002 21.9998 9.80002 21.9998 12C21.9998 13 21.1998 13.8 20.1998 13.8C19.1998 13.8 18.3998 13 18.3998 12C18.3998 10.6 17.9498 9.30002 17.1498 8.15002C16.2998 7.05002 15.1498 6.25002 13.7998 5.85002Z"
                        fill="url(#svg_2fc1cd5fdf__paint1_linear_118545_226288)"></path>
                      <defs>
                        <linearGradient id="svg_2fc1cd5fdf__paint0_linear_118545_226288" x1="13.215" y1="6.907"
                          x2="10.715" y2="16.282" gradientUnits="userSpaceOnUse">
                          <stop stop-color="#1765FF"></stop>
                          <stop offset=".031" stop-color="#1765FF" stop-opacity=".969"></stop>
                          <stop offset="1" stop-color="#1765FF" stop-opacity="0"></stop>
                        </linearGradient>
                        <linearGradient id="svg_2fc1cd5fdf__paint1_linear_118545_226288" x1="-.574" y1="9.566"
                          x2="18.802" y2="13.316" gradientUnits="userSpaceOnUse">
                          <stop stop-color="#ADC9FF"></stop>
                          <stop offset="1" stop-color="#8AB1FF" stop-opacity="0"></stop>
                        </linearGradient>
                      </defs>
                    </svg>
                  </div>
                </template>
                <a-tabs v-model="know_tab" type="capsule" class="mb-3">
                  <a-tab-pane key="me" title="私有">
                    <a-checkbox-group class="w-full" v-model="know_check" @change="changeRadio"
                      v-if="knowledge_list.length > 0">
                      <a-row :gutter="10" class="w-full">
                        <template v-for="(k, k_index) in knowledge_list" :key="k_index">
                          <a-col :span="12">
                            <a-checkbox :value="k.id" class="w-75 mb-2">
                              <template #checkbox="{ checked }">
                                <a-space align="start" class="custom-checkbox-card" :class="{
                                  'custom-checkbox-card-checked': checked,
                                }">
                                  <div class="custom-checkbox-card-mask">
                                    <div class="custom-checkbox-card-mask-dot" />
                                  </div>
                                  <div>
                                    <div class="custom-checkbox-card-title">
                                      {{ k.title }}
                                    </div>
                                    <a-typography-text type="secondary">
                                      {{
                                        k.description
                                          ? k.description
                                          : "暂无描述"
                                      }}
                                    </a-typography-text>
                                  </div>
                                </a-space>
                              </template>
                            </a-checkbox>
                          </a-col>
                        </template>
                      </a-row>
                    </a-checkbox-group>
                    <a-empty v-else description="暂无知识库">
                      <a-button type="primary" @click="add_knowledge_go()">添加知识库</a-button>
                    </a-empty>
                    <a-pagination class="mt-2" :current="k_page" :page-size="k_limit" background hide-on-single-page
                      :total="know_count" @change="handleCurrentChangeKnowledge" />
                  </a-tab-pane>
                  <a-tab-pane key="all" title="公共">
                    <a-checkbox-group class="w-full" v-model="know_check" @change="changeRadio"
                      v-if="knowledge_public_list.length > 0">
                      <a-row :gutter="10" class="w-full">
                        <template v-for="(k, k_index) in knowledge_public_list" :key="k_index">
                          <a-col :span="12">
                            <a-checkbox :value="k.id" class="w-75 mb-2">
                              <template #checkbox="{ checked }">
                                <a-space align="start" class="custom-checkbox-card" :class="{
                                  'custom-checkbox-card-checked': checked,
                                }">
                                  <div class="custom-checkbox-card-mask">
                                    <div class="custom-checkbox-card-mask-dot" />
                                  </div>
                                  <div>
                                    <div class="custom-checkbox-card-title">
                                      {{ k.title }}
                                    </div>
                                    <a-typography-text type="secondary">
                                      {{
                                        k.description
                                          ? k.description
                                          : "暂无描述"
                                      }}
                                    </a-typography-text>
                                  </div>
                                </a-space>
                              </template>
                            </a-checkbox>
                          </a-col>
                        </template>
                      </a-row>
                    </a-checkbox-group>
                    <a-empty v-else description="暂无公开知识库"> </a-empty>
                    <a-pagination class="mt-2" :current="public_page" :page-size="public_limit" background
                      hide-on-single-page :total="knowledge_public_count"
                      @change="handleCurrentChangeKnowledgePublic" />
                  </a-tab-pane>
                </a-tabs>
              </a-spin>
            </a-modal>
            <a-collapse class="mb-3 better_preview">
              <template #expand-icon="{ active }">
                <icon-face-smile-fill v-if="active" />
                <icon-face-frown-fill v-else />
              </template>
              <a-collapse-item header="高级设置" key="1">
                <template #expand-icon="{ active }">
                  <icon-double-down v-if="active" />
                  <icon-double-right v-else />
                </template>
                <div class="normal_setting">
                  <div class="flex items-center justify-between">
                    <div class="w-[150px]">
                      <p>上下文数量</p>
                    </div>
                    <div class="flex w-[200px] items-center">
                      <a-slider :default-value="Number(counter.setting.chat_up_limit)" v-model="answer_num" :max="15"
                        :step="1" :show-ticks="true" />
                    </div>
                  </div>
                  <p class="mt-2 text-xs text-slate-500">
                    更多的上下文会使问答有联动性，能够结合上下精准回答
                  </p>
                  <div class="flex items-center justify-between mt-4">
                    <div class="w-[150px]">
                      <p>话题精准度</p>
                    </div>
                    <div class="flex w-[200px] items-center">
                      <a-slider :default-value="answer_tem" v-model="answer_tem" :max="2" :step="0.1"
                        :show-ticks="true" />
                    </div>
                  </div>
                  <p class="mt-2 text-xs text-slate-500">
                    正常数值0.8,数值越高每次回答内容更随机
                  </p>
                </div>
              </a-collapse-item>
              <a-collapse-item header="语音设置" key="2">
                <template #expand-icon="{ active }">
                  <icon-double-down v-if="active" />
                  <icon-double-right v-else />
                </template>
                <a-list>
                  <a-list-item class="bg-white" v-for="(item, idx) in voice_role" :key="idx">
                    <a-list-item-meta class="mr-20" :title="item.label" :description="item.description">
                      <template #avatar>
                        <a-avatar shape="square">
                          <img alt="avatar" :src="item.image" />
                        </a-avatar>
                      </template>
                    </a-list-item-meta>
                    <template #actions>
                      <a-button type="primary" @click="voice_role_change(item.value)">{{
                        chat_speak == item.value ? "使用中" : "使用"
                        }}</a-button>
                    </template>
                  </a-list-item>
                </a-list>
              </a-collapse-item>
            </a-collapse>
          </div>
        </a-tab-pane>
        <a-tab-pane key="scene" title="高级配置">
          <div class="space-y-3 pt-4">
            <a-row :gutter="20" class="w-full">
              <a-col :span="19">
                <a-input-search v-model="scene_search" placeholder="请输入场景名称" @press-enter="scene_insearch()"
                  @search="scene_insearch()" />
              </a-col>
              <a-col :span="5">
                <a-button type="primary" @click="scene_preset = true">预设场景</a-button>
              </a-col>
            </a-row>

            <a-list :loading="scene_loading" :bordered="false">
              <a-list-item @click="selectedItem(oc.Instruction, oc.preset, oc.id)" class="cursor-pointer"
                v-for="(oc, oc_index) in scene_model" :key="oc_index">
                <a-list-item-meta :description="oc.Instruction">
                  <template #title>
                    <div class="flex">
                      <h6 class="mr-2">{{ oc.title }}</h6>
                      <a-tooltip :content="'浏览量：' + oc.view">
                        <svg t="1698473052037" class="icon" viewBox="0 0 1024 1024" version="1.1"
                          xmlns="http://www.w3.org/2000/svg" p-id="36217" width="20" height="20">
                          <path
                            d="M754.133333 242.773333c-10.88-10.88-26.666667-14.933333-41.386666-10.88-14.72 4.053333-26.24 15.786667-30.08 30.506667-2.986667 11.306667-21.333333 69.973333-40.32 130.133333-48.64-69.333333-119.04-181.12-138.026667-271.146666-1.28-8.533333-5.333333-16.853333-12.16-23.466667a42.666667 42.666667 0 0 0-60.16 0.213333l-0.426667 0.426667c-88.96 90.666667-161.28 261.12-155.093333 395.306667-19.2-24.96-33.28-49.066667-36.906667-67.84-3.626667-18.346667-18.56-32.213333-37.12-34.346667-18.56-2.133333-36.266667 8.106667-43.733333 25.173333-30.08 67.626667-42.666667 142.506667-36.053333 218.24 17.28 134.826667 117.546667 244.906667 261.333333 287.146667 37.12 11.093333 75.52 16.853333 114.346667 17.066667 147.413333 0 325.973333-85.76 382.293333-249.813334 71.68-208-48.426667-369.28-126.506667-446.72z m46.293334 418.346667C757.546667 785.92 612.906667 853.333333 498.986667 853.333333c-30.506667-0.213333-61.013333-4.693333-90.453334-13.44-87.04-25.386667-185.6-95.573333-200.746666-214.186666-2.346667-26.453333-1.493333-53.333333 2.133333-79.573334 49.066667 64.426667 114.346667 120.106667 125.013333 128.853334 14.72 12.373333 36.053333 13.226667 51.84 2.346666 15.786667-11.093333 22.186667-31.146667 15.786667-49.28l-30.933333-86.613333c-28.373333-79.146667 7.466667-221.653333 74.24-323.84 56.96 141.653333 173.226667 286.933333 178.986666 294.186667 9.813333 12.16 25.6 18.133333 40.96 15.146666 15.36-2.773333 27.946667-14.08 32.853334-29.013333 3.84-11.946667 26.026667-81.493333 43.946666-138.666667 53.12 71.04 100.693333 177.066667 57.813334 301.866667z"
                            p-id="36218" fill="#8a8a8a"></path>
                        </svg>
                        {{ oc.view }}
                      </a-tooltip>
                    </div>
                  </template>
                  <template #avatar>
                    <a-avatar shape="square" :imageUrl="oc.icon"> </a-avatar>
                  </template>
                </a-list-item-meta>
              </a-list-item>
              <a-pagination class="mt-2" :current="s_page" :page-size="s_limit" background hide-on-single-page
                :total="scene_count" @change="handleCurrentChangeScene" />
              <a-empty v-show="scene_count == 0" description="暂无数据" />
            </a-list>
          </div>
        </a-tab-pane>
      </a-tabs>

      <template #footer>
        <span class="dialog-footer">
          <a-button type="primary" @click="dialog_scene = false">
            配置完成
          </a-button>
        </span>
      </template>
    </a-modal>
    <a-drawer v-model:visible="drawer" placement="left" class="drawer_index" unmountOnClose :header="false">
      <a-space class="p-2 flex justify-between w-full">
        <h1 class="m-0 font-bold">Message</h1>
        <div class="message_action">
          <a-button class="rounded mr-2" type="primary" @click="add_new_chat()">
            <template #icon>
              <icon-plus />
            </template>
          </a-button>
          <a-popconfirm content="此操作将永久删除所有会话,确定要删除吗?" @ok="delete_all" type="warning">
            <a-button class="rounded">
              <template #icon>
                <icon-delete />
              </template>
            </a-button>
          </a-popconfirm>
        </div>
      </a-space>
      <a-space class="w-full flex justify-between search_space" wrap>
        <a-input-search class="ml-2 mr-0 rounded" v-model="qs_input" @search="qs_search"
          @keydown.enter.native="qs_search" placeholder="搜索..." />
        <a-button class="rounded mr-2" @click="all_message()">
          <template #icon>
            <icon-loop />
          </template>
        </a-button>
      </a-space>
      <a-spin :loading="left_loding" tip="Loading..">
        <template #icon>
          <div class="flex justify-center">
            <svg class="arco-icon-loading" width="1em" height="1em" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M13.7998 5.85002C12.4998 5.45002 11.0998 5.50002 9.79984 6.00002C8.49984 6.50002 7.39984 7.35002 6.64984 8.50002C5.89984 9.65002 5.54984 11 5.59984 12.4C5.64984 13.8 6.19984 15.1 7.09984 16.15C7.99984 17.2 9.19984 17.95 10.5498 18.25C11.8998 18.55 13.2998 18.45 14.5498 17.85C15.4498 17.45 16.4998 17.85 16.8998 18.75C17.2998 19.65 16.8998 20.7 15.9998 21.1C14.0498 21.95 11.8498 22.2 9.74984 21.7C7.64984 21.2 5.74984 20.05 4.34984 18.45C2.99984 16.85 2.14984 14.8 1.99984 12.65C1.89984 10.5 2.44984 8.35002 3.59984 6.55002C4.79984 4.75002 6.49984 3.35002 8.54984 2.65002C10.5498 1.90002 12.7998 1.85002 14.8498 2.45002C16.8998 3.05002 18.7498 4.30002 19.9998 6.00002C21.2998 7.75002 21.9998 9.80002 21.9998 12C21.9998 13 21.1998 13.8 20.1998 13.8C19.1998 13.8 18.3998 13 18.3998 12C18.3998 10.6 17.9498 9.30002 17.1498 8.15002C16.2998 7.05002 15.1498 6.25002 13.7998 5.85002Z"
                fill="url(#svg_2fc1cd5fdf__paint0_linear_118545_226288)"></path>
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M13.7998 5.85002C12.4998 5.45002 11.0998 5.50002 9.79984 6.00002C8.49984 6.50002 7.39984 7.35002 6.64984 8.50002C5.89984 9.65002 5.54984 11 5.59984 12.4C5.64984 13.8 6.19984 15.1 7.09984 16.15C7.99984 17.2 9.19984 17.95 10.5498 18.25C11.8998 18.55 13.2998 18.45 14.5498 17.85C15.4498 17.45 16.4998 17.85 16.8998 18.75C17.2998 19.65 16.8998 20.7 15.9998 21.1C14.0498 21.95 11.8498 22.2 9.74984 21.7C7.64984 21.2 5.74984 20.05 4.34984 18.45C2.99984 16.85 2.14984 14.8 1.99984 12.65C1.89984 10.5 2.44984 8.35002 3.59984 6.55002C4.79984 4.75002 6.49984 3.35002 8.54984 2.65002C10.5498 1.90002 12.7998 1.85002 14.8498 2.45002C16.8998 3.05002 18.7498 4.30002 19.9998 6.00002C21.2998 7.75002 21.9998 9.80002 21.9998 12C21.9998 13 21.1998 13.8 20.1998 13.8C19.1998 13.8 18.3998 13 18.3998 12C18.3998 10.6 17.9498 9.30002 17.1498 8.15002C16.2998 7.05002 15.1498 6.25002 13.7998 5.85002Z"
                fill="url(#svg_2fc1cd5fdf__paint1_linear_118545_226288)"></path>
              <defs>
                <linearGradient id="svg_2fc1cd5fdf__paint0_linear_118545_226288" x1="13.215" y1="6.907" x2="10.715"
                  y2="16.282" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#1765FF"></stop>
                  <stop offset=".031" stop-color="#1765FF" stop-opacity=".969"></stop>
                  <stop offset="1" stop-color="#1765FF" stop-opacity="0"></stop>
                </linearGradient>
                <linearGradient id="svg_2fc1cd5fdf__paint1_linear_118545_226288" x1="-.574" y1="9.566" x2="18.802"
                  y2="13.316" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#ADC9FF"></stop>
                  <stop offset="1" stop-color="#8AB1FF" stop-opacity="0"></stop>
                </linearGradient>
              </defs>
            </svg>
          </div>
        </template>
        <div v-if="messages.length > 0" class="chat_list_message p-2">
          <ul class="chat-list mb-2">
            <div class="bot_info">
              <li class="online list-animation-bottomIn" :class="[
                ms_active == item[item.length - 1].session_id ? 'active' : '',
                'delay-' + index,
              ]" v-for="(item, index) in messages" :key="index">
                <div class="hover_action">
                  <a-space>
                    <icon-edit @click="change_sname(item[item.length - 1].session_id)" />
                    <a-popconfirm content="此操作将永久删除当前会话,确定要删除吗?" @ok="delete_msg(item[item.length - 1].session_id)"
                      type="warning">
                      <icon-delete />
                    </a-popconfirm>
                  </a-space>
                </div>
                <div class="card bg-boli mb-2" @click="check_message(item[item.length - 1].session_id)">
                  <div class="card-body">

                    <div class="media">
                      <div class="avatar me-3">
                        <a-avatar v-if="item[item.length - 1].icon" @click="send_avatar()" shape="square"
                          :imageUrl="item[item.length - 1].icon">
                        </a-avatar>
                        <a-avatar @click="send_avatar()" v-else>
                          <img :src="counter.setting.ai_chat_normal" alt="" />
                        </a-avatar>
                      </div>
                      <div class="media-body overflow-hidden">
                        <div class="d-flex align-items-center mb-1">
                          <h6 class="text-truncate mb-0 me-auto" v-if="item[item.length - 1].message_b">
                            {{ item[item.length - 1].message_b }}
                          </h6>
                          <h6 class="text-truncate mb-0 me-auto" v-else>
                            {{
                              item[item.length - 1].question
                                ? item[item.length - 1].question
                                : "新会话"
                            }}
                          </h6>
                        </div>
                        <div class="text-truncate h-20" v-html="item[item.length - 1].message
                          ? item[item.length - 1].message.replace(
                            /\n/g,
                            '<br />'
                          )
                          : '暂无消息'
                          "></div>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            </div>
          </ul>
          <a-modal v-model:visible="avatar_select" title="头像预设" :footer="false">
            <div class="avatar_preset" v-if="all_avatar_preset.length > 0">
              <a-space class="flex-wrap justify-between">
                <a-avatar class="cursor-pointer" :size="64" v-for="(a_item, a_index) in all_avatar_preset"
                  :imageUrl="a_item.avatar" width="200" @click="change_avatar(a_item.id)" />
              </a-space>
            </div>
            <a-empty v-else></a-empty>
          </a-modal>
        </div>
        <a-empty v-else />
        <a-pagination size="small" :total="ms_count" :current="page" :page-size="limit"
          class="justify-content-center mb-2 mt-2" background simple @change="handleCurrentChange"
          :hide-on-single-page="true" />
      </a-spin>
      <a-modal v-model:visible="beizhu_info" title="修改备注" @ok="handle_send">
        <a-input v-model="beizhu" />
      </a-modal>

      <template #footer>
        <div class="mb-3 dark:border-t-neutral-800">
          <div class="p-2 bg-n-6 rounded-xl">
            <a-trigger :trigger="['click', 'hover', 'focus']" v-if="token">
              <div class="flex items-center px-2.5 py-2.5 pb-4.5">
                <div class="relative w-10 h-10">
                  <a-avatar>
                    <img :src="user_info.avatar" alt="avatar" class="rounded-full w-10 h-10" />
                  </a-avatar>
                  <div
                    class="absolute -right-0.75 -bottom-0.75 w-4.5 h-4.5 rounded-full border-4 border-n-6 bg-green-300 top-1 border-green-300">
                  </div>
                </div>
                <div class="ml-1 mr-2">
                  <div class="base2 font-semibold text-n-1 text-truncate">
                    {{ user_info.name }}
                  </div>
                  <div class="caption1 font-semibold text-n-3/50 text-truncate">
                    {{ counter.setting.money_name_set }}:{{ user_info.money }}
                  </div>
                </div>
                <div
                  class="shrnik-0 ml-auto self-start px-3 bg-primary-2 rounded-lg caption1 font-bold text-n-7 pack_tag_vip">
                  {{ vip_level }}
                </div>
              </div>
              <template #content>
                <div class="nav-wraper">
                  <div class="user-info-box">
                    <div class="user-dis">
                      <a-avatar :imageUrl="user_info.avatar" class="rounded-full w-10 h-10">
                      </a-avatar>
                      <span class="nickname flex-wrap ml-1">
                        <span>{{ user_info.name }}</span>
                        <div class="shrnik-0 px-3 bg-primary-2 rounded-lg caption1 font-bold text-n-7 pack_tag_vip">
                          {{ vip_level }}
                        </div>
                      </span>
                    </div>
                    <div class="use-info user-type">
                      <span class="number">问答 </span><span>{{ user_qs }}</span><span>{{ last_msg }}/{{ total_msg }}次
                      </span>
                      <a-tag class="ml-1" color="#165dff" size="small">{{
                        check_vip_type(vip_type)
                        }}</a-tag>
                    </div>
                    <div class="use-info user-type">
                      <span class="number">绘画 </span><span>{{ last_draw }}/{{ total_draw }}次 </span>
                      <a-tag class="ml-1" color="#165dff" size="small">{{
                        check_vip_type(vip_type)
                        }}</a-tag>
                    </div>
                    <div class="use-info">
                      <span class="number">{{
                        counter.setting.money_name_set
                        }}</span><span>{{ user_info.money }}</span>
                    </div>
                    <div class="quit" @click="quit_out()">
                      <div name="quit" class="i-svg quit-icon-blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <g id="Group 1000007605">
                            <rect id="Rectangle 10" x="15.0001" y="9.41418" width="2" height="6" rx="1"
                              transform="rotate(-45 15.0001 9.41418)" fill="#057cff"></rect>
                            <rect id="Rectangle 11" x="19.2427" y="10.8284" width="2" height="6" rx="1"
                              transform="rotate(45 19.2427 10.8284)" fill="#057cff"></rect>
                            <rect id="Rectangle 12" x="19" y="11" width="2" height="11" rx="1"
                              transform="rotate(90 19 11)" fill="#057cff"></rect>
                            <path id="Rectangle 11218"
                              d="M17 3H7C5.89543 3 5 3.89543 5 5V19C5 20.1046 5.89543 21 7 21H17" stroke="#057cff"
                              stroke-width="2" stroke-linecap="round"></path>
                          </g>
                        </svg>
                      </div>
                      退出登录
                    </div>
                  </div>
                </div>
              </template>
            </a-trigger>

            <div class="flex items-center px-2.5 py-2.5 pb-4.5" v-else>
              <div class="relative w-10 h-10">
                <a-avatar :style="{ backgroundColor: '#3370ff' }">
                  <IconUser />
                </a-avatar>
                <div
                  class="absolute -right-0.75 -bottom-0.75 w-4.5 h-4.5 rounded-full border-4 border-n-6 bg-green-300 top-1 border-green-300">
                </div>
              </div>
              <div class="ml-1 mr-2">
                <div class="base2 font-semibold text-n-1 text-truncate">
                  请先登录
                </div>
              </div>
              <div
                class="shrnik-0 ml-auto self-start px-3 bg-primary-2 rounded-lg caption1 font-bold text-n-7 pack_tag_vip">
                {{ vip_level }}
              </div>
            </div>
            <a-button @click="login_dialog_click()" class="w-full" v-if="!token">
              用户登录
            </a-button>
            <a-button class="w-full" v-else @click="charge()">
              <div v-if="counter.setting.show_limit_front == '1'">
                VIP剩余
                <a-tag color="arcoblue" class="ml-1 mr-1"> {{ last_msg }}</a-tag>次问答
              </div>
              <div v-else>升级会员</div>
            </a-button>
          </div>
        </div>
      </template>
    </a-drawer>
    <Login :login_dialog="login_dialog" @handleCancel="handleCancel" />
    <Charge :dialogFormVisible="dialogFormVisible" @handleCancels="handleCancels" />
    <a-modal v-model:visible="img_download" class="message_export_modal" :footer="false">
      <template #title> 导出聊天记录 </template>
      <div class="export_message">
        <div class="flex justify-content-center">
          <a-space>
            <a-button @click="save_message_img('PNG')" type="primary" status="success">
              <template #icon>
                <icon-download />
              </template>
              导出PNG
            </a-button>
            <a-button @click="save_message_img('JPG')" type="primary" status="warning">
              <template #icon>
                <icon-download />
              </template>
              导出JPG
            </a-button>
            <a-button @click="reduce_chat()" type="primary">
              <template #icon>
                <icon-share-internal />
              </template>
              生成聊天链接
            </a-button>
          </a-space>
        </div>

        <div class="main all_message_export">
          <div class="chat-body bg-white border mt-2 h-full">
            <div class="chat-content overflow-visible">
              <div class="pb-32 sm:py-6 relative" ref="poster">
                <a-card hoverable class="m-2">
                  <div :style="{
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                  }">
                    <span :style="{
                      display: 'flex',
                      alignItems: 'center',
                      color: '#1D2129',
                    }">
                      <span class="mr-2" style="font-size: 40px">🥰</span>
                      <a-typography-text>{{
                        counter.setting.title
                        }}</a-typography-text>
                    </span>
                    <div class="flex flex-column">
                      <a-tag size="small" type="outline" class="mb-2">
                        模型：{{ model_is_select }}
                      </a-tag>
                      <a-tag size="small" type="outline" class="mb-2">
                        消息：{{ me_message.length * 2 }}
                      </a-tag>
                      <a-tag size="small" type="outline" class="mb-2">
                        时间：{{
                          me_message.length > 0
                            ? me_message[me_message.length - 1].created_at
                            : ""
                        }}
                      </a-tag>
                    </div>
                  </div>
                </a-card>

                <div class="container-xxl" v-if="me_message.length > 0">
                  <ul class="list-unstyled pt-5">
                    <!--qs-->

                    <div class="message_s" v-for="(item, index) in me_message" :key="index">
                      <li class="d-flex message right">
                        <div class="message-body">
                          <span class="date-time text-muted">{{ item.created_at }}
                          </span>
                          <div class="message-row d-flex align-items-center justify-content-end">
                            <div class="message-content me_content border p-3" v-if="item.question"
                              v-html="renderMarkdown(item.question)"></div>
                          </div>
                        </div>
                      </li>

                      <li class="d-flex message">
                        <div class="mr-lg-3 me-2">
                          <span class="mr-1" style="font-size: 40px">🥰</span>
                        </div>

                        <div class="message-body">
                          <span class="date-time text-muted">{{
                            item.created_at
                            }}</span>
                          <div class="message-row relative d-flex flex-column align-items-start">
                            <div class="message-content p-3" :class="index == me_message.length - 1 && !is_done
                              ? 'ms-up'
                              : ''
                              " v-html="item.message
                                ? renderMarkdown(item.message).replace(
                                  /\\n/g,
                                  '\n'
                                )
                                : ''
                                "></div>
                          </div>
                        </div>
                      </li>
                    </div>
                    <!--qs end-->
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </a-modal>
    <a-modal v-model:visible="dialog_html" title="代码运行" class="message_export_modal" :footer="false">
      <iframe :key="iframeKey" ref="iframes" style="width: 100%; height: 400px"></iframe>

    </a-modal>
  </main>
</template>

<script lang="ts" setup>
import { useCounter } from "~/store/counter";
import { ref } from "vue";

import ClipboardJS from "clipboard";
import hljs from "highlight.js";
import markdownIt from "markdown-it";
import markdownItKatex from "markdown-it-katex";
import fileSaver from "file-saver";
import { asBlob } from "html-docx-js-typescript";
import Speech from "speak-tts";
import mermaid from "mermaid";
import Recorder from "recorder-core";
import "recorder-core/src/engine/mp3";
import "recorder-core/src/engine/mp3-engine"; //如果此格式有额外的编码引擎（*-engine.js）的话，必须要加上
import { Message } from "@arco-design/web-vue";

import {
  IconEdit,
  IconDelete,
  IconNotification,
  IconSend,
  IconPublic,
  IconUser,
  IconVoice,
  IconCopy,
  IconPlus,
  IconCommand,
  IconRefresh,
  IconCode,
  IconRecordStop,
  IconDoubleDown,
  IconDoubleRight,
  IconShareInternal,
  IconDownload,
  IconFaceFrownFill,
  IconFaceSmileFill,
  IconLeft,
  IconRight,
  IconLoop,
  IconImage,
  IconCaretDown,
  IconList,
} from "@arco-design/web-vue/es/icon";
import * as htmlToImage from "html-to-image";
import { toPng, toJpeg } from "html-to-image";
import markdownItMatch from "markdown-it-math";
const img_download = ref(false);
const counter = useCounter();
const chat_open = ref(true);
definePageMeta({
  middleware: ["mustlogin"],
});
const voice_list = ref(false);
const voice_list_arr = ref([]);
const voice_page = ref(1);
const voice_limit = ref(10);
const voice_count = ref(0);
const voice_get_list = () => {
  voice_set_loading.value = true;
  voice_lists({
    page: voice_page.value,
    limit: voice_limit.value,
  })
    .then((res: any) => {
      voice_set_loading.value = false;
      voice_list_arr.value = res._rawValue.data;
      voice_count.value = res._rawValue.count;
    })
    .catch((err: any) => {
      voice_set_loading.value = false;
      console.log(err);
    });
};
const voice_change = () => {
  voice_list.value = !voice_list.value;
  voice_get_list();
};



const handleCancelVoice = () => {
  voice_list.value = false;
};
const renderMarkdown = (markdown: any) => {
  const md = markdownIt({
    linkify: true,
    highlight: (str, lang) => {
      if (lang === 'mermaid') {
        return `<pre class="mermaid">${markdownIt().utils.escapeHtml(str)}</pre>`;
      }

      if (lang && hljs.getLanguage(lang)) {
        try {
          return `<pre class="hljs"><span class="pre_copy">Copy</span><span class="run_code">运行代码</span><code>${hljs.highlight(str, {
            language: lang,
            ignoreIllegals: true
          }).value}</code></pre>`;
        } catch (__) { }
      }

      return `<pre class="hljs"><span class="pre_copy">Copy</span><span class="run_code">运行代码</span><code>${markdownIt().utils.escapeHtml(str)}</code></pre>`;
    },
    breaks: true
  }).use(markdownItMatch, {
    inlineOpen: "$",
    inlineClose: "$",
    blockOpen: "$$$",
    blockClose: "$$$",
    renderingOptions: {},
  });

  md.renderer.rules.link_open = function (tokens, idx, options, env, self) {
    const aIndex = tokens[idx].attrIndex("href");
    const url = tokens[idx].attrs[aIndex][1];
    // 检查链接是否以图像扩展名结尾
    if (/\.(png|jpg|jpeg|gif|svg)$/i.test(url)) {
      // 如果是图像链接，则跳过链接文本和链接关闭标签
      let nextIndex = idx + 1;
      while (
        nextIndex < tokens.length &&
        tokens[nextIndex].type !== "link_close"
      ) {
        if (tokens[nextIndex].type === "text") {
          // 跳过文本
          tokens[nextIndex].content = "";
        }
        nextIndex++;
      }
      // 返回图像标签
      return `<img src="${url}" alt=""/>`;
    }
    // 否则，使用默认渲染器
    return self.renderToken(tokens, idx, options);
  };

  md.renderer.rules.link_close = function (tokens, idx, options, env, self) {
    const openToken = tokens[idx - 2];
    const aIndex = openToken.attrIndex("href");
    const url = openToken.attrs[aIndex][1];
    // 如果是图像链接，则不渲染链接关闭标签
    if (/\.(png|jpg|jpeg|gif|svg)$/i.test(url)) {
      return "";
    }
    // 否则，使用默认渲染器
    return self.renderToken(tokens, idx, options);
  };

  const renderedMarkdown = md.render(markdown);

  if (is_done.value) {
    mermaid.initialize({ startOnLoad: true });
    mermaid.init(undefined, document.querySelectorAll(".mermaid"));
  }

  return renderedMarkdown;
};

useHead({
  title: "AI聊天 - " + counter.setting.title,
  meta: [
    { name: "description", content: counter.setting.description },
    { name: "keywords", content: counter.setting.keywords },
  ],
});

const plugins_select = ref("");
const plugins_list = ref([
  {
    title: "读取网站关键词",
    icon: '<svg t="1698160339582" class="icon mr-2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1244" width="32" height="32"><path d="M290.76 275l58.48 26-128 287.928-58.48-25.998zM431.105 271.84l254.514 434.983-55.239 32.32-254.514-434.982zM773.086 440.303l62.12 15.394-68.146 274.984-62.12-15.395z" fill="#3F454B" p-id="1245"></path><path d="M160 528c-61.856 0-112 50.144-112 112s50.144 112 112 112 112-50.144 112-112-50.144-112-112-112z m0 64c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.49-48 48-48zM816 256c-61.856 0-112 50.144-112 112s50.144 112 112 112 112-50.144 112-112-50.144-112-112-112z m0 64c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.49-48 48-48zM368 112c-61.856 0-112 50.144-112 112s50.144 112 112 112 112-50.144 112-112-50.144-112-112-112z m0 64c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.49-48 48-48zM706 672c-61.856 0-112 50.144-112 112s50.144 112 112 112 112-50.144 112-112-50.144-112-112-112z m0 64c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.49-48 48-48z" fill="#397AFF" p-id="1246"></path></svg>\n',
    id: "keywords",
    input_info: "格式如：https://www.baidu.com",
  },
  {
    title: "访问网页内容",
    icon: '<svg t="1698160816213" class="icon mr-2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1513" width="32" height="32"><path d="M880 112H144c-17.673 0-32 14.327-32 32v592c0 17.673 14.327 32 32 32h736c17.673 0 32-14.327 32-32V144c0-17.673-14.327-32-32-32z m-32 64v528H176V176h672z" fill="#3F454B" p-id="1514"></path><path d="M496.562 707.97a32 32 0 0 1 30.424-0.244l0.452 0.244 256 141c15.48 8.527 21.118 27.988 12.592 43.468-8.441 15.326-27.6 21.004-43.003 12.843l-0.465-0.251L512 772.532 271.438 905.03c-15.325 8.44-34.553 3-43.209-12.13l-0.259-0.462c-8.44-15.325-3-34.553 12.13-43.209l0.462-0.259 256-141z" fill="#3F454B" p-id="1515"></path><path d="M743.454 321.71c6.788-16.318 25.52-24.044 41.837-17.256 16.317 6.788 24.043 25.52 17.255 41.837-44.74 107.549-108.202 168.828-190.53 178.564-32.997 3.903-60.942-4.726-83.892-24.17-15.93-13.495-26.88-28.726-41.863-54.736l-7.598-13.332c-10.223-17.881-16.387-26.83-22.685-32.511-5.25-4.736-9.41-6.098-16.553-5.015-42.556 6.451-94.229 53.636-151.379 144.012-9.446 14.937-29.212 19.389-44.149 9.943-14.937-9.446-19.389-29.212-9.943-44.149C300.11 400.278 364.19 341.765 429.833 331.814c26.705-4.048 49.926 3.551 69.015 20.771 12.467 11.247 21.246 23.749 33.964 45.809l7.966 13.972c23.396 40.876 36.68 52.13 63.72 48.932 55.896-6.61 102.263-51.382 138.956-139.589z" fill="#397AFF" p-id="1516"></path></svg>\n',
    id: "url_read",
    input_info: "格式如：https://www.baidu.com",
  },
  {
    title: "视频内容识别",
    icon: '<svg t="1698509685987" class="icon mr-2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5475" width="32" height="32"><path d="M512 100v64H200a8 8 0 0 0-7.996 7.75L192 172v680a8 8 0 0 0 7.75 7.996l0.25 0.004h624a8 8 0 0 0 7.996-7.75L832 852V512h64v340c0 39.367-31.594 71.355-70.81 71.99L824 924H200c-39.367 0-71.355-31.594-71.99-70.81L128 852V172c0-39.367 31.594-71.355 70.81-71.99L200 100h312z" fill="#3F454B" p-id="5476"></path><path d="M836.433 115.75l55.134 32.5-224 380-55.134-32.5z" fill="#3F454B" p-id="5477"></path><path d="M652 241v64H272v-64zM539 576v64H272v-64zM448 417v64H272v-64z" fill="#397AFF" p-id="5478"></path></svg>',
    id: "video_read",
    input_info: "格式如：https://www.bilibili.com/video/BV1AN4y1k7Pg",
  },
  {
    title: "图片识别",
    icon: '<svg t="1699704058271" class="icon mr-2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6026" width="32" height="32"><path d="M676.032 368m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#397AFF" p-id="6027"></path><path d="M374.528 405.888a32 32 0 0 1 45.312-0.96l0.384 0.384 405.76 404.032a32 32 0 0 1-44.736 45.696l-0.384-0.384-382.72-380.928-277.056 289.408a32 32 0 0 1-44.8 1.28l-0.448-0.32a32 32 0 0 1-1.28-44.8l0.32-0.448 299.648-312.96z" fill="#397AFF" p-id="6028"></path><path d="M749.12 509.888a32 32 0 0 1 45.312-0.96l0.384 0.384 147.776 147.008a32 32 0 0 1-44.8 45.76l-0.384-0.384-124.608-124.032-108.672 113.408a32 32 0 0 1-44.864 1.28l-0.384-0.32a32 32 0 0 1-1.344-44.8l0.384-0.448 131.2-136.96z" fill="#397AFF" p-id="6029"></path><path d="M887.04 160H137.92c-39.744 0-72 32.256-72 72v560c0 39.744 32.256 72 72 72H887.04c39.808 0 72-32.256 72-72v-560c0-39.744-32.192-72-72-72z m-749.056 64H887.04c4.48 0 8 3.584 8 8v560a8 8 0 0 1-8 8H137.984a8 8 0 0 1-8-8v-560c0-4.416 3.584-8 8-8z" fill="#3F454B" p-id="6030"></path></svg>',
    id: "image_read",
    input_info: "",
  },
  {
    title: "联网搜索",
    icon: '<svg t="1699805667516" class="icon mr-2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6026" width="32" height="32"><path d="M564.491 191.135c2.596-17.481 18.872-29.548 36.354-26.952C787.847 191.952 928 353.097 928 544c0 212.077-171.923 384-384 384-122.108 0-234.738-57.42-306.835-153.08-10.637-14.113-7.818-34.178 6.295-44.815 14.114-10.637 34.178-7.819 44.815 6.295C348.405 816.18 442.201 864 544 864c176.731 0 320-143.269 320-320 0-157.484-114.49-290.696-267.895-315.784l-4.661-0.727c-17.481-2.596-29.549-18.872-26.953-36.354z" fill="#3F454B" p-id="6027"></path><path d="M379.787 95L67.585 635.75c-12.317 21.333 3.08 48 27.713 48h624.404c24.634 0 40.03-26.667 27.713-48L435.213 95c-12.317-21.333-43.109-21.333-55.426 0z m27.713 79.999L664.276 619.75H150.723L407.5 174.999z" fill="#397AFF" p-id="6028"></path></svg>',
    id: "online_search",
    input_info: "",
  },
]);
const getPlugins = (id: any) => {
  plugins_select.value = id;
  plugins_list.value.forEach((item: any) => {
    if (item.id == id) {
      ruleForm.message_input = item.input_info;
    }
  });
};
const actions = counter.setting.APP_URL + "/api/upload_model";

const beforeUpload = (file: any) => {
  const isJPG = file.type === "image/jpeg";
  const isPNG = file.type === "image/png";
  const ifPDF = file.type === "application/pdf";
  // 以下文件均可'doc','docx','xls','xlsx','ppt','pptx','txt'
  const isWord = file.type === "application/msword";
  const isWord2 =
    file.type ===
    "application/vnd.openxmlformats-officedocument.wordprocessingml.document";

  const isLt2M = file.size / 1024 / 1024 < 15;

  if (
    !isJPG &&
    !isPNG &&
    !ifPDF &&
    !isWord &&
    !isWord2 &&
    !isExcel &&
    !isExcel2 &&
    !isPPT
  ) {
    Message.error("上传图片只能是 JPG/PNG/PDF/Word 格式!");
    return false;
  }
  if (!isLt2M) {
    Message.error("上传文件大小不能超过 15MB!");
    return false;
  }
  return true;
};
const text_imageUrl = ref("");
const TextSuccess = (currentFile: any) => {
  // 获取currentFile里的response的data值
  if (currentFile.response.status != 200) {
    Message.error("上传失败!");
    return;
  }
  Message.success("上传成功!");
  if (plugins_select.value == "image_read") {
    text_imageUrl.value = currentFile.response.data;
    ruleForm.message_input = "这张图片是什么？";
  } else {
    text_imageUrl.value = currentFile.response.data;
  }
};

const now_html_code = ref('')
const dialog_html = ref(false)
const iframes = ref()
const iframeKey = ref(0); // 用于强制重新渲染 iframe

watch(dialog_html, (newVal) => {
  iframeKey.value += 1;
  // 当对话框打开关闭时，清空 iframe 内容
  const iframe = iframes.value;
  const doc = iframe.contentDocument || iframe.contentWindow.document;
  doc.open();
  doc.write(''); // 清空内容
  doc.close();
});
const handleClickEvent = (event: any) => {
  if (event.target.classList.contains('run_code')) {
    const codeElement = event.target.nextElementSibling;
    if (codeElement && codeElement.tagName === 'CODE') {
      dialog_html.value = true
      const codeContent = codeElement.innerText;
      now_html_code.value = codeContent;

      nextTick(() => {
        const iframe = iframes.value;
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        doc.open();
        doc.write(now_html_code.value);
        doc.close();
      });

    }
  } else if (event.target.classList.contains('pre_copy')) {
    const codeElement = event.target.nextElementSibling.nextElementSibling
    if (codeElement && codeElement.tagName === 'CODE') {
      const codeContent = codeElement.innerText;
      const input = document.createElement('input');
      input.setAttribute('readonly', 'readonly');
      input.setAttribute('value', codeContent);
      document.body.appendChild(input);
      input.select();
      if (document.execCommand('copy')) {
        document.execCommand('copy');
        Message.success('复制成功')
      } else {
        Message.error('复制失败')

      }
      document.body.removeChild(input);
    }
  }
};

const login_dialog = ref(false);
const login_dialog_click = () => {
  login_dialog.value = true;
};
const scene_preset = ref(false);
const handleCancel = () => {
  login_dialog.value = false;
};
const dialogFormVisible = ref(false);
const charge = () => {
  dialogFormVisible.value = true;
};
const handleCancels = () => {
  dialogFormVisible.value = false;
};
const model_big_choose = ref(
  counter.setting.normal_ai_select ? counter.setting.normal_ai_select : "gpt"
);

const token = useCookie("token");
const router = useRouter();
const messages = ref([]) as any;
const ms_active = ref(0);
const me_message = ref([]) as any;
const loadins = ref(false);
const send_loading = ref(false);
const data_load = ref(false);
const scene_model = ref([]) as any;
const m_last = ref({}) as any;
const avatar_select = ref(false);
const page = ref(1);
const limit = ref(8);
const ms_count = ref(0);
const left_loding = ref(false);
const answer_num = ref(
  counter.setting.chat_up_limit ? Number(counter.setting.chat_up_limit) : 3
);
const answer_tem = ref(0.8);
const knowledge_list = ref([]);
const now_choose_knowledge = ref([]);
const knowledge_add = ref(false);
const k_page = ref(1);
const k_limit = ref(6);
const public_page = ref(1);
const public_limit = ref(6);
const know_count = ref(0);
const know_loading = ref(false);
const knowledge_public_list = ref([]);
const knowledge_public_count = ref(0);
const knowledge_list_get = () => {
  know_loading.value = true;
  knowledge_list_gets({
    page: k_page.value,
    limit: k_limit.value,
    public_limit: public_limit.value,
    public_page: public_page.value,
  })
    .then((res: any) => {
      know_loading.value = false;
      knowledge_list.value = res._rawValue.data;
      know_count.value = res._rawValue.count;
      knowledge_public_list.value = res._rawValue.data_public;
      knowledge_public_count.value = res._rawValue.count_public;
    })
    .catch((err: any) => {
      know_loading.value = false;
      console.log(err);
    });
};
const handleCurrentChangeKnowledge = (val: any) => {
  k_page.value = val;
  knowledge_list_get();
};

const VoicehandleCurrentChange = (val: any) => {
  voice_page.value = val;
  voice_get_list();
};

const handleCurrentChangeKnowledgePublic = (val: any) => {
  public_page.value = val;
  knowledge_list_get();
};
const add_knowledge = () => {
  knowledge_add.value = true;
  knowledge_list_get();
};
const changeRadio = (ids: any) => {
  now_choose_knowledge.value = [];
  // ids是个数组
  for (let i = 0; i < ids.length; i++) {
    for (let j = 0; j < knowledge_list.value.length; j++) {
      if (knowledge_list.value[j].id == ids[i]) {
        now_choose_knowledge.value.push(knowledge_list.value[j]);
      }
    }
  }
};
const delnow_know = (id: any) => {
  for (let j = 0; j < now_choose_knowledge.value.length; j++) {
    if (now_choose_knowledge.value[j].id == id) {
      now_choose_knowledge.value.splice(j, 1);
    }
  }
  // know_check.value中的id包含也删除
  for (let j = 0; j < know_check.value.length; j++) {
    if (know_check.value[j] == id) {
      know_check.value.splice(j, 1);
    }
  }
};
const add_knowledge_go = () => {
  router.push("/knowledge");
};
const know_check = ref([]);
const exportPdf = async (info: any) => {
  generatePdf({
    content: info,
  }).then((res: any) => {
    const blob = new Blob([res._rawValue], { type: "application/pdf" });
    // 使用FileSaver.js保存文件并提供下载链接
    saveAs(blob, "example.pdf");
  });
};

const exportWord = (info: any) => {
  asBlob(info).then((blob: any) => {
    fileSaver.saveAs(blob, "answer.docx");
  });
};
onMounted(async () => {
  // 先获取数据
  // nextTick保证你的获取到的已转成html的markdown内容已经更新到HTML的DOM结构中了。
  await nextTick();
  //  然后执行高亮即可
  speechInit();
});
const speech = ref();
const all_avatar_preset = ref([]);
const get_avatar = () => {
  get_avatar_preset().then((res: any) => {
    all_avatar_preset.value = res._rawValue.data;
  });
};
const send_avatar = () => {
  avatar_select.value = true;
  get_avatar();
};

const change_avatar = (id: number) => {
  c_avatar_session({
    avatar_preset_id: id,
    session_id: ms_active.value,
  }).then((res: any) => {
    avatar_select.value = false;
    Message.success("头像修改成功");
    all_message();
  });
};
const speechInit = () => {
  speech.value = new Speech();
  speech.value.setLanguage("zh-CN");
  speech.value.init().then(() => { });
};
const chat_speak = ref("normal");
const speak_is_audio = ref(false);
const speak = (info: any) => {
  speech.value.cancel();
  speak_is_audio.value = true;
  if (chat_speak.value == "normal") {
    speech.value
      .speak({
        text: info,
        listeners: {
          onend: () => {
            speech.value.cancel();
          },
        },
      })
      .then(() => {
        speak_is_audio.value = false;
        Message.success("语音播放完成");
      });
  } else {
    ChatranscribeAudio(info);
  }
};

const stop_speak = () => {
  speech.value.cancel();
  speak_is_audio.value = false;
};

const last_msg = ref(0);
const last_draw = ref(0);
// 请求左侧列表
const all_message = () => {
  left_loding.value = true;
  data_load.value = true;
  get_message({
    page: page.value,
    limit: limit.value,
  })
    .then((res: any) => {
      messages.value = res._rawValue.data;
      m_last.value = res._rawValue.m_last;
      ms_count.value = res._rawValue.count;
      max_session.value = res._rawValue.max_session;
      left_loding.value = false;
      data_load.value = false;
    })
    .catch((err: any) => {
      data_load.value = false;
      left_loding.value = false;
      console.log(err);
    });
};

const all_message_sub = () => {
  return new Promise((resolve, reject) => {
    left_loding.value = true;
    data_load.value = true;
    get_message({
      page: page.value,
      limit: limit.value,
    })
      .then((res: any) => {
        messages.value = res._rawValue.data;
        m_last.value = res._rawValue.m_last;
        ms_count.value = res._rawValue.count;
        max_session.value = res._rawValue.max_session;
        left_loding.value = false;
        data_load.value = false;
        resolve(null);
      })
      .catch((err: any) => {
        data_load.value = false;
        left_loding.value = false;
        console.log(err);
        reject(err);
      });
  });
};

const user_info = ref({}) as any;
const vip_level = ref("free");
const save_message_img = (ext: any) => {
  let node = document.querySelector(".all_message_export");
  // 设置node节点overflow:hidden
  if (ext == "PNG") {
    htmlToImage
      .toPng(<HTMLElement>node, {
        cacheBust: false,
        useCorsEverywhereProxy: true,
      })
      .then(function (dataUrl) {
        const link = document.createElement("a");
        link.href = dataUrl;
        link.download = "message.png";
        link.click();
      })
      .catch(function (error) {
        console.error("oops, something went wrong!", error);
      });
  } else {
    htmlToImage
      .toJpeg(<HTMLElement>node)
      .then(function (dataUrl) {
        const link = document.createElement("a");
        link.download = "message.jpeg";
        link.href = dataUrl;
        link.click();
      })
      .catch(function (error) {
        console.error("oops, something went wrong!", error);
      });
  }
};
const total_msg = ref(0);
const total_draw = ref(0);
const vip_type = ref("free");
const user_qs = ref(0);
const user_draw = ref(0);
const get_limit = () => {
  get_user_limit()
    .then((res: any) => {
      last_msg.value = res._rawValue.last_msg;
      last_draw.value = res._rawValue.last_draw;
      total_msg.value = res._rawValue.total_msg;
      total_draw.value = res._rawValue.total_draw;
      user_info.value = res._rawValue.user_info;
      vip_level.value = res._rawValue.vip_level;
      vip_type.value = res._rawValue.vip_type;
      user_qs.value = res._rawValue.user_qs;
      user_draw.value = res._rawValue.user_draw;
    })
    .catch((err: any) => {
      console.log(err);
    });
};
const check_vip_type = (type: string) => {
  if (type == "free") {
    return "免费版";
  } else if (type == "day") {
    return "每日";
  } else if (type == "month") {
    return "每月";
  } else if (type == "total") {
    return "有效期内";
  } else {
    return "免费版";
  }
};
const quit_out = () => {
  token.value = "";

  router.go(0);
};
if (token.value) {
  all_message();
  get_limit();
  knowledge_list_get();
}

const max_session = ref(0);
const s_page = ref(1);
const s_limit = ref(4);
const change_status = ref(true);
const model_list = ref([]) as any;
const model_is_select = ref();
const scene_p_model = ref([]);


const chat_bg_cookie = useCookie("chat_bg");
const bg_change = (bg: any) => {
  chat_bg_cookie.value = bg;
};
const remove_bg = () => {
  chat_bg_cookie.value = "";
};

const chat_bg = ref([]);
const big_model_list = ref([])
const scene_all = () => {
  get_scene_f({
    page: s_page.value,
    limit: s_limit.value,
  })
    .then((res: any) => {
      scene_model.value = res._rawValue.data;
      scene_p_model.value = res._rawValue.p_data;
      scene_count.value = res._rawValue.count;
      model_list.value = res._rawValue.model;
      chat_bg.value = res._rawValue.chat_bg;
      big_model_list.value = res._rawValue.model;
      model_list.value = res._rawValue.model[0].small_model;
      if (model_list.value.length > 0) {
        model_is_select.value = model_list.value[0].model;
        now_model_title.value = model_list.value[0].title;
      }
    })
    .catch((err: any) => {
      console.log(err);
    });
};
scene_all();

const big_model_change = (val: any) => {
  model_list.value = [];
  for (let i = 0; i < big_model_list.value.length; i++) {
    if (big_model_list.value[i].type == val) {
      model_list.value = big_model_list.value[i].small_model;
      model_is_select.value = model_list.value[0]?.model;
      now_model_title.value = model_list.value[0]?.title;
    }
  }
};

const small_model_change = (val: any) => {
  for (let i = 0; i < model_list.value.length; i++) {
    if (model_list.value[i].model == val) {
      now_model_title.value = model_list.value[i].title;
      model_is_select.value = model_list.value[i].model;
    }
  }
  if (ms_active.value != 0) {
    updata_model_message({
      session_id: ms_active.value,
      model: model_is_select.value,
    })
      .then((res: any) => {
        Message.success("模型切换成功");
      })
      .catch((err: any) => {
        console.log(err);
      });
  }
};

const handleCurrentChange = (val: number) => {
  left_loding.value = true;
  if (qs_input.value) {
    searchs({
      search: qs_input.value,
      page: val,
      limit: limit.value,
    })
      .then((res: any) => {
        page.value = val;
        messages.value = res._rawValue.data;
        ms_count.value = res._rawValue.count;
        left_loding.value = false;
        Message.success("搜索完成");
      })
      .catch((err: any) => {
        Message.error(err.message);
        left_loding.value = false;
      });
  } else {
    get_message({
      page: val,
      limit: limit,
    })
      .then((res: any) => {
        page.value = val;
        messages.value = res._rawValue.data;
        ms_count.value = res._rawValue.count;
        left_loding.value = false;
      })
      .catch((err: any) => {
        left_loding.value = false;
        console.log(err);
      });
  }
};

const delete_this = (id: number) => {
  delete_message({
    id: id,
  })
    .then((res: any) => {
      Message.success("删除成功");
      if (me_message.value.length == 1) {
        ms_active.value = 0;
        check_message(ms_active.value);
        all_message();
      } else {
        check_message(ms_active.value);
        all_message();
      }
    })
    .catch((err: any) => {
      Message.error(err.message);
    });
};
const know_tab = ref("me");
const scene_loading = ref(false);
const handleCurrentChangeScene = (val: number) => {
  scene_loading.value = true;
  if (change_status.value) {
    if (scene_search.value) {
      s_page.value = val;
      scene_searchs({
        search: scene_search.value,
        page: val,
        limit: s_limit.value,
      })
        .then((res: any) => {
          s_page.value = val;
          scene_model.value = res._rawValue.data;
          scene_count.value = res._rawValue.count;
          Message.success("搜索完成");
          scene_loading.value = false;
        })
        .catch((err: any) => {
          Message.error(err.message);
          scene_loading.value = false;
        });
    } else {
      get_scene_f({
        page: val,
        limit: s_limit.value,
      })
        .then((res: any) => {
          s_page.value = val;
          scene_model.value = res._rawValue.data;
          scene_count.value = res._rawValue.count;
          scene_loading.value = false;
        })
        .catch((err: any) => {
          console.log(err);
          scene_loading.value = false;
        });
    }
    change_status.value = true;
  }
};

const handleSizeChange = (val: number) => {
  limit.value = val;
  left_loding.value = true;
  get_message({
    page: page.value,
    limit: val,
  })
    .then((res: any) => {
      messages.value = res._rawValue.data;
      ms_count.value = res._rawValue.count;
      left_loding.value = false;
    })
    .catch((err: any) => {
      left_loding.value = false;
      console.log(err);
    });
};

// 单独请求聊天记录
const check_message = (id: number) => {
  SceneForm.domains = [];
  return new Promise((resolve, reject) => {
    ms_active.value = id;
    loadins.value = true;
    c_message({
      session_id: id,
    })
      .then((res: any) => {
        me_message.value = res._rawValue.data;
        if (me_message.value.length > 0) {
          if (me_message.value[0].model) {
            // model_list是个数组，先找到big_model_list每个数组下的small_model数组 如果有就赋值给model_list
            for (let i = 0; i < big_model_list.value.length; i++) {
              for (let j = 0; j < big_model_list.value[i].small_model.length; j++) {
                if (big_model_list.value[i].small_model[j].model == me_message.value[me_message.value.length - 1].model) {
                  model_list.value = big_model_list.value[i].small_model;
                }
              }
            }

            model_big_choose.value = me_message.value[me_message.value.length - 1].type;
            model_is_select.value = me_message.value[me_message.value.length - 1].model;
            now_model_title.value = model_list.value.filter((item: any) => item.model == me_message.value[me_message.value.length - 1].model)[0].title;
          }

        }
        loadins.value = false;
        down_message();
        resolve(null);
        text_imageUrl.value = "";
      })
      .catch((err: any) => {
        loadins.value = false;
        reject(err);
      });
  });
};

const check_messages = (id: number) => {
  return new Promise((resolve, reject) => {
    ms_active.value = id;
    c_message({
      session_id: id,
    })
      .then((res: any) => {
        me_message.value = res._rawValue.data;
        if (me_message.value.length > 0) {
          if (me_message.value[0].model) {
            // model_list是个数组，先找到big_model_list每个数组下的small_model数组 如果有就赋值给model_list
            for (let i = 0; i < big_model_list.value.length; i++) {
              for (let j = 0; j < big_model_list.value[i].small_model.length; j++) {
                if (big_model_list.value[i].small_model[j].model == me_message.value[me_message.value.length - 1].model) {
                  model_list.value = big_model_list.value[i].small_model;
                }
              }
            }

            model_big_choose.value = me_message.value[me_message.value.length - 1].type;
            model_is_select.value = me_message.value[me_message.value.length - 1].model;
            now_model_title.value = model_list.value.filter((item: any) => item.model == me_message.value[me_message.value.length - 1].model)[0].title;
          }

        }
        down_message();
        text_imageUrl.value = "";
        resolve(null);
      })
      .catch((err: any) => {
        reject(err);
      });
  });
};

const add_loading = ref(true);
const add_new_chat = () => {
  add_chat()
    .then((res: any) => {
      all_message();
      model_list.value = find_big_model(model_is_select.value);
      check_message(res._rawValue.data);
    })
    .catch((err: any) => {
      Message.error(err.message);
    });
};

//函数 根据小模型找到大模型 并且返回大模型下的small_model数组
const find_big_model = (val: any) => {
  for (let i = 0; i < big_model_list.value.length; i++) {
    for (let j = 0; j < big_model_list.value[i].small_model.length; j++) {
      if (big_model_list.value[i].small_model[j].model == val) {
        model_big_choose.value = big_model_list.value[i].type;
        return big_model_list.value[i].small_model;
      }
    }
  }
};

const normal_message = ref([]);
const normal_loading = ref(true);
const get_normal_tips = () => {
  get_normal()
    .then((res: any) => {
      normal_message.value = res._rawValue.data;
      normal_loading.value = false;
    })
    .catch((err: any) => {
      console.log(err);
    });
};
get_normal_tips();

const items = [
  {
    key: "key",
    label: "基础配置",
  },
  {
    key: "scene",
    label: "场景配置",
  },
];

const is_read = useCookie("is_read", { maxAge: 60 * 60 * 24 });

const notice = ref(
  is_read.value == "on" || counter.setting.notice_open != "1" ? false : true
);
const save_notice = () => {
  notice.value = false;
  is_read.value = "on";
};

const down_message = () => {
  setTimeout(() => {
    let chat = document.getElementsByClassName("chat-content")[0];
    chat.style.transition = "1500ms"; // 过渡时间为0.5秒
    chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });
  }, 100);
};

// 发送消息
const ruleForm = reactive({
  message_input: "",
});

const rules = reactive<FormRules>({
  message_input: [{ required: true, message: "请输入内容", trigger: "blur" }],
});

const {
  public: { baseUrl },
} = useRuntimeConfig();

const headers = {
  Authorization: `Bearer ${token.value}`,
  Accept: "text/event-stream",
};
const is_done = ref(true);
const streams = ref();
const up_stop = ref("start");
const formRef = ref();
const isInvalidJSON = (data: string) => {
  try {
    JSON.parse(data);
    return true; // 解析成功，是错误的 JSON 数据
  } catch (error) {
    return false; // 解析失败，不是错误的 JSON 数据
  }
};
const stop_stream = () => {
  up_stop.value = "end";
  is_done.value = true;
  send_loading.value = false;
  ruleForm.message_input = "";
};

const refresh_answer = (qs: any) => {
  ruleForm.message_input = qs;
  check_sub()
};
const contentString = ref("");
const submitForm = async () => {
  if (ruleForm.message_input == "") {
    Message.warning("请输入内容");
    return false;
  }
  if (send_loading.value == true) {
    Message.warning("请等待上一条消息发送完成");
    return false;
  }
  if (event.shiftKey) {
    const textarea = event.target;
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;

    // 在光标位置插入换行符
    ruleForm.message_input =
      ruleForm.message_input.substring(0, start) +
      '\n' +
      ruleForm.message_input.substring(end);

    // 更新光标位置
    await nextTick();
    textarea.selectionStart = textarea.selectionEnd = start + 1;

    // 阻止默认行为
    event.preventDefault();
    return false;
  }
  if (!token.value) {
    Message.warning("请先登录");
    login_dialog_click();
    return false;
  }

  send_loading.value = true;

  me_message.value.push({
    session_id: ms_active.value,
    question: ruleForm.message_input,
    message: "思考中...",
  });
  down_message();


  const res = await fetch(`${window.APP_CONFIG.baseUrl}send_bot`, {
    method: "POST",
    headers: headers,
    body: JSON.stringify({
      info: ruleForm.message_input,
      session_id: ms_active.value,
      scene_preset: SceneForm.domains,
      model_is_select: model_is_select.value,
      answer_num: answer_num.value,
      answer_tem: answer_tem.value,
      now_choose_knowledge: know_check.value,
      plugins_select: plugins_select.value,
      text_imageUrl: text_imageUrl.value,
    }),
  });

  up_stop.value = "start";
  if (res) {
    me_message.value[me_message.value.length - 1].message = "";
  }
  if (
    res.status == 500 ||
    res.status == 401 ||
    res.status == 405 ||
    res.status == 402 ||
    res.status == 403
  ) {
    const responseData = await res.json();
    send_loading.value = false;
    Message.error(responseData.message);
    return false;
  }

  let reply_in = false;

  let partialData = "";

  const stream = res.body?.getReader();
  const onData = ({ value }: { value: Uint8Array }) => {
    const chunk = new TextDecoder().decode(value);
    if (isInvalidJSON(chunk)) {
      const json = JSON.parse(chunk);
      if (json.error && json.error.message) {
        me_message.value[me_message.value.length - 1].message =
          json.error.message;
        return; // 或者进行其他错误处理
      }
      return;
    }
    const lines = (partialData + chunk).split("\n");

    partialData = lines.pop() || "";

    for (const line of lines) {
      if (line.trim() === "data: [DONE]") {
        // 如果是最后一行，跳过处理
        continue;
      }

      try {
        const trimmedLine = line.trim(); // 去除行首尾的空格
        if (trimmedLine.startsWith("data:")) {
          const jsonData = trimmedLine.slice(5); // 去除 "data:" 前缀
          const json = JSON.parse(jsonData);
          if (json.choices) {
            for (const choice of json.choices) {
              const content = choice.delta?.content;
              if (content) {
                me_message.value[me_message.value.length - 1].message += content;
                setTimeout(() => {
                  down_message();
                }, 2000);
              }
              if (choice.finish_reason === "stop") {
                break;
              }
            }
          }
        }
      } catch (e) {
        console.error(e);
      }
    }
  };

  const read = async () => {
    const result = await stream?.read();
    if (up_stop.value == "end") {
      console.log("end");
      up_stop.value = "start";
      stream?.cancel();
      return false;
    }
    if (result?.done) {
      console.log("done");
      is_done.value = true;
      get_limit();
      send_loading.value = false;
      ruleForm.message_input = "";
      if (ms_active.value == 0) {
        await all_message_sub();
        if (ms_active.value == 0) {
          ms_active.value = m_last.value.session_id;
        }
        await check_message(ms_active.value);
      } else {
        await check_messages(ms_active.value);
      }
    } else {
      send_loading.value = true;
      is_done.value = false;
      onData(result!);
      await read();
    }
  };
  await read();
};

const cookie_message = useCookie("message");
if (counter.setting.no_login_aiqs == "1" && !token.value) {
  if (cookie_message.value) {
    me_message.value = cookie_message.value;
  }
}

const is_can_upload = (models: any) => {
  // 找到model_list中的model是否is_upload为1
  const model = Object.values(model_list.value) as any;

  for (let i = 0; i < model.length; i++) {
    if (model[i].model == models) {
      if (model[i].is_upload == 1) {
        return true;
      } else {
        return false;
      }
    }
  }
}

// audio send

// audio send end
const submitFormNoLogin = async () => {
  if (ruleForm.message_input == "") {
    Message.warning("请输入内容");
    return false;
  }
  if (send_loading.value == true) {
    Message.warning("请等待上一条消息发送完成");
    return false;
  }
  if (event.shiftKey) {
    // 按下shift键，插入换行符
    const textarea = event.target;
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;

    // 在光标位置插入换行符
    ruleForm.message_input =
      ruleForm.message_input.substring(0, start) +
      '\n' +
      ruleForm.message_input.substring(end);

    // 更新光标位置
    await nextTick();
    textarea.selectionStart = textarea.selectionEnd = start + 1;

    // 阻止默认行为
    event.preventDefault();
    return false;
  }

  send_loading.value = true;

  me_message.value.push({
    session_id: ms_active.value,
    question: ruleForm.message_input,
    message: "思考中...",
  });
  down_message();

  const res = await fetch(`${window.APP_CONFIG.baseUrl}no_send_bot`, {
    method: "POST",
    headers: headers,
    body: JSON.stringify({
      info: ruleForm.message_input,
      session_id: ms_active.value,
      model_select: model_is_select.value,
      scene_preset: SceneForm.domains,
      answer_tem: answer_tem.value,
    }),
  });

  up_stop.value = "start";
  if (res) {
    me_message.value[me_message.value.length - 1].message = "";
  }
  if (res.status == 500) {
    send_loading.value = false;
    Message.error("服务器错误");
    return false;
  }

  if (res.status == 402) {
    send_loading.value = false;
    me_message.value[me_message.value.length - 1].message =
      "未登录用户提问达到上限,,请登录继续免费使用";
    Message.error("未登录用户提问达到上限,请登录继续免费使用");
    return false;
  }
  if (res.status == 403) {
    send_loading.value = false;
    me_message.value[me_message.value.length - 1].message = "禁止发送违禁词";
    Message.error("禁止发送违禁词");
    return false;
  }
  const stream = res.body?.getReader();
  const onData = ({ value }: { value: Uint8Array }) => {
    let result = new TextDecoder().decode(value);
    // console.log(result);
    let arr = result.split("\n\n").map((str) => str.replace(/\n/g, ""));
    let new_arr: any[] = [];
    // console.log(arr)
    for (let i = 0; i < arr.length; i++) {
      is_done.value = false;
      if (
        (arr[i].slice(-2) == "]}" || arr[i].slice(-2) == "l}") &&
        arr[i].startsWith("data:")
      ) {
        new_arr.push(JSON.parse(arr[i].replace("data:", "")));
      } else if (
        arr[i].startsWith("data:") &&
        (arr[i].slice(-2) != "]}" || arr[i].slice(-2) != "l}")
      ) {
        streams.value = arr[i].replace("data:", "");
      } else if (
        (arr[i].slice(-2) == "]}" || arr[i].slice(-2) == "l}") &&
        arr[i].startsWith("data:") == false
      ) {
        // 与streams.value拼接成一个字符串
        let str = (streams.value += arr[i]);
        new_arr.push(JSON.parse(str.replace("data:", "")));
        streams.value = "";
      } else {
        if (arr[i].includes('"error"')) {
          me_message.value[me_message.value.length - 1].message = JSON.parse(
            arr[i]
          ).error.message;
        }
        streams.value = "";
      }
    }

    // console.log(new_arr)
    for (let i = 0; i < new_arr.length; i++) {
      setTimeout(() => {
        if (new_arr[i].choices[0].delta.content) {
          me_message.value[me_message.value.length - 1].message +=
            new_arr[i].choices[0].delta.content;
        }
        setTimeout(() => {
          down_message();
        }, 2000);
      }, 100);
    }
  };

  const read = async () => {
    const result = await stream?.read();
    if (up_stop.value == "end") {
      console.log("end");
      up_stop.value = "start";
      stream?.cancel();
      return false;
    }
    if (result?.done) {
      console.log("done");
      is_done.value = true;
      send_loading.value = false;
      ruleForm.message_input = "";
      cookie_message.value = me_message.value;
    } else {
      send_loading.value = true;
      is_done.value = false;
      onData(result!);
      await read();
    }
  };
  await read();
};

const qs_input = ref("");
const qs_search = () => {
  if (!qs_input.value) {
    Message.warning("请输入内容");
    return;
  }
  searchs({
    search: qs_input.value,
    page: page.value,
    limit: limit.value,
  })
    .then((res: any) => {
      messages.value = res._rawValue.data;
      ms_count.value = res._rawValue.count;
      Message.success("搜索完成");
    })
    .catch((err: any) => {
      Message.error(err.message);
    });
};

const handleCommand = (command: any) => {
  ruleForm.message_input = scene_model.value[command].Instruction;
};

const delete_msg = (id: number) => {
  del_msg({
    session_id: id,
  })
    .then((res: any) => {
      Message.success(res._rawValue.message);
      all_message();
      ms_active.value = 0;
      me_message.value = [];
    })
    .catch((err: any) => {
      console.log(err);
    });
};

const delete_all = () => {
  del_all()
    .then((res: any) => {
      Message.success(res._rawValue.message);
      all_message();
      ms_active.value = 0;
      me_message.value = [];
    })
    .catch((err: any) => {
      console.log(err);
    });
  return true;
};

const handleClick = (command: any) => {
  const textarea = document.createElement("textarea");
  textarea.value = command.replace(/&nbsp;/g, " ");
  textarea.setAttribute("readonly", "");
  textarea.style.position = "absolute";
  textarea.style.left = "-9999px";
  document.body.appendChild(textarea);
  textarea.select();
  document.execCommand("copy");
  document.body.removeChild(textarea);
  Message.success("复制成功");
};

const posterimg = ref();
// 绑定  需要把那个内容生成图片
const poster = ref();

const drawer = ref(false);
const direction = ref("ltr");
const change_side = () => {
  drawer.value = true;
};
const now_model_title = ref("");
const handleSelect = (smallModelID: any) => {
  for (let i = 0; i < model_list.value.length; i++) {
    if (model_list.value[i].id == smallModelID) {
      now_model_title.value = model_list.value[i].title;
      model_is_select.value = model_list.value[i].model;
    }
  }

  // 判断ms_active是否为0
  if (ms_active.value != 0) {
    updata_model_message({
      session_id: ms_active.value,
      model: model_is_select.value,
    })
      .then((res: any) => {
        console.log(res);
      })
      .catch((err: any) => {
        console.log(err);
      });
  }
};
const dialog_scene = ref(false);
const scene_search = ref("");
const scene_count = ref(0);
const scene_insearch = () => {
  scene_searchs({
    search: scene_search.value,
    page: s_page.value,
    limit: s_limit.value,
  })
    .then((res: any) => {
      scene_model.value = res._rawValue.data;
      scene_count.value = res._rawValue.count;
      Message.success("搜索完成");
    })
    .catch((err: any) => {
      Message.error(err.message);
    });
};
const scene_id = ref("");
const selectedItem = (item: any, preset: any, ids: any) => {
  ruleForm.message_input = item;
  dialog_scene.value = false;
  scene_id.value = ids;
  update_scene({
    id: ids,
  })
    .then((res: any) => {
      console.log(res);
    })
    .catch((err: any) => {
      console.log(err);
    });
  const arrs = JSON.parse(preset);
  SceneForm.domains = [];
  if (arrs == null || arrs == "") {
    return;
  }
  for (let i = 0; i < arrs.length; i++) {
    SceneForm.domains.push({
      key: Date.now(),
      value: arrs[i].content,
      sel: arrs[i].role,
    });
  }
};

const selectedItems = (item: any, preset: any) => {
  ruleForm.message_input = item;
  dialog_scene.value = false;
  SceneForm.domains = [];
  if (preset) {
    for (let i = 0; i < preset.length; i++) {
      SceneForm.domains.push({
        key: Date.now(),
        value: preset[i].content,
        sel: preset[i].role,
      });
    }
  }
};
const change_sname = (id: number) => {
  beizhu_info.value = true;
  ms_active.value = id;
};
const beizhu_info = ref(false);
const beizhu = ref("");
const handle_send = () => {
  if (!beizhu.value) {
    Message.warning("请输入内容");
    return true;
  }
  change_session_name(ms_active.value, beizhu.value);
  beizhu.value = "";
};
const change_session_name = (session_id: any, name: any) => {
  c_session_name({
    session_id: session_id,
    session_name: name,
  })
    .then((res: any) => {
      Message.success(res._rawValue.message);
      all_message();
    })
    .catch((err: any) => {
      Message.error(err.message);
    });
};

const formRefScene = ref<FormInstance>();
const SceneForm = reactive<{
  domains: DomainItem[];
}>({
  domains: [],
});

interface DomainItem {
  key: number;
  value: string;
  sel: string;
}

const domainOptions = [
  {
    value: "system",
    label: "system",
  },
  {
    value: "user",
    label: "user",
  },
  {
    value: "assistant",
    label: "assistant",
  },
];
const removeDomain = (item: DomainItem) => {
  const index = SceneForm.domains.indexOf(item);
  if (index !== -1) {
    SceneForm.domains.splice(index, 1);
  }
};

const addDomain = () => {
  SceneForm.domains.push({
    key: Date.now(),
    value: "",
    sel: "system",
  });
};

const resetForm = (formEl: FormInstance | undefined) => {
  if (!formEl) return;
  formEl.resetFields();
};
const check_sub = () => {
  if (counter.setting.no_login_aiqs == "1" && !token.value) {
    submitFormNoLogin();
  } else if (model_big_choose.value == "gpt") {
    submitForm();
  } else if (model_big_choose.value == "fly") {
    submitFormFly();
  } else if (model_big_choose.value == "baidu") {
    submitFormBaidu();
  } else if (model_big_choose.value == "chatglm") {
    submitFormGLM();
  } else if (model_big_choose.value == "qwen") {
    submitFormQwen();
  } else if (model_big_choose.value == "tencent") {
    submitFormTencent();
  } else if (model_big_choose.value == "kimi") {
    submitFormKimi();
  } else {
    submitForm();
  }
};
const submitForms = async (url, onData) => {
  if (ruleForm.message_input === "") {
    Message.warning("请输入内容");
    return false;
  }
  if (send_loading.value) {
    Message.warning("请等待上一条消息发送完成");
    return false;
  }
  if (event.shiftKey) {
    const textarea = event.target;
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    ruleForm.message_input =
      ruleForm.message_input.substring(0, start) +
      '\n' +
      ruleForm.message_input.substring(end);
    await nextTick();
    textarea.selectionStart = textarea.selectionEnd = start + 1;
    event.preventDefault();
    return false;
  }
  if (!token.value) {
    Message.warning("请先登录");
    login_dialog_click();
    return false;
  }

  send_loading.value = true;
  me_message.value.push({
    session_id: ms_active.value,
    question: ruleForm.message_input,
    message: "思考中...",
  });
  down_message();

  const formData = new FormData();
  formData.append("info", ruleForm.message_input);
  formData.append("session_id", ms_active.value);
  formData.append("scene_preset", SceneForm.domains);
  formData.append("model_is_select", model_is_select.value);
  formData.append("answer_num", answer_num.value);
  formData.append("answer_tem", answer_tem.value);
  formData.append("now_choose_knowledge", know_check.value);

  const res = await fetch(`${window.APP_CONFIG.baseUrl}${url}`, {
    method: "POST",
    headers: headers,
    body: formData,
  });

  up_stop.value = "start";
  if (res) {
    me_message.value[me_message.value.length - 1].message = "";
  }

  if (res.status >= 400 && res.status < 500) {
    const responseData = await res.json();
    send_loading.value = false;
    Message.error(responseData.message || "发生错误");
    return false;
  }

  const stream = res.body?.getReader();

  const read = async () => {
    const result = await stream?.read();
    if (up_stop.value === "end") {
      up_stop.value = "start";
      stream?.cancel();
      return false;
    }
    if (result?.done) {
      is_done.value = true;
      get_limit();
      send_loading.value = false;
      ruleForm.message_input = "";
      if (ms_active.value === 0) {
        await all_message_sub();
        if (ms_active.value === 0) {
          ms_active.value = m_last.value.session_id;
        }
        await check_message(ms_active.value);
      } else {
        await check_messages(ms_active.value);
      }
    } else {
      send_loading.value = true;
      is_done.value = false;
      onData(result);
      await read();
    }
  };
  await read();
};

const submitFormFly = () => submitForms("send_fly_msg", ({ value }) => {
  let result = new TextDecoder().decode(value);
  let arr = result.split("\n\n").map((str) => str.replace(/\n/g, ""));
  let new_arr = [];
  for (let i = 0; i < arr.length; i++) {
    is_done.value = false;
    if (arr[i].slice(-2) == "}}" && arr[i].startsWith("data:")) {
      new_arr.push(JSON.parse(arr[i].replace("data:", "")));
    } else if (arr[i].startsWith("data:") && arr[i].slice(-2) != "]}") {
      streams.value = arr[i].replace("data:", "");
    } else if (arr[i].slice(-2) == "}}" && !arr[i].startsWith("data:")) {
      let str = (streams.value += arr[i]);
      new_arr.push(JSON.parse(str.replace("data:", "")));
      streams.value = "";
    } else {
      if (arr[i].includes('"error"')) {
        me_message.value[me_message.value.length - 1].message = JSON.parse(arr[i]).error.message;
      }
      streams.value = "";
    }
    if (arr[i].includes("reply_content:")) {
      let content = arr[i].substring(14);
      for (let i = 0; i < content.length; i++) {
        setTimeout(() => {
          me_message.value[me_message.value.length - 1].message += content.charAt(i);
          setTimeout(() => down_message(), 2000);
        }, 1000);
      }
    }
  }
  new_arr.forEach(item => {
    setTimeout(() => {
      if (item.payload.choices.text[0].content) {
        me_message.value[me_message.value.length - 1].message += item.payload.choices.text[0].content;
      }
      setTimeout(() => down_message(), 2000);
    }, 100);
  });
});

const submitFormBaidu = () => submitForms("run_baidu_send", ({ value }) => {
  let result = new TextDecoder().decode(value);
  let arr = result.split("\n\n").map((str) => str.replace(/\n/g, ""));
  let new_arr = [];
  for (let i = 0; i < arr.length; i++) {
    is_done.value = false;
    if (arr[i].slice(-2) == "}}" && arr[i].startsWith("data:")) {
      new_arr.push(JSON.parse(arr[i].replace("data:", "")));
    } else if (arr[i].startsWith("data:") && arr[i].slice(-2) != "]}") {
      streams.value = arr[i].replace("data:", "");
    } else if (arr[i].slice(-2) == "}}" && !arr[i].startsWith("data:")) {
      let str = (streams.value += arr[i]);
      new_arr.push(JSON.parse(str.replace("data:", "")));
      streams.value = "";
    } else {
      if (arr[i].includes('"error_msg"')) {
        me_message.value[me_message.value.length - 1].message = JSON.parse(arr[i]).error_msg;
      }
      streams.value = "";
    }
    if (arr[i].includes("reply_content:")) {
      let content = arr[i].substring(14);
      for (let i = 0; i < content.length; i++) {
        setTimeout(() => {
          me_message.value[me_message.value.length - 1].message += content.charAt(i);
          setTimeout(() => down_message(), 2000);
        }, 1000);
      }
    }
  }
  new_arr.forEach(item => {
    setTimeout(() => {
      if (item.result) {
        me_message.value[me_message.value.length - 1].message += item.result;
      }
      setTimeout(() => down_message(), 2000);
    }, 100);
  });
});

const submitFormGLM = async () => submitForms("run_chatglm_send", async ({ value }) => {
  let partialData = "";
  const chunk = new TextDecoder().decode(value);
  const lines = (partialData + chunk).split("\n");
  partialData = lines.pop() || "";
  for (const line of lines) {
    if (line.trim() === "data: [DONE]") continue;
    try {
      const trimmedLine = line.trim();
      if (trimmedLine.startsWith("data:")) {
        const jsonData = trimmedLine.slice(5);
        const json = JSON.parse(jsonData);
        if (json.choices) {
          json.choices.forEach(choice => {
            const content = choice.delta?.content;
            if (content) {
              me_message.value[me_message.value.length - 1].message += content;
              setTimeout(() => down_message(), 2000);
            }
            if (choice.finish_reason === "stop") {
              return;
            }
          });
        }
      }
    } catch (e) {
      console.error(e);
    }
  }
});

const submitFormQwen = () => submitForms("run_ali_send", ({ value }) => {
  let result = new TextDecoder().decode(value);
  let lines = result.split("\n");
  let events = [];
  let currentEvent = "", currentID = "", currentData = "";
  let combinedText = "";
  lines.forEach(line => {
    if (line.startsWith("event:")) {
      currentEvent = line.split(":")[1]?.trim() || "";
    } else if (line.startsWith("id:")) {
      currentID = line.split(":")[1]?.trim() || "";
    } else if (line.startsWith("data:")) {
      currentData += currentData ? "\n" + line.slice("data:".length) : line.slice("data:".length);
      if (currentEvent && currentData) {
        let text = "";
        try {
          let parsedData = JSON.parse(currentData);
          if (parsedData.output && parsedData.output.text) {
            text = parsedData.output.text;
          }
        } catch (error) {
          console.error("解析 data 字段时出错:", error);
        }
        events.push({ event: currentEvent, id: currentID, data: currentData, text });
        combinedText += text;
        currentEvent = "";
        currentID = "";
        currentData = "";
      }
    }
  });
  events.forEach(event => {
    me_message.value[me_message.value.length - 1].message += combinedText;
    setTimeout(() => down_message(), 2000);
  });
});

const submitFormTencent = () => submitForms("run_hunyuan_send", ({ value }) => {
  let partialData = "";
  const chunk = new TextDecoder().decode(value);
  const lines = (partialData + chunk).split("\n");
  partialData = lines.pop() || "";
  for (const line of lines) {
    try {
      const trimmedLine = line.trim();
      if (trimmedLine.startsWith("data:")) {
        const jsonData = trimmedLine.slice(5);
        const json = JSON.parse(jsonData);
        if (json.Choices) {
          json.Choices.forEach(choice => {
            const content = choice.Delta?.Content;
            if (content) {
              me_message.value[me_message.value.length - 1].message += content;
              setTimeout(() => down_message(), 2000);
            }
            if (choice.finish_reason === "stop") {
              return;
            }
          });
        }
      }
    } catch (e) {
      console.error(e);
    }
  }
});

const submitFormKimi = () => submitForms("send_kimi", ({ value }) => {
  let partialData = "";
  const chunk = new TextDecoder().decode(value);
  const lines = (partialData + chunk).split("\n");
  partialData = lines.pop() || "";
  for (const line of lines) {
    if (line.trim() === "data: [DONE]") continue;
    try {
      const trimmedLine = line.trim();
      if (trimmedLine.startsWith("data:")) {
        const jsonData = trimmedLine.slice(5);
        const json = JSON.parse(jsonData);
        if (json.choices) {
          json.choices.forEach(choice => {
            const content = choice.delta?.content;
            if (content) {
              me_message.value[me_message.value.length - 1].message += content;
              setTimeout(() => down_message(), 2000);
            }
            if (choice.finish_reason === "stop") {
              return;
            }
          });
        }
      }
    } catch (e) {
      console.error(e);
    }
  }
});


const colorMode = useColorMode();
const change_theme = (theme: string) => {
  colorMode.preference = theme;
  document.body.setAttribute("arco-theme", theme + "-mode");
  arco_theme.value = theme;
};

const recorder = ref<any>(null);
const transcribedText = ref<string>("请对我说些什么吧~");
const voice_dialog = ref(false);
const voice_open = ref(false);
const voice_load = ref(false);
const startRecording = () => {
  recorder.value = Recorder({
    type: "mp3",
    sampleRate: 16000,
    bitRate: 16,
    onProcess: (
      buffers: any,
      powerLevel: number,
      duration: number,
      sampleRate: number
    ) => {
      // 处理录音数据
    },
  });
  voice_open.value = true;
  transcribedText.value = "我正在听您说话...";
  recorder.value.open(() => {
    recorder.value.start();
  });
};

const stopRecording = () => {
  recorder.value.stop((blob: Blob) => {
    voice_load.value = true;
    voice_open.value = false;
    transcribedText.value = "正在识别,请您等待...";
    handleTranscription(blob);
  });
};

const reduce_chat = () => {
  reduce_chat_pro({
    session_id: ms_active.value,
  })
    .then((res: any) => {
      Message.success(res._rawValue.message);
      router.push("/chat/" + res._rawValue.data);
    })
    .catch((err: any) => {
      Message.error(err.message);
    });
};
const checkedValue = ref([]);
const voice_set_loading = ref(false);
const transcribeAudio = async (blob: Blob): Promise<string> => {
  const formData = new FormData();
  formData.append("audioData", blob, "audio.mp3");
  formData.append("voice", voice_role_choose.value);
  formData.append("voice_list", checkedValue.value);
  try {
    const response = await fetch(`${window.APP_CONFIG.baseUrl}transcribe-audio`, {
      method: "POST",
      headers: headers,
      body: formData,
    });
    if (response.status == 402) {
      voice_load.value = false;
      Message.error("发送次数已达上限或余额不足");
      throw new Error("发送次数已达上限或余额不足");
    }

    if (!response.ok) {
      voice_load.value = false;
      transcribedText.value = "识别失败,请重试";
      if (response.statusText == "Unauthorized") {
        Message.error("请先登录");
        throw new Error("请先登录");
      } else {
        Message.error(response.statusText);
        throw new Error(response.statusText);
      }
    }

    const audioBlob = await response.blob();
    const audioUrl = URL.createObjectURL(audioBlob);

    const audio = new Audio(audioUrl);
    audio.play();
    voice_get_list();
    voice_load.value = false;
  } catch (error) {
    console.error("Error transcribing audio:", error);
    throw error;
  }
};
const edit_question = (info: any) => {
  ruleForm.message_input = info;
};

const ChatranscribeAudio = async (info: string): Promise<string> => {
  const formData = new FormData();
  formData.append("voice", voice_role_choose.value);
  formData.append("info", info);
  try {
    const response = await fetch(`${window.APP_CONFIG.baseUrl}chat-audio`, {
      method: "POST",
      headers: headers,
      body: formData,
    });

    if (!response.ok) {
      Message.error(response.statusText);
      throw new Error(response.statusText);
    }

    const audioBlob = await response.blob();
    const audioUrl = URL.createObjectURL(audioBlob);

    const audio = new Audio(audioUrl);
    audio.play();
    speak_is_audio.value = false;
    Message.success("语音播放完成");
  } catch (error) {
    console.error("Error transcribing audio:", error);
    throw error;
  }
};

const handleTranscription = (blob: Blob) => {
  transcribeAudio(blob)
    .then(() => {
      voice_load.value = false;
      transcribedText.value = "您还想问我些什么呢？";
    })
    .catch((error: any) => {
      console.error("Error transcribing audio:", error);
    });
};
const voice_role_choose = ref("alloy");
const voice_role = ref([
  {
    value: "alloy",
    label: "Alloy",
    image: "/images/avatar-1.png",
    description: "Alloy是一个男孩，他是一个有趣的人，他喜欢和人们聊天。",
  },
  {
    value: "echo",
    label: "Echo",
    image: "/images/avatar-2.png",
    description: "Echo是一个柔声男孩，他会为您提供帮助。",
  },
  {
    value: "fable",
    label: "Fable",
    image: "/images/avatar-3.png",
    description: "Fable是一个男人，他是一个严肃的人，他喜欢回答您的问题。",
  },
  {
    value: "onyx",
    label: "Onyx",
    image: "/images/avatar-4.png",
    description:
      "Onyx是一个男孩，也许是个工程师，神秘莫测的他，喜欢和人们聊天。",
  },
  {
    value: "nova",
    label: "Nova",
    image: "/images/avatar-5.png",
    description: "Nova是一个温柔的男人，他很会用温暖话语安慰你。",
  },
  {
    value: "shimmer",
    label: "Shimmer",
    image: "/images/avatar-6.png",
    description: "Shimmer是一个热情女孩，她很乐意帮助您。",
  },
]);
const voice_role_change = (v: string) => {
  chat_speak.value = v;
  Message.success("切换成功");
};
const handleSelectRole = (v: string) => {
  voice_role_choose.value = v;
};
</script>
<style scoped lang="scss">
.v-align {
  vertical-align: -2px;
}
</style>
